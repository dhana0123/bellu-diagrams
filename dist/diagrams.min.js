class t{constructor(t,e){this.x=t,this.y=e}add(e){return new t(this.x+e.x,this.y+e.y)}sub(e){return new t(this.x-e.x,this.y-e.y)}scale(e){return new t(this.x*e,this.y*e)}mul(e){return new t(this.x*e.x,this.y*e.y)}rotate(e){let n=this.x*Math.cos(e)-this.y*Math.sin(e),i=this.x*Math.sin(e)+this.y*Math.cos(e);return new t(n,i)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}equals(t){return this.x==t.x&&this.y==t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}length_sq(){return this.x*this.x+this.y*this.y}angle(){return Math.atan2(this.y,this.x)}normalize(){let e=this.length();return new t(this.x/e,this.y/e)}copy(){return new t(this.x,this.y)}apply(t){return t(this.copy())}}function e(e,n){return new t(e,n)}function n(e){return new t(Math.cos(e),Math.sin(e))}class i{static translate(t){return e=>e.add(t)}static rotate(t,e){return n=>n.sub(e).rotate(t).add(e)}static scale(t,e){return n=>n.sub(e).mul(t).add(e)}static reflect_over_point(t){return e=>e.sub(t).rotate(Math.PI).add(t)}static reflect_over_line(t,e){let n=e.sub(t).rotate(Math.PI/2).normalize();return e=>{let i=n.dot(e.sub(t));return e.sub(n.scale(2*i))}}static skewX(e,n){return i=>{let r=i.x+(n-i.y)*Math.tan(e);return new t(r,i.y)}}static skewY(e,n){return i=>{let r=i.y+(n-i.x)*Math.tan(e);return new t(i.x,r)}}}var r,s,a;!function(t){t.TEXT="TEXT",t.OPEN_TAG="OPEN_TAG",t.CLOSE_TAG="CLOSE_TAG",t.EOF="EOF"}(r||(r={}));class l{static parse_tag_content(t){if("/"===t[0]){let e=t.substring(1);return{type:r.CLOSE_TAG,attributes:{_tag_name:e}}}let e=t.indexOf(" "),n=t.indexOf("=");if(-1===e&&-1===n)return{type:r.OPEN_TAG,attributes:{_tag_name:t}};if(-1===e&&n>0){let e=t.substring(0,n),i=t.substring(n+1),s={_tag_name:e};return s[e]=i,{type:r.OPEN_TAG,attributes:s}}throw new Error("Unimplemented")}static parse(t){let e=[],n=0,i=t.length;for(;n<i;){let i=t.indexOf("[",n);if(-1===i){e.push({type:r.TEXT,attributes:{_text:t.substring(n)}});break}i>n&&e.push({type:r.TEXT,attributes:{_text:t.substring(n,i)}});let s=t.indexOf("]",i),a=t.indexOf("[",i+1);if(a>0&&a<s)return null;if(-1===s)return null;let o=t.substring(i+1,s);e.push(l.parse_tag_content(o)),n=s+1}return e}}class o{static from_BBCode(t,e="1em"){var n;let i=[],s=[],a=l.parse(t);if(null===a)return console.error("Invalid BBCode"),[];for(let t of a)switch(t.type){case r.OPEN_TAG:if("br"===t.attributes._tag_name){const t=null!==(n=o.build_style(s)["_line-height"])&&void 0!==n?n:e;i.push({text:"\n",style:{dy:t}});break}s.push(t.attributes);break;case r.CLOSE_TAG:if(0===s.length)return console.error("Invalid BBCode"),[];if(s[s.length-1]._tag_name!==t.attributes._tag_name)return console.error("Invalid BBCode"),[];s.pop();break;case r.TEXT:{let e=o.build_style(s);i.push({text:t.attributes._text,style:e})}}return i}static split_tspans_by_words(t){let e=[];for(let n of t){let t=n.text.split(" ");for(let e=0;e<t.length-1;e++)t[e]+=" ";for(let i of t)e.push({text:i,style:JSON.parse(JSON.stringify(n.style))})}return e}static build_style(t){let e={};for(let n of t)switch(n._tag_name){case"b":e["font-weight"]="bold";break;case"i":e["font-style"]="italic";break;case"color":e.fill=n.color;break;case"size":e["font-size"]=n.size;break;case"dx":e.dx=n.dx;break;case"dy":e.dy=n.dy;break;case"font":e["font-family"]=n.font;break;case"var":e.textvar=!0;break;case"tag":e.tag=n.tag;break;case"lineheight":e["_line-height"]=n.lineheight;break;case"sup":e["baseline-shift"]="super",e["font-size-scale-factor"]=.7,e["is-prev-word"]=!0;break;case"sub":e["baseline-shift"]="-20%",e["font-size-scale-factor"]=.7,e["is-prev-word"]=!0}return e}}!function(t){t.EMPTY="empty",t.LINE="line",t.CIRCLE="circle",t.TEXTVAR="textvar",t.ROW_="row_",t.COL_="col_",t.ARROW_LINE="arrow_line",t.ARROW_HEAD="arrow_head",t.TABLE="table",t.CONTAIN_TABLE="contain_table",t.TABLE_CELL="table_cell",t.TABLE_CONTENT="table_content",t.EMPTY_CELL="empty_cell",t.GRAPH_AXIS="graph_axis_line",t.GRAPH_TICK="graph_tick",t.GRAPH_TICK_LABEL="graph_tick_label",t.GRAPH_GRID="graph_grid"}(s||(s={})),function(t){t.Polygon="polygon",t.Curve="curve",t.Text="text",t.Image="image",t.Diagram="diagram",t.MultilineText="multilinetext"}(a||(a={}));const c="16";class h{constructor(e,n={}){this.children=[],this.path=void 0,this.origin=new t(0,0),this.style={},this.textdata={},this.multilinedata={},this.imgdata={},this.mutable=!1,this.tags=[],this._bbox_cache=void 0,this.type=e,this.path=n.path,n.children&&(this.children=n.children),n.textdata&&(this.textdata=n.textdata),n.imgdata&&(this.imgdata=n.imgdata),n.tags&&(this.tags=n.tags),n.multilinedata&&(this.multilinedata=n.multilinedata)}mut(){this.mutable=!0,null!=this.path&&(this.path.mutable=!0);for(let t=0;t<this.children.length;t++)this.children[t].mut();return this}mut_parent_only(){return this.mutable=!0,null!=this.path&&(this.path.mutable=!0),this}immut(){let t=this.copy();t.mutable=!1,null!=this.path&&(this.path.mutable=!1);for(let e=0;e<t.children.length;e++)t.children[e].immut();return t}static deep_setPrototypeOf(e){Object.setPrototypeOf(e,h.prototype);let n=e;n.origin=Object.setPrototypeOf(n.origin,t.prototype);for(let t=0;t<n.children.length;t++)h.deep_setPrototypeOf(n.children[t]);null!=n.path&&(Object.setPrototypeOf(n.path,d.prototype),n.path=n.path.copy()),null!=n._bbox_cache&&2==n._bbox_cache.length&&(Object.setPrototypeOf(n._bbox_cache[0],t.prototype),Object.setPrototypeOf(n._bbox_cache[1],t.prototype))}copy(){let t=JSON.parse(JSON.stringify(this));return h.deep_setPrototypeOf(t),t}copy_if_not_mutable(){return this.mutable?this:this.copy()}append_tags(t){let e=this.copy_if_not_mutable();Array.isArray(t)||(t=[t]);for(let n of t)e.tags.includes(n)||e.tags.push(n);return e}remove_tags(t){let e=this.copy_if_not_mutable();return e.tags=e.tags.filter((e=>!t.includes(e))),e}reset_tags(){let t=this.copy_if_not_mutable();return t.tags=[],t}contain_tag(t){return this.tags.includes(t)}contain_all_tags(t){for(let e of t)if(!this.tags.includes(e))return!1;return!0}collect_children(){let t=[];if(this.type==a.Diagram)for(let e of this.children)t=t.concat(e.collect_children());else t.push(this);return t}flatten(){let t=this.copy_if_not_mutable();return t.children=t.collect_children(),t}apply(t){return t(this.copy_if_not_mutable())}apply_recursive(t){let e=this.copy_if_not_mutable();e=t(e);for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].apply_recursive(t);return e}apply_to_tagged_recursive(t,e){Array.isArray(t)||(t=[t]);let n=this.copy_if_not_mutable();n.contain_all_tags(t)&&(n=e(n));for(let i=0;i<n.children.length;i++)n.children[i]=n.children[i].apply_to_tagged_recursive(t,e);return n}get_tagged_elements(t){Array.isArray(t)||(t=[t]);let e=[];this.contain_all_tags(t)&&e.push(this.copy_if_not_mutable());for(let n=0;n<this.children.length;n++)e=e.concat(this.children[n].get_tagged_elements(t));return e}combine(...t){return u(this,...t)}to_curve(){let t=this.copy_if_not_mutable();if(t.type==a.Polygon)t.type=a.Curve;else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].to_curve();return t}to_polygon(){let t=this.copy_if_not_mutable();if(t.type==a.Curve)t.type=a.Polygon;else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].to_polygon();return t}add_points(t){let e=this.copy_if_not_mutable();if(e.type==a.Polygon||e.type==a.Curve){if(null==e.path)throw new Error(this.type+" must have a path");e.path=e.path.add_points(t)}else if(e.type==a.Diagram){let n=e.children[e.children.length-1];e.children[e.children.length-1]=n.add_points(t)}return e}update_style(t,e,n){let i=this.copy_if_not_mutable();if(null==n?void 0:n.includes(i.type))return i;if(i.type==a.Polygon||i.type==a.Curve||i.type==a.Text||i.type==a.Image||i.type==a.MultilineText)i.style[t]=e;else{if(i.type!=a.Diagram)throw new Error("Unreachable, unknown diagram type : "+i.type);for(let r=0;r<i.children.length;r++)i.children[r]=i.children[r].update_style(t,e,n)}return i}clone_style_from(t){return this.apply_recursive((e=>(e.style=Object.assign({},t.style),e)))}fill(t){return this.update_style("fill",t,[a.Text])}stroke(t){return this.update_style("stroke",t,[a.Text])}opacity(t){return this.update_style("opacity",t.toString())}strokewidth(t){return this.update_style("stroke-width",t.toString(),[a.Text])}strokelinecap(t){return this.update_style("stroke-linecap",t)}strokelinejoin(t){return this.update_style("stroke-linejoin",t)}strokedasharray(t){return this.update_style("stroke-dasharray",t.join(","))}vectoreffect(t){return this.update_style("vector-effect",t)}filter(t){return this.update_style("filter",`url(#${t})`)}textfill(t){return this.update_style("fill",t,[a.Polygon,a.Curve])}textstroke(t){return this.update_style("stroke",t,[a.Polygon,a.Curve])}textstrokewidth(t){return this.update_style("stroke-width",t.toString(),[a.Polygon,a.Curve])}update_textdata(t,e){let n=this.copy_if_not_mutable();if(n.type==a.Text||n.type==a.MultilineText)n.textdata[t]=e;else if(n.type==a.Diagram)for(let i=0;i<n.children.length;i++)n.children[i]=n.children[i].update_textdata(t,e);else if(n.type!=a.Polygon&&n.type!=a.Curve)throw new Error("Unreachable, unknown diagram type : "+n.type);return n}fontfamily(t){return this.update_textdata("font-family",t)}fontstyle(t){return this.update_textdata("font-style",t)}fontsize(t){return this.update_textdata("font-size",t.toString())}fontweight(t){return this.update_textdata("font-weight",t.toString())}fontscale(t){return this.update_textdata("font-scale",t.toString())}textanchor(t){return this.update_textdata("text-anchor",t)}textdy(t){return this.update_textdata("dy",t)}textangle(t){return this.update_textdata("angle",t.toString())}text_tovar(){let t=this.copy_if_not_mutable();if(t.type==a.Text)t=t.append_tags(s.TEXTVAR);else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].text_tovar();return t}text_totext(){let t=this.copy_if_not_mutable();if(t.type==a.Text)t=t.remove_tags("textvar");else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].text_totext();return t}bounding_box(){if(null!=this._bbox_cache)return this._bbox_cache;let e=1/0,n=1/0,i=-1/0,r=-1/0;if(this.type==a.Diagram){for(let t=0;t<this.children.length;t++){let s=this.children[t],[a,l]=s.bounding_box();e=Math.min(e,a.x),n=Math.min(n,a.y),i=Math.max(i,l.x),r=Math.max(r,l.y)}const s=[new t(e,n),new t(i,r)];return this._bbox_cache=s,s}if(this.type==a.Curve||this.type==a.Polygon||this.type==a.Image){if(null==this.path)throw new Error(this.type+" must have a path");for(let t=0;t<this.path.points.length;t++){let s=this.path.points[t];e=Math.min(e,s.x),n=Math.min(n,s.y),i=Math.max(i,s.x),r=Math.max(r,s.y)}const s=[new t(e,n),new t(i,r)];return this._bbox_cache=s,s}if(this.type==a.Text||this.type==a.MultilineText){const t=[this.origin.copy(),this.origin.copy()];return this._bbox_cache=t,t}throw new Error("Unreachable, unknown diagram type : "+this.type)}transform(t){let e=this.copy_if_not_mutable();e._bbox_cache=void 0;for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].transform(t);return null!=e.path&&(e.path=e.path.transform(t)),e.origin=t(e.origin),e}translate(t){const e=this._bbox_cache,n=this.transform(i.translate(t));return null!=e&&(n._bbox_cache=e.map((e=>i.translate(t)(e)))),n}position(e=new t(0,0)){let n=e.sub(this.origin);return this.translate(n)}rotate(t,e=void 0){return null==e&&(e=this.origin),this.transform(i.rotate(t,e))}scale(e,n){return null==n&&(n=this.origin),"number"==typeof e&&(e=new t(e,e)),this.transform(i.scale(e,n))}scaletext(t){return this.apply_recursive((e=>{switch(e.type){case a.Text:{let n=parseFloat(e.textdata["font-size"]||c),i=e.copy_if_not_mutable();return i.textdata["font-size"]=(n*t).toString(),i}case a.MultilineText:{let n=e.copy_if_not_mutable();return n.multilinedata["scale-factor"]=(n.multilinedata["scale-factor"]||1)*t,n}default:return e}}))}skewX(t,e){return null==e&&(e=this.origin),this.transform(i.skewX(t,e.y))}skewY(t,e){return null==e&&(e=this.origin),this.transform(i.skewY(t,e.x))}reflect_over_point(t){return this.transform(i.reflect_over_point(t))}reflect_over_line(t,e){return this.transform(i.reflect_over_line(t,e))}reflect(t,e){if(null==t&&null==e)return this.reflect_over_point(this.origin);if(null!=t&&null==e)return this.reflect_over_point(t);if(null!=t&&null!=e)return this.reflect_over_line(t,e);throw new Error("Unreachable")}vflip(e){return null==e&&(e=this.origin.y),this.reflect(new t(0,e),new t(1,e))}hflip(e){return null==e&&(e=this.origin.x),this.reflect(new t(e,0),new t(e,1))}get_anchor(e){let[n,i]=this.bounding_box(),r=n.x,s=n.y,a=i.x,l=i.y,o=(r+a)/2,c=(s+l)/2;switch(e){case"top-left":return new t(r,l);case"top-center":return new t(o,l);case"top-right":return new t(a,l);case"center-left":return new t(r,c);case"center-center":return new t(o,c);case"center-right":return new t(a,c);case"bottom-left":return new t(r,s);case"bottom-center":return new t(o,s);case"bottom-right":return new t(a,s);default:throw new Error("Unknown anchor "+e)}}move_origin(e){let n=this.copy_if_not_mutable();return n.origin=e instanceof t?e:n.get_anchor(e),n}__move_origin_text(t){let e=this.copy_if_not_mutable(),n=function(t){switch(t){case"top-left":return{"text-anchor":"start",dy:"0.75em"};case"top-center":return{"text-anchor":"middle",dy:"0.75em"};case"top-right":return{"text-anchor":"end",dy:"0.75em"};case"center-left":return{"text-anchor":"start",dy:"0.25em"};case"center-center":return{"text-anchor":"middle",dy:"0.25em"};case"center-right":return{"text-anchor":"end",dy:"0.25em"};case"bottom-left":return{"text-anchor":"start",dy:"-0.25em"};case"bottom-center":return{"text-anchor":"middle",dy:"-0.25em"};case"bottom-right":return{"text-anchor":"end",dy:"-0.25em"};default:throw new Error("Unknown anchor "+t)}}(t);return e.textdata["text-anchor"]=n["text-anchor"],e.textdata.dy=n.dy,e}move_origin_text(t){let e=this.copy_if_not_mutable();if(this.type==a.Text||this.type==a.MultilineText)e=e.__move_origin_text(t);else if(this.type==a.Diagram)for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].move_origin_text(t);return e}path_length(){if(this.type==a.Diagram){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].path_length();return t}if(this.type==a.Curve||this.type==a.Polygon){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.length()}throw new Error("Unreachable, unknown diagram type : "+this.type)}reverse_path(){var t;let e=this.copy_if_not_mutable();return e.path&&(e.path=null===(t=e.path)||void 0===t?void 0:t.reverse()),e}parametric_point(t,e){if(this.type==a.Diagram){let e=[],n=0;for(let t=0;t<this.children.length;t++)n+=this.children[t].path_length(),e.push(n);let i=n,r=e.map((t=>t/i));for(let e=0;e<r.length;e++)if(t<=r[e]){let n=e,i=0==e?0:r[e-1],s=(t-i)/(r[e]-i);return this.children[n].parametric_point(s)}throw Error("Unreachable")}if(this.type==a.Curve){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.parametric_point(t,!1,e)}if(this.type==a.Polygon){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.parametric_point(t,!0,e)}throw new Error("Unreachable, unknown diagram type : "+this.type)}debug_bbox(){let[e,n]=this.bounding_box(),i=_([new t(e.x,e.y),new t(n.x,e.y),new t(n.x,n.y),new t(e.x,n.y)]).apply((t=>t.fill("none").stroke("gray").strokedasharray([5,5]))),r=f("+").position(this.origin);return i.combine(r)}debug(t=!0){let e=t=>t.fill("none").stroke("red").strokedasharray([5,5]),n=t=>{let e=t.textfill("white").textstroke("white").textstrokewidth(5),n=t.fill("black");return e.combine(n)};if(this.type==a.Diagram)return this.debug_bbox();if(this.type==a.Text)return m(this.origin);if(this.type==a.Polygon||this.type==a.Curve||this.type==a.Image){let i=this.type==a.Polygon||a.Image?_:g,r=this.debug_bbox();if(null==this.path)throw new Error(this.type+" must have a path");let s=i(this.path.points).apply(e);if(0==t)return r.combine(s);let l,o=this.path.points,c=[],[h,d]=this.bounding_box(),u=Math.min(d.x-h.x,d.y-h.y)/10;for(let t=0;t<o.length;t++){(null==l?1/0:o[t].sub(l).length())<u||(c.push(f(t.toString()).position(o[t]).apply(n)),l=o[t])}return r.combine(s,...c)}throw new Error("Unreachable, unknown diagram type : "+this.type)}is_empty(){return this.contain_tag(s.EMPTY)}}class d{constructor(t){this.points=t,this.mutable=!1}copy(){let e=this.points.map((e=>new t(e.x,e.y)));return new d(e)}copy_if_not_mutable(){return this.mutable?this:this.copy()}reverse(){let t=this.copy_if_not_mutable();return t.points=t.points.reverse(),t}length(){let t=0;for(let e=1;e<this.points.length;e++)t+=this.points[e].sub(this.points[e-1]).length();return t}add_points(t){let e=this.copy_if_not_mutable();return e.points=e.points.concat(t),e}parametric_point(t,e=!1,n){let i=this.points;if(e&&(i=this.points.concat(this.points[0])),null==n){if(t<0||t>1)throw Error("t must be between 0 and 1");let n=[],r=0;for(let t=1;t<i.length;t++)r+=i[t].sub(i[t-1]).length(),n.push(r);let s=r,a=n.map((t=>t/s));for(let n=0;n<a.length;n++)if(t<=a[n]){let i=n,r=0==n?0:a[n-1],s=(t-r)/(a[n]-r);return this.parametric_point(s,e,i)}throw Error("Unreachable")}{if(n<0||n>i.length-1)throw Error("segment_index must be between 0 and n-1");let e=i[n],r=i[n+1].sub(e);return e.add(r.scale(t))}}transform(t){let e=this.copy_if_not_mutable();for(let n=0;n<e.points.length;n++)e.points[n]=t(e.points[n]);return e}}function u(...t){if(0==t.length)return m();let e=t.map((t=>t.copy_if_not_mutable())),n=!0;for(let t=0;t<e.length;t++)if(!e[t].mutable){n=!1;break}let i=new h(a.Diagram,{children:e});return i.mutable=n,i.move_origin(t[0].origin)}function g(t){let e=new d(t);return new h(a.Curve,{path:e})}function p(t,e){return g([t,e]).append_tags(s.LINE)}function _(t){!function(t,e){if(!t)throw new Error(e)}(t.length>=3,"Polygon must have at least 3 points");let e=new d(t);return new h(a.Polygon,{path:e})}function m(t=e(0,0)){return g([t]).append_tags(s.EMPTY)}function f(e){return new h(a.Text,{textdata:{text:e,"font-size":c},path:new d([new t(0,0)])})}function b(t,n,i){let r={src:t},s=new d([e(-n/2,-i/2),e(n/2,-i/2),e(n/2,i/2),e(-n/2,i/2)]);return new h(a.Image,{imgdata:r,path:s})}function v(e){var n;let i=[];for(let t=0;t<e.length;t++){let r=e[t][0],s=null!==(n=e[t][1])&&void 0!==n?n:{};i.push({text:r,style:s})}return new h(a.MultilineText,{multilinedata:{content:i,"scale-factor":1},path:new d([new t(0,0)])})}function y(e,n,i=!1){let r=o.from_BBCode(e,n);return i&&(r=o.split_tspans_by_words(r)),new h(a.MultilineText,{multilinedata:{content:r,"scale-factor":1},path:new d([new t(0,0)])})}const x={blue:"#1f77b4",lightblue:"#aec7e8",orange:"#ff7f0e",lightorange:"#ffbb78",green:"#2ca02c",lightgreen:"#98df8a",red:"#d62728",lightred:"#ff9896",purple:"#9467bd",lightpurple:"#c5b0d5",brown:"#8c564b",lightbrown:"#c49c94",pink:"#e377c2",lightpink:"#f7b6d2",grey:"#7f7f7f",lightgrey:"#c7c7c7",gray:"#7f7f7f",lightgray:"#c7c7c7",olive:"#bcbd22",lightolive:"#dbdb8d",cyan:"#17becf",lightcyan:"#9edae5"};function w(t,e){var n;return null!==(n=e[t])&&void 0!==n?n:t}function k(t){return t*Math.PI/180}function E(t){return 180*t/Math.PI}function A(t,e){let n=[];for(let i=0;i<e;i++)n.push(t[i%t.length]);return n}function S(t,e,n=100){let i=[],r=(e-t)/(n-1);for(let e=0;e<n;e++)i.push(t+r*e);return i}function O(t,e,n=100){let i=[],r=(e-t)/n;for(let e=0;e<n;e++)i.push(t+r*e);return i}function L(t,e,n=1){if(0==n)return[];if(Math.floor((e-t)/n)<=0)return[];let i=[];if(n>0)for(let r=t;r<e;r+=n)i.push(r);else for(let r=t;r>e;r+=n)i.push(r);return i}function C(t,e,n=1){if(0==n)return[];if(Math.floor((e-t)/n)<=0)return[];let i=[];if(n>0)for(let r=t;r<=e;r+=n)i.push(r);else for(let r=t;r>=e;r+=n)i.push(r);return i}function M(t){let e=[],n=Math.max(...t.map((t=>t.length)));for(let i=0;i<n;i++){e.push([]);for(let n=0;n<t.length;n++)e[i].push(t[n][i])}return e}function T(t){let e=t;return"number"==typeof e?[e,e,e,e]:Array.isArray(e)?1===e.length?[e[0],e[0],e[0],e[0]]:2===e.length?[e[0],e[1],e[0],e[1]]:3===e.length?[e[0],e[1],e[2],e[1]]:e.length>=4?[e[0],e[1],e[2],e[3]]:[0,0,0,0]:[0,0,0,0]}var z=Object.freeze({__proto__:null,array_repeat:A,expand_directional_value:T,linspace:S,linspace_exc:O,range:L,range_inc:C,to_degree:E,to_radian:k,transpose:M});const N={A:"ğ´",B:"ğµ",C:"ğ¶",D:"ğ·",E:"ğ¸",F:"ğ¹",G:"ğº",H:"ğ»",I:"ğ¼",J:"ğ½",K:"ğ¾",L:"ğ¿",M:"ğ‘€",N:"ğ‘",O:"ğ‘‚",P:"ğ‘ƒ",Q:"ğ‘„",R:"ğ‘…",S:"ğ‘†",T:"ğ‘‡",U:"ğ‘ˆ",V:"ğ‘‰",W:"ğ‘Š",X:"ğ‘‹",Y:"ğ‘Œ",Z:"ğ‘",a:"ğ‘",b:"ğ‘",c:"ğ‘",d:"ğ‘‘",e:"ğ‘’",f:"ğ‘“",g:"ğ‘”",h:"â„",i:"ğ‘–",j:"ğ‘—",k:"ğ‘˜",l:"ğ‘™",m:"ğ‘š",n:"ğ‘›",o:"ğ‘œ",p:"ğ‘",q:"ğ‘",r:"ğ‘Ÿ",s:"ğ‘ ",t:"ğ‘¡",u:"ğ‘¢",v:"ğ‘£",w:"ğ‘¤",x:"ğ‘¥",y:"ğ‘¦",z:"ğ‘§","Î‘":"ğ›¢","Î’":"ğ›£","Î“":"ğ›¤","Î”":"ğ›¥","Î•":"ğ›¦","Î–":"ğ›§","Î—":"ğ›¨","Î˜":"ğ›©","Î™":"ğ›ª","Îš":"ğ›«","Î›":"ğ›¬","Îœ":"ğ›­","Î":"ğ›®","Î":"ğ›¯","ÎŸ":"ğ›°","Î ":"ğ›±","Î¡":"ğ›²","Î£":"ğ›´","Î¤":"ğ›µ","Î¥":"ğ›¶","Î¦":"ğ›·","Î§":"ğ›¸","Î¨":"ğ›¹","Î©":"ğ›º","Î±":"ğ›¼","Î²":"ğ›½","Î³":"ğ›¾","Î´":"ğ›¿","Îµ":"ğœ€","Î¶":"ğœ","Î·":"ğœ‚","Î¸":"ğœƒ","Î¹":"ğœ„","Îº":"ğœ…","Î»":"ğœ†","Î¼":"ğœ‡","Î½":"ğœˆ","Î¾":"ğœ‰","Î¿":"ğœŠ","Ï€":"ğœ‹","Ï":"ğœŒ","Ï‚":"ğœ","Ïƒ":"ğœ","Ï„":"ğœ","Ï…":"ğœ","Ï†":"ğœ‘","Ï‡":"ğœ’","Ïˆ":"ğœ“","Ï‰":"ğœ”","Ï‘":"ğœ—","Ï°":"ğœ˜","Ï•":"ğœ™","Ï±":"ğœš","Ï–":"ğœ›"};Object.fromEntries(Object.entries(N).map((([t,e])=>[e,t])));const H={"\\alpha":"Î±","\\beta":"Î²","\\gamma":"Î³","\\delta":"Î´","\\epsilon":"Îµ","\\zeta":"Î¶","\\eta":"Î·","\\theta":"Î¸","\\iota":"Î¹","\\kappa":"Îº","\\lambda":"Î»","\\mu":"Î¼","\\nu":"Î½","\\xi":"Î¾","\\omicron":"Î¿","\\pi":"Ï€","\\rho":"Ï","\\sigma":"Ïƒ","\\tau":"Ï„","\\upsilon":"Ï…","\\phi":"Ï•","\\chi":"Ï‡","\\psi":"Ïˆ","\\omega":"Ï‰","\\vartheta":"Ï‘","\\varchi":"Ï°","\\varphi":"Ï†","\\varepsilon":"Îµ","\\varrho":"Ï±","\\varsigma":"Ï‚"},D={textfractionsolidus:"â„",leftrightsquigarrow:"â†­",textpertenthousand:"â€±",blacktriangleright:"â–¸",blacktriangledown:"â–¾",blacktriangleleft:"â—‚",twoheadrightarrow:"â† ",leftrightharpoons:"â‡‹",rightleftharpoons:"â‡Œ",textreferencemark:"â€»",circlearrowright:"â†»",rightrightarrows:"â‡‰",vartriangleright:"âŠ³",textordmasculine:"Âº",textvisiblespace:"â£",twoheadleftarrow:"â†",downharpoonright:"â‡‚",ntrianglerighteq:"â‹­",rightharpoondown:"â‡",textperthousand:"â€°",leftrightarrows:"â‡†",textmusicalnote:"â™ª",nleftrightarrow:"â†®",rightleftarrows:"â‡„",bigtriangledown:"â–½",textordfeminine:"Âª",ntrianglelefteq:"â‹¬",rightthreetimes:"â‹Œ",trianglerighteq:"âŠµ",vartriangleleft:"âŠ²",rightsquigarrow:"â‡",downharpoonleft:"â‡ƒ",curvearrowright:"â†·",circlearrowleft:"â†º",leftharpoondown:"â†½",nLeftrightarrow:"â‡",curvearrowleft:"â†¶",guilsinglright:"â€º",leftthreetimes:"â‹‹",leftrightarrow:"â†”",rightharpoonup:"â‡€",guillemotright:"Â»",downdownarrows:"â‡Š",hookrightarrow:"â†ª",dashrightarrow:"â‡¢",leftleftarrows:"â‡‡",trianglelefteq:"âŠ´",ntriangleright:"â‹«",doublebarwedge:"âŒ†",upharpoonright:"â†¾",rightarrowtail:"â†£",looparrowright:"â†¬",Leftrightarrow:"â‡”",sphericalangle:"âˆ¢",divideontimes:"â‹‡",measuredangle:"âˆ¡",blacktriangle:"â–´",ntriangleleft:"â‹ª",mathchar1356:"â",texttrademark:"â„¢",mathchar2208:"âŒ–",triangleright:"â–¹",leftarrowtail:"â†¢",guilsinglleft:"â€¹",upharpoonleft:"â†¿","mathbb{gamma}":"â„½",fallingdotseq:"â‰’",looparrowleft:"â†«",textbrokenbar:"Â¦",hookleftarrow:"â†©",smallsetminus:"ï¹¨",dashleftarrow:"â‡ ",guillemotleft:"Â«",leftharpoonup:"â†¼","mathbb{Gamma}":"â„¾",bigtriangleup:"â–³",textcircledP:"â„—",risingdotseq:"â‰“",triangleleft:"â—ƒ",mathsterling:"Â£",textcurrency:"Â¤",triangledown:"â–¿",blacklozenge:"î ‹","sfrac{5}{6}":"â…š",preccurlyeq:"â‰¼",Rrightarrow:"â‡›",circledcirc:"âŠš",nRightarrow:"â‡","sfrac{3}{8}":"â…œ","sfrac{1}{3}":"â…“","sfrac{2}{5}":"â…–",vartriangle:"â–µ",Updownarrow:"â‡•",nrightarrow:"â†›","sfrac{1}{2}":"Â½","sfrac{3}{5}":"â…—",succcurlyeq:"â‰½","sfrac{4}{5}":"â…˜",diamondsuit:"â™¦","sfrac{1}{6}":"â…™",curlyeqsucc:"â‹Ÿ",blacksquare:"â–ª",curlyeqprec:"â‹","sfrac{1}{8}":"â…›","sfrac{7}{8}":"â…","sfrac{1}{5}":"â…•","sfrac{2}{3}":"â…”",updownarrow:"â†•",backepsilon:"âˆ",circleddash:"âŠ",eqslantless:"â‹œ","sfrac{3}{4}":"Â¾","sfrac{5}{8}":"â…","sfrac{1}{4}":"Â¼","mathbb{Pi}":"â„¿","mathcal{M}":"â„³","mathcal{o}\t":"â„´","mathcal{O}\t":"ğ’ª",nsupseteqq:"âŠ‰","mathcal{B}":"â„¬",textrecipe:"â„",nsubseteqq:"âŠˆ",subsetneqq:"âŠŠ","mathcal{I}":"â„‘",upuparrows:"â‡ˆ","mathcal{e}":"â„¯","mathcal{L}":"â„’",nleftarrow:"â†š","mathcal{H}":"â„‹","mathcal{E}":"â„°",eqslantgtr:"â‹",curlywedge:"â‹",varepsilon:"Îµ",supsetneqq:"âŠ‹",rightarrow:"â†’","mathcal{R}":"â„›",sqsubseteq:"âŠ‘","mathcal{g}":"â„Š",sqsupseteq:"âŠ’",complement:"âˆ",Rightarrow:"â‡’",gtreqqless:"â‹›",lesseqqgtr:"â‹š",circledast:"âŠ›",nLeftarrow:"â‡",Lleftarrow:"â‡š",varnothing:"âˆ…","mathcal{N}":"ğ’©",Leftarrow:"â‡",gvertneqq:"â‰©","mathbb{C}":"â„‚",supsetneq:"âŠ‹",leftarrow:"â†",nleqslant:"â‰°","mathbb{Q}":"â„š","mathbb{Z}":"â„¤",llbracket:"ã€š","mathbb{H}":"â„",spadesuit:"â™ ","mathit{o}":"â„´","mathbb{P}":"â„™",rrbracket:"ã€›",supseteqq:"âŠ‡",copyright:"Â©","textsc{k}":"Ä¸",gtreqless:"â‹›","mathbb{j}":"â…‰",pitchfork:"â‹”",estimated:"â„®",ngeqslant:"â‰±","mathbb{e}":"â…‡",therefore:"âˆ´",triangleq:"â‰œ",varpropto:"âˆ",subsetneq:"âŠŠ",heartsuit:"â™¥","mathbb{d}":"â…†",lvertneqq:"â‰¨",checkmark:"âœ“",nparallel:"âˆ¦","mathbb{R}":"â„",lesseqgtr:"â‹š",downarrow:"â†“","mathbb{D}":"â……","mathbb{i}":"â…ˆ",backsimeq:"â‹","mathbb{N}":"â„•",Downarrow:"â‡“",subseteqq:"âŠ†",setminus:"âˆ–",succnsim:"â‹©",doteqdot:"â‰‘",clubsuit:"â™£",emptyset:"âˆ…",sqsupset:"âŠ","fbox{~~}":"â–­",curlyvee:"â‹",varkappa:"Ï°",llcorner:"âŒ",varsigma:"Ï‚",approxeq:"â‰Š",backcong:"â‰Œ",supseteq:"âŠ‡",circledS:"â“ˆ",circledR:"Â®",textcent:"Â¢",urcorner:"âŒ",lrcorner:"âŒŸ",boxminus:"âŠŸ",texteuro:"â‚¬",vartheta:"Ï‘",barwedge:"âŠ¼","ding{86}":"âœ¶",sqsubset:"âŠ",subseteq:"âŠ†",intercal:"âŠº","ding{73}":"â˜†",ulcorner:"âŒœ",recorder:"âŒ•",precnsim:"â‹¨",parallel:"âˆ¥",boxtimes:"âŠ ","ding{55}":"âœ—",multimap:"âŠ¸",maltese:"âœ ",nearrow:"â†—",swarrow:"â†™",lozenge:"â—Š","sqrt[3]":"âˆ›",succsim:"â‰¿",dotplus:"âˆ”","tilde{}":"~","check{}":"Ë‡",lessgtr:"â‰¶",Upsilon:"Ï’",Cdprime:"Ğª",gtrless:"â‰·",backsim:"âˆ½",nexists:"âˆ„",searrow:"â†˜",lessdot:"â‹–",boxplus:"âŠ",upsilon:"Ï…",epsilon:"Îµ",diamond:"â‹„",bigstar:"â˜…",ddagger:"â€¡",cdprime:"ÑŠ",Uparrow:"â‡‘","sqrt[4]":"âˆœ",between:"â‰¬",sqangle:"âˆŸ",digamma:"Ïœ",uparrow:"â†‘",nwarrow:"â†–",precsim:"â‰¾","breve{}":"Ë˜",because:"âˆµ",bigcirc:"â—¯","acute{}":"Â´","grave{}":"`",lesssim:"â‰²",partial:"âˆ‚",natural:"â™®",supset:"âŠƒ",hstrok:"Ä§",Tstrok:"Å¦",coprod:"âˆ",models:"âŠ§",otimes:"âŠ—",degree:"Â°",gtrdot:"â‹—",preceq:"â‰¼",Lambda:"Î›",lambda:"Î»",cprime:"ÑŒ",varrho:"Ï±",Bumpeq:"â‰",hybull:"âƒ",lmidot:"Å€",nvdash:"âŠ¬",lbrace:"{",bullet:"â€¢",varphi:"Ï†",bumpeq:"â‰","ddot{}":"Â¨",Lmidot:"Ä¿",Cprime:"Ğ¬",female:"â™€",rtimes:"â‹Š",gtrsim:"â‰³",mapsto:"â†¦",daleth:"â„¸",square:"â– ",nVDash:"âŠ¯",rangle:"âŸ©",tstrok:"Å§",oslash:"âŠ˜",ltimes:"â‹‰",lfloor:"âŒŠ",marker:"â–®",Subset:"â‹",Vvdash:"âŠª",propto:"âˆ",Hstrok:"Ä¦",dlcrop:"âŒ",forall:"âˆ€",nVdash:"âŠ®",Supset:"â‹‘",langle:"âŸ¨",ominus:"âŠ–",rfloor:"âŒ‹",circeq:"â‰—",eqcirc:"â‰–",drcrop:"âŒŒ",veebar:"âŠ»",ulcrop:"âŒ",nvDash:"âŠ­",urcrop:"âŒ",exists:"âˆƒ",approx:"â‰ˆ",dagger:"â€ ",boxdot:"âŠ¡",succeq:"â‰½",bowtie:"â‹ˆ",subset:"âŠ‚",notin:"âˆ‰",Sigma:"Î£",Omega:"Î©",nabla:"âˆ‡",colon:":",boxHu:"â•§",boxHd:"â•¤",aleph:"â„µ",gnsim:"â‹§",boxHU:"â•©",boxHD:"â•¦",equiv:"â‰¡",lneqq:"â‰¨",alpha:"Î±",amalg:"âˆ",boxhU:"â•¨",boxhD:"â•¥",uplus:"âŠ",boxhu:"â”´",kappa:"Îº",sigma:"Ïƒ",boxDL:"â•—",Theta:"Î˜",Vdash:"âŠ©",boxDR:"â•”",boxDl:"â•–",sqcap:"âŠ“",boxDr:"â•“","bar{}":"Â¯",dashv:"âŠ£",vDash:"âŠ¨",boxdl:"â”",boxVl:"â•¢",boxVh:"â•«",boxVr:"â•Ÿ",boxdr:"â”Œ",boxdL:"â••",boxVL:"â•£",boxVH:"â•¬",boxVR:"â• ",boxdR:"â•’",theta:"Î¸",lhblk:"â–„",uhblk:"â–€",ldotp:".",ldots:"â€¦",boxvL:"â•¡",boxvH:"â•ª",boxvR:"â•",boxvl:"â”¤",boxvh:"â”¼",boxvr:"â”œ",Delta:"Î”",boxUR:"â•š",boxUL:"â•",oplus:"âŠ•",boxUr:"â•™",boxUl:"â•œ",doteq:"â‰",happy:"ã‹¡",varpi:"Ï–",smile:"â˜º",boxul:"â”˜",simeq:"â‰ƒ",boxuR:"â•˜",boxuL:"â•›",boxhd:"â”¬",gimel:"â„·",Gamma:"Î“",lnsim:"â‹¦",sqcup:"âŠ”",omega:"Ï‰",sharp:"â™¯",times:"Ã—",block:"â–ˆ","hat{}":"^",wedge:"âˆ§",vdash:"âŠ¢",angle:"âˆ ",infty:"âˆ",gamma:"Î³",asymp:"â‰",rceil:"âŒ‰","dot{}":"Ë™",lceil:"âŒˆ",delta:"Î´",gneqq:"â‰©",frown:"âŒ¢",phone:"â˜",vdots:"â‹®",boxr:"â””","k{i}":"Ä¯","`{I}":"ÃŒ",perp:"âŠ¥",'"{o}':"Ã¶","={I}":"Äª","`{a}":"Ã ","v{T}":"Å¤",surd:"âˆš","H{O}":"Å",vert:"|","k{I}":"Ä®",'"{y}':"Ã¿",'"{O}':"Ã–","u{u}":"Ñ","u{G}":"Ä",".{E}":"Ä–",".{z}":"Å¼","v{t}":"Å¥",prec:"â‰º","H{o}":"Å‘",mldr:"â€¦",cong:"â‰…",".{e}":"Ä—",star:"*",".{Z}":"Å»",geqq:"â‰§",cdot:"â‹…",cdots:"â€¦","`{U}":"Ã™","v{L}":"Ä½","c{s}":"ÅŸ","~{A}":"Ãƒ",Vert:"â€–","k{e}":"Ä™",lnot:"Â¬",leqq:"â‰¦",beta:"Î²",beth:"â„¶","~{n}":"Ã±","u{i}":"Ğ¹","c{S}":"Å","c{N}":"Å…","H{u}":"Å±","v{n}":"Åˆ","={U}":"Åª","~{O}":"Ã•","v{E}":"Äš","H{U}":"Å°","v{N}":"Å‡",prod:"âˆ","v{s}":"Å¡",'"{U}':"Ãœ","c{n}":"Å†","k{U}":"Å²","c{R}":"Å–","~{o}":"Ãµ","v{e}":"Ä›","v{S}":"Å ","u{A}":"Ä‚",circ:"âˆ˜",'"{u}':"Ã¼",flat:"â™­","v{z}":"Å¾","r{U}":"Å®","`{O}":"Ã’","={u}":"Å«",oint:"âˆ®","c{K}":"Ä¶","k{u}":"Å³","not<":"â‰®","not>":"â‰¯","`{o}":"Ã²",'"{I}':"Ã","v{D}":"Ä",".{G}":"Ä ","r{u}":"Å¯","not=":"â‰ ","`{u}":"Ã¹","v{c}":"Ä","c{k}":"Ä·",".{g}":"Ä¡",odot:"âŠ™","`{e}":"Ñ","c{T}":"Å¢","v{d}":"Ä",'"{e}':"Ñ‘","v{R}":"Å˜","k{a}":"Ä…",nldr:"â€¥","`{A}":"Ã€","~{N}":"Ã‘",nmid:"âˆ¤",".{C}":"ÄŠ",zeta:"Î¶","~{u}":"Å©","`{E}":"Ğ­","~{a}":"Ã£","c{t}":"Å£","={o}":"Å","v{r}":"Å™","={A}":"Ä€",".{c}":"Ä‹","~{U}":"Å¨","k{A}":"Ä„",'"{a}':"Ã¤","u{U}":"Ğ",iota:"Î¹","={O}":"ÅŒ","c{C}":"Ã‡",gneq:"â‰©",boxH:"â•",hbar:"â„",'"{A}':"Ã„",boxv:"â”‚",boxh:"â”€",male:"â™‚",sqrt:"âˆš",succ:"â‰»","c{c}":"Ã§","v{l}":"Ä¾","u{a}":"Äƒ","v{Z}":"Å½","c{G}":"Ä¢","v{C}":"ÄŒ",lneq:"â‰¨","{E}":"Ğ","={a}":"Ä","c{l}":"Ä¼","={E}":"Ä’",boxV:"â•‘","u{g}":"ÄŸ","u{I}":"Ğ™","c{L}":"Ä»","k{E}":"Ä˜",".{I}":"Ä°","~{I}":"Ä¨","c{r}":"Å—","{Y}":"Å¸","={e}":"Ä“",leq:"â‰¤",Cup:"â‹“",Psi:"Î¨",neq:"â‰ ","k{}":"Ë›","={}":"â€¾","H{}":"Ë",cup:"âˆª",geq:"â‰¥",mho:"â„§",Dzh:"Ğ",cap:"âˆ©",bot:"âŠ¥",psi:"Ïˆ",chi:"Ï‡","c{}":"Â¸",Phi:"Î¦",ast:"*",ell:"â„“",top:"âŠ¤",lll:"â‹˜",tau:"Ï„",Cap:"â‹’",sad:"â˜¹",iff:"â‡”",eta:"Î·",eth:"Ã°","d{":"\tÌ£",rho:"Ï",dzh:"ÑŸ",div:"Ã·",phi:"Ï•",Rsh:"â†±",vee:"âˆ¨","b{}":"Ë","t{":"\tÍ¡",int:"âˆ«",sim:"âˆ¼","r{}":"Ëš",Lsh:"â†°",yen:"Â¥",ggg:"â‹™",mid:"âˆ£",sum:"âˆ‘",neg:"Â¬",Dz:"Ğ…",Re:"â„œ",oe:"Å“",DH:"Ã",ll:"â‰ª",ng:"Å‹",wr:"â‰€",wp:"â„˜","=I":"Ğ†",":)":"â˜º",":(":"â˜¹",AE:"Ã†",AA:"Ã…",ss:"ÃŸ",dz:"Ñ•",ae:"Ã¦",aa:"Ã¥",th:"Ã¾",to:"â†’",Pi:"Î ",mp:"âˆ“",Im:"â„‘",pm:"Â±",pi:"Ï€",'"I':"Ğ‡",in:"âˆˆ",ni:"âˆ‹",ne:"â‰ ",TH:"Ã",Xi:"Î",nu:"Î½",NG:"ÅŠ",":G":"ã‹¡",xi:"Î¾",OE:"Å’",gg:"â‰«",DJ:"Ä","=e":"Ñ”","=E":"Ğ„",mu:"Î¼",dj:"Ä‘",S:"Â§",P:"Â¶",O:"Ã˜",L:"Å",o:"Ã¸",l:"Å‚",h:"â„",i:"â„¹","'{Y}":"Ã","'{y}":"Ã½","'{L}":"Ä¹","'{e}":"Ã©","'{l}":"Äº","'{s}":"Å›","'{z}":"Åº","'{E}":"Ã‰","'{S}":"Åš","'{Z}":"Å¹","'{R}":"Å”","'{A}":"Ã","'{N}":"Åƒ","'{I}":"Ã","'{n}":"Å„","'{c}":"Ä‡","'{u}":"Ãº","'{C}":"Ä†","'{o}":"Ã³","'{a}":"Ã¡","'{O}":"Ã“","'{g}":"Çµ","'{r}":"Å•","'{U}":"Ãš","'G":"Ğƒ","'C":"Ğ‹","'K":"ĞŒ","'k":"Ñœ","'c":"Ñ›","'g":"Ñ“"};function I(t){for(let e in H)t=t.replaceAll(e,H[e]);for(let e in D)t=t.replaceAll("\\"+e,D[e]);return t}function q(t){return[...I(t)].map((t=>N[t]||t)).join("")}const R={fill:"none",stroke:"black","stroke-width":"1","stroke-linecap":"butt","stroke-dasharray":"none","stroke-linejoin":"round","vector-effect":"non-scaling-stroke",opacity:"1"},j=Object.assign({},R),B={fill:"black",stroke:"none","stroke-width":"1","stroke-linecap":"butt","stroke-dasharray":"none","stroke-linejoin":"round","vector-effect":"non-scaling-stroke",opacity:"1"},P=Object.assign({},B),F={text:"","font-family":"Latin Modern Math, sans-serif","font-size":c,"font-weight":"normal","text-anchor":"middle",dy:"0.25em",angle:"0","font-style":"normal","font-scale":"auto"},G=Object.assign({},F);function V(){for(let t in R)R[t]=j[t];for(let t in B)B[t]=P[t];for(let t in F)F[t]=G[t]}const $=new Map;function U(t,e,n,i){let r=document.createElementNS("http://www.w3.org/2000/svg","image");if(r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),null==e.imgdata.src)return;if(null==e.path)return;if(4!=e.path.points.length)return;let s=e.path.points[1].sub(e.path.points[0]).length(),a=e.path.points[2].sub(e.path.points[1]).length(),l=e.path.points[1].sub(e.path.points[0]).normalize(),o=e.path.points[3].sub(e.path.points[0]).normalize(),c=l.x,h=-l.y,d=-o.x,u=o.y,g=e.path.points[3].x,p=-e.path.points[3].y;n?function(t,e){if(/^data:image\/(png|jpeg|jpg|gif|svg\+xml);base64,/.test(e))return t.setAttribute("href",e),void t.setAttribute("xlink:href",e);if($.has(e)){const n=$.get(e);if(!n)return;return t.setAttribute("href",n),void t.setAttribute("xlink:href",n)}let n=document.createElement("canvas"),i=n.getContext("2d"),r=new Image;r.crossOrigin="anonymous",r.onload=()=>{n.height=r.height,n.width=r.width,null==i||i.drawImage(r,0,0);const s=n.toDataURL("image/png");t.setAttribute("href",s),t.setAttribute("xlink:href",s),$.set(e,s),n.remove()},r.src=e}(r,e.imgdata.src):r.setAttribute("href",e.imgdata.src),r.setAttribute("width",s.toString()),r.setAttribute("height",a.toString()),r.setAttribute("transform",`matrix(${c} ${h} ${d} ${u} ${g} ${p})`),r.setAttribute("preserveAspectRatio","none"),null!=i&&r.setAttribute("_dg_tag",i),t.appendChild(r)}function X(t,e){if(t.type==e)return[t];if(t.type==a.Diagram){let n=[];for(let i of t.children)n=n.concat(X(i,e));return n}return[]}function W(t,e){const n=T(null!=e?e:0);let i=t.getBBox(),r=t.width.baseVal.value-n[1]-n[3],s=t.height.baseVal.value-n[0]-n[2];return Math.max(i.width/r,i.height/s)}function J(t,e){var n;let i=[];for(let r in e.children){let s=e.children[r];s instanceof SVGElement&&(s.getAttribute("_dg_tag")==t&&i.push(s),(null===(n=s.children)||void 0===n?void 0:n.length)&&(i=i.concat(J(t,s))))}return i}function Y(t,e,n,i=!0,r=!1,l,o){if(n.type==a.Polygon)!function(t,e,n,i){let r=Object.assign(Object.assign({},R),n.style);r.fill=w(r.fill,x),r.stroke=w(r.stroke,x);let s=t.querySelector("defs");if(s||(s=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.appendChild(s)),"object"==typeof(a=r.fill)&&"linearGradient"===a.type){const t=`gradient-${Math.random().toString(36).substr(2,9)}`,e=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");let{x1:n,x2:i,y1:a,y2:l}=r.fill;e.setAttribute("id",t),e.setAttribute("x1",n||"0%"),e.setAttribute("y1",a||"0%"),e.setAttribute("x2",i||"100%"),e.setAttribute("y2",l||"0%"),r.fill.stops.forEach((t=>{const n=document.createElementNS("http://www.w3.org/2000/svg","stop");n.setAttribute("offset",t.offset),n.setAttribute("stop-color",w(t.color,x)),void 0!==t.opacity&&n.setAttribute("stop-opacity",t.opacity.toString()),e.appendChild(n)})),s.appendChild(e),r.fill=`url(#${t})`}else r.fill=w(r.fill,x);var a;let l=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t in r)l.style[t]=r[t];if(null!=i&&l.setAttribute("_dg_tag",i),e.appendChild(l),null!=n.path)for(let e=0;e<n.path.points.length;e++){let i=n.path.points[e];var o=t.createSVGPoint();o.x=i.x,o.y=-i.y,l.points.appendItem(o)}}(t,e,n,o);else if(n.type==a.Curve)!function(t,e,n,i){let r=Object.assign(Object.assign({},R),n.style);r.fill="none",r.stroke=w(r.stroke,x);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");for(let t in r)s.style[t]=r[t];if(null!=i&&s.setAttribute("_dg_tag",i),e.appendChild(s),null!=n.path)for(let e=0;e<n.path.points.length;e++){let i=n.path.points[e];var a=t.createSVGPoint();a.x=i.x,a.y=-i.y,s.points.appendItem(a)}}(t,e,n,o);else if(n.type==a.Text||n.type==a.MultilineText);else if(n.type==a.Image)U(e,n,r,o);else if(n.type==a.Diagram)for(let i of n.children)Y(t,e,i,!1,r,void 0,o);else console.warn("Unreachable, unknown diagram type : "+n.type);if(i){null==l&&(l=W(t));let i=X(n,a.Text),r=X(n,a.MultilineText);!function(t,e,n,i){for(let r of e){let e=Object.assign(Object.assign({},B),r.style);e.fill=w(e.fill,x),e.stroke=w(e.stroke,x);let a=Object.assign(Object.assign({},F),r.textdata);if(null==r.path)throw new Error("Text must have a path");let l=document.createElementNS("http://www.w3.org/2000/svg","text"),o=r.path.points[0].x,c=-r.path.points[0].y,h=E(parseFloat(a.angle)),d="auto"==a["font-scale"]?n:parseFloat(a["font-scale"]),u=parseFloat(a["font-size"])*d;l.setAttribute("font-family",a["font-family"]),l.setAttribute("font-style",a["font-style"]),l.setAttribute("font-size",u.toString()),l.setAttribute("font-weight",a["font-weight"]),l.setAttribute("text-anchor",a["text-anchor"]),l.setAttribute("dy",a.dy),l.setAttribute("transform",`translate(${o} ${c}) rotate(${h}) `),null!=i&&l.setAttribute("_dg_tag",i),l.setAttribute("_x",o.toString()),l.setAttribute("_y",c.toString()),l.setAttribute("_angle",h.toString());for(let t in e)l.style[t]=e[t];let g=a.text;r.tags.includes(s.TEXTVAR)&&!Z(g)&&(g=q(g)),l.innerHTML=g,t.appendChild(l)}}(e,i,null!=l?l:1,o),function(t,e,n,i){var r,s,a,l,o;for(let c of e){if(null==c.path)throw new Error("Text must have a path");let e=document.createElementNS("http://www.w3.org/2000/svg","text"),h=c.path.points[0].x,d=-c.path.points[0].y,u=0,g=Object.assign(Object.assign(Object.assign({},F),{dy:"0","text-anchor":"start"}),c.textdata),p=g["font-size"];if(null==(null===(r=c.multilinedata)||void 0===r?void 0:r.content))throw new Error("MultilineText must have multilinedata");let _=null!==(s=c.multilinedata["scale-factor"])&&void 0!==s?s:1,m=!0,f=!0,b="1em";for(let t of c.multilinedata.content){if("\n"==t.text){f=!0,b=null!==(a=t.style.dy)&&void 0!==a?a:"1em";continue}let i=document.createElementNS("http://www.w3.org/2000/svg","tspan"),r=null==t.style.dy,s=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},B),g),{dy:"0",dx:"0"}),{"font-size":p}),t.style);if(f){i.setAttribute("x","0");let t=null!==(l=g.dy)&&void 0!==l?l:"0";r&&(s.dy=m?t:b),f=!1}let c="auto"==s["font-scale"]?n:parseFloat(s["font-scale"]),h=null!==(o=s["font-size-scale-factor"])&&void 0!==o?o:1,d=parseFloat(s["font-size"])*c*_*h;s.tag&&i.setAttribute("_dg_tag",s.tag),i.style.whiteSpace="pre",i.setAttribute("dx",s.dx),i.setAttribute("dy",s.dy),i.setAttribute("font-style",s["font-style"]),i.setAttribute("font-family",s["font-family"]),i.setAttribute("font-size",d.toString()),i.setAttribute("font-weight",s["font-weight"]),i.style.fill=w(s.fill,x),i.style.stroke=w(s.stroke,x),i.style.opacity=s.opacity,s["baseline-shift"]&&i.setAttribute("baseline-shift",s["baseline-shift"]);let u=t.text;s.textvar&&(u=q(u)),i.innerHTML=u,e.appendChild(i),m=!1}e.setAttribute("dy",g.dy),e.setAttribute("text-anchor",g["text-anchor"]),e.setAttribute("transform",`translate(${h} ${d}) rotate(${u}) `),null!=i&&e.setAttribute("_dg_tag",i),t.appendChild(e)}}(e,r,null!=l?l:1,o)}}function K(t,e,n=!0,i=!0,r=!0){Q(t,e,{set_html_attribute:n,render_text:i,clear_svg:r})}function Q(t,e,n={}){var i,r,s,a,l,o,c;const h=null===(i=n.set_html_attribute)||void 0===i||i,d=null===(r=n.render_text)||void 0===r||r,u=null===(s=n.clear_svg)||void 0===s||s,g=null!==(a=n.embed_image)&&void 0!==a&&a;let p,_;for(let e in t.children){let n=t.children[e];if(n instanceof SVGSVGElement&&"diagram_svg"==n.getAttribute("meta")){p=n;break}}if(null==p&&(p=document.createElementNS("http://www.w3.org/2000/svg","svg"),p.setAttribute("meta","diagram_svg"),p.setAttribute("width","100%"),p.setAttribute("height","100%"),t.appendChild(p)),function(t,e){if(null==e||0==e.length)return;let n=t.querySelector("defs");null==n&&(n=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(n,t.firstChild));n.innerHTML="";for(let t of e)n.innerHTML+=t}(t,n.filter_strings),n.text_scaling_reference_svg&&(n.text_scaling_reference_padding=null!==(o=null!==(l=n.text_scaling_reference_padding)&&void 0!==l?l:n.padding)&&void 0!==o?o:10,n.text_scaling_reference_padding=T(n.text_scaling_reference_padding),_=W(n.text_scaling_reference_svg,n.text_scaling_reference_padding)),u&&(p.innerHTML=""),Y(p,p,e,d,g,_),h){const e=T(null!==(c=n.padding)&&void 0!==c?c:10);let i=p.getBBox(),r=p.width.baseVal.value-e[1]-e[3],s=p.height.baseVal.value-e[0]-e[2],a=Math.max(i.width/r,i.height/s),l=e.map((t=>t*a));i.x-=l[3],i.y-=l[0],i.width+=l[1]+l[3],i.height+=l[0]+l[2],p.setAttribute("viewBox",`${i.x} ${i.y} ${i.width} ${i.height}`),p.setAttribute("preserveAspectRatio","xMidYMid meet"),t.style.overflow="visible"}if(n.background_color){let t=p.getBBox();0!==p.viewBox.baseVal.width&&(t=p.viewBox.baseVal);let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",t.x.toString()),e.setAttribute("y",t.y.toString()),e.setAttribute("width",t.width.toString()),e.setAttribute("height",t.height.toString()),e.style.fill=w(n.background_color,x),e.style.stroke="none",p.insertBefore(e,p.firstChild)}}function Z(t){return t.startsWith("$")&&t.endsWith("$")}function tt(t){return t.startsWith("$$")&&t.endsWith("$$")}function et(t,e){for(let i=0;i<t.children.length;i++){let r=t.children[i];if(r instanceof SVGTextElement){let s=r.innerHTML;if(!Z(s))continue;let a=r.getAttribute("font-size");if(null==a)continue;let l=parseFloat(a),o=e(tt(n=s)?n.substring(2,n.length-2):Z(n)?n.substring(1,n.length-1):n,{display:tt(s)}),c=r.getAttribute("_x"),h=r.getAttribute("_y");if(null==c||null==h)continue;let d=r.getAttribute("text-anchor"),u=r.getAttribute("dy");if(null==d||null==u)continue;r.outerHTML=o,r=t.children[i];let g=r.getAttribute("width");if(null==g)continue;let p=parseFloat(g.substring(0,g.length-2)),_=r.getAttribute("height");if(null==_)continue;const m=2;let f=p*l/m,b=parseFloat(_.substring(0,_.length-2))*l/m,v=parseFloat(c),y=parseFloat(h);switch(d){case"start":break;case"middle":v-=f/2;break;case"end":v-=f}switch(u){case"0.75em":break;case"0.25em":y-=b/2;break;case"-0.25em":y-=b}r.setAttribute("width",f.toString()),r.setAttribute("height",b.toString()),r.setAttribute("x",v.toString()),r.setAttribute("y",y.toString())}else r instanceof SVGElement&&et(r,e)}var n}function nt(t){let e=t.querySelector("svg[meta=diagram_svg]");if(null==e)return void console.warn("Cannot find svg element");let n=t.querySelector("svg[meta=control_svg]"),i=e;if(null!=n){let t=e.cloneNode(!0);for(let e in n.children){let i=n.children[e];i instanceof SVGSVGElement&&t.appendChild(i.cloneNode(!0))}i=t}let r=(new XMLSerializer).serializeToString(i),s=new Blob([r],{type:"image/svg+xml"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="diagramatics.svg",l.click()}function it(t){if(null==t.querySelector("svg[meta=diagram_svg]"))return void console.warn("Cannot find svg element");let e=t,n=(new XMLSerializer).serializeToString(e),i=new Blob([n],{type:"image/svg+xml"});const r=window.URL||window.webkitURL||window,s=r.createObjectURL(i),a=new Image;a.width=e.width.baseVal.value,a.height=e.height.baseVal.value,a.src=s,a.onload=function(){const t=document.createElement("canvas");t.width=a.width,t.height=a.height;const e=t.getContext("2d");null==e||e.drawImage(a,0,0),r.revokeObjectURL(s);const n=t.toDataURL("image/png").replace("image/png","image/octet-stream"),i=document.createElement("a");i.href=n,i.download="diagramatics.png",i.click()}}function rt(t,n){return _([e(-t/2,-n/2),e(t/2,-n/2),e(t/2,n/2),e(-t/2,n/2)])}function st(t,n){return _([t,e(n.x,t.y),n,e(t.x,n.y)])}function at(t=1){return rt(t,t)}function lt(t,n=1){let i=[];for(let r=0;r<t;r++)i.push(e(0,n).rotate(2*r*Math.PI/t));return _(i)}function ot(t,e=1){return lt(t,e/(2*Math.sin(Math.PI/t)))}function ct(t=1){return lt(50,t).append_tags(s.CIRCLE)}function ht(t=1,n=k(360)){let i=[];for(let r=0;r<100;r++)i.push(e(t,0).rotate(r*n/99));return g(i)}function dt(t,n=1){return u(p(e(0,0),t).append_tags(s.ARROW_LINE),_([e(0,0),e(-n,n/2),e(-n,-n/2)]).rotate(t.angle()).position(t).append_tags(s.ARROW_HEAD))}function ut(t,e,n=1){return dt(e.sub(t),n).position(t)}function gt(t,n,i=1){let r=p(t,n).append_tags(s.ARROW_LINE),a=n.sub(t),l=_([e(0,0),e(-i,i/2),e(-i,-i/2)]);return u(r,l.rotate(a.angle()).position(n).append_tags(s.ARROW_HEAD),l.rotate(a.angle()+Math.PI).position(t).append_tags(s.ARROW_HEAD))}function pt(t){return f(t).append_tags(s.TEXTVAR)}function _t(t){if(!t.tags.includes(s.CIRCLE))return-1;let e=t.get_anchor("center-center");if(null==t.path)return-1;let n=t.path.points[0];return e.sub(n).length()}function mt(t){return t.tags.includes(s.LINE)?null==t.path?[e(0,0),e(0,0)]:[t.path.points[0],t.path.points[1]]:[e(0,0),e(0,0)]}function ft(t){let e=t.bounding_box();return[e[1].x-e[0].x,e[1].y-e[0].y]}var bt=Object.freeze({__proto__:null,area:function t(e){var n,i;return e.type==a.Polygon?function(t){let e=0;const n=t.length;for(let i=0;i<n;i++){const r=(i+1)%n,s=t[i].x,a=t[i].y,l=t[r].x;e+=s*t[r].y-l*a}return Math.abs(e)/2}(null!==(i=null===(n=e.path)||void 0===n?void 0:n.points)&&void 0!==i?i:[]):e.type==a.Diagram?e.children.reduce(((e,n)=>e+t(n)),0):0},circle_radius:_t,circle_tangent_point_from_point:function(t,n){let i=_t(n);if(-1==i)return[e(0,0),e(0,0)];let r=n.get_anchor("center-center"),s=i,a=r.sub(t).length_sq(),l=s*s,o=t.sub(r),c=l/a,h=o.scale(c),d=s*Math.sqrt(a-l)/a,u=e(-o.y,o.x).scale(d);return[h.add(u).add(r),h.sub(u).add(r)]},line_extend:function(t,e,n){if(!t.tags.includes(s.LINE))return t;if(null==t.path)return t;let i=t.path.points[0],r=t.path.points[1],a=r.sub(i).normalize(),l=i.sub(a.scale(e)),o=r.add(a.scale(n)),c=t.copy();return null==c.path?t:(c.path.points=[l,o],c)},line_intersection:function(t,n){if(!t.tags.includes(s.LINE)||!n.tags.includes(s.LINE))return e(1/0,1/0);let[i,r]=mt(t),[a,l]=mt(n),o=i.x,c=i.y,h=r.x,d=r.y,u=a.x,g=a.y,p=l.x,_=l.y,m=(o-h)*(g-_)-(c-d)*(u-p);return 0==m?e(1/0,1/0):e(((o*d-c*h)*(u-p)-(o-h)*(u*_-g*p))/m,((o*d-c*h)*(g-_)-(c-d)*(u*_-g*p))/m)},line_intersection_x:function(t,n){let[i,r]=mt(t);return e(n,i.y+(r.y-i.y)*(n-i.x)/(r.x-i.x))},line_intersection_y:function(t,n){let[i,r]=mt(t);return e(i.x+(r.x-i.x)*(n-i.y)/(r.y-i.y),n)},line_points:mt,size:ft});function vt(t,n="center"){if(0==t.length)return m();let i=[...t];if("top"==n){let t=i[0].get_anchor("top-left").y;for(let n=0;n<i.length;n++)i[n]=i[n].translate(e(0,t-i[n].get_anchor("top-left").y));return u(...i)}if("center"==n){let t=i[0].get_anchor("center-left").y;for(let n=0;n<i.length;n++)i[n]=i[n].translate(e(0,t-i[n].get_anchor("center-left").y));return u(...i)}if("bottom"==n){let t=i[0].get_anchor("bottom-left").y;for(let n=0;n<i.length;n++)i[n]=i[n].translate(e(0,t-i[n].get_anchor("bottom-left").y));return u(...i)}throw new Error("Unknown vertical alignment : "+n)}function yt(t,n="center"){if(0==t.length)return m();let i=[...t];if("left"==n){let t=i[0].get_anchor("top-left").x;for(let n=0;n<i.length;n++)i[n]=i[n].translate(e(t-i[n].get_anchor("top-left").x,0));return u(...i)}if("center"==n){let t=i[0].get_anchor("top-center").x;for(let n=0;n<i.length;n++)i[n]=i[n].translate(e(t-i[n].get_anchor("top-center").x,0));return u(...i)}if("right"==n){let t=i[0].get_anchor("top-right").x;for(let n=0;n<i.length;n++)i[n]=i[n].translate(e(t-i[n].get_anchor("top-right").x,0));return u(...i)}throw new Error("Unknown horizontal alignment : "+n)}function xt(t,n=0){if(0==t.length)return m();let i=[...t],r=[i[0]];for(let t=1;t<i.length;t++){let s=r[t-1],a=i[t],l=s.get_anchor("top-right").x-a.get_anchor("top-left").x+n;r.push(a.translate(e(l,0)))}return u(...r)}function wt(t,n=0){if(0==t.length)return m();let i=[...t],r=[i[0]];for(let t=1;t<i.length;t++){let s=r[t-1],a=i[t],l=s.get_anchor("bottom-left").y-a.get_anchor("top-left").y-n;r.push(a.translate(e(0,l)))}return u(...r)}function kt(t,e=0,n="center"){return xt(vt(t,n).children,e)}function Et(t,e=0,n="center"){return wt(yt(t,n).children,e)}function At(t,e,n=0,i=0){if(0==t.length)return m();let r=[...t],s=Math.ceil(r.length/e),a=[];for(let t=0;t<s;t++)a.push(r.slice(t*e,(t+1)*e));let l=wt(a.map((t=>xt(t,i))),n),o=[];for(let t=0;t<l.children.length;t++)for(let e=0;e<l.children[t].children.length;e++)o.push(l.children[t].children[e]);return u(...o)}function St(t,e,n=0,i=0,r="center",s="left"){if(0==t.length)return m();let a=[],l=[],o=0;function c(t){let e=kt(t,i,r);a.push(e),l=[],o=0}for(let n=0;n<t.length;n++){let r=t[n],s=ft(r)[0];s>e?(l.length>0&&c(l),l.push(r),c(l)):(o+i+s>e&&c(l),l.push(r),o+=s+i)}l.length>0&&c(l);let h=Et(a,n,s),d=[];for(let t=0;t<h.children.length;t++)for(let e=0;e<h.children[t].children.length;e++)d.push(h.children[t].children[e]);return u(...d)}const Ot="diagramatics-focusrect";const Lt=(t,e,n)=>{let i="number"==typeof e&&null!=n?function(t,e){return t.toFixed(e).replace(/\.?0+$/,"")}(e,n):e.toString();return`${q(t)} = ${i}`};var Ct,Mt,Tt;!function(t){t.locator="control_svg",t.dnd="dnd_svg",t.custom="custom_int_svg",t.button="button_svg"}(Ct||(Ct={})),function(t){t.DOCUMENT="document",t.SVG="svg"}(Mt||(Mt={}));class zt{constructor(t,e,n,i=Mt.SVG){this.control_container_div=t,this.diagram_outer_svg=e,this.event_target=i,this.inp_variables={},this.inp_setter={},this.display_mode="svg",this.diagram_svg=void 0,this.locator_svg=void 0,this.dnd_svg=void 0,this.custom_svg=void 0,this.button_svg=void 0,this.locatorHandler=void 0,this.dragAndDropHandler=void 0,this.buttonHandler=void 0,this.focus_padding=1,this.draw_function=t=>{},this.display_precision=5,this.intervals={},this.registeredEventListenerRemoveFunctions=[],this.single_int_mode=!1,null!=n&&(this.inp_variables=n)}draw(){var t,e;this.draw_function(this.inp_variables,this.inp_setter),null===(t=this.locatorHandler)||void 0===t||t.setViewBox(),null===(e=this.dragAndDropHandler)||void 0===e||e.setViewBox(),Nt(this.custom_svg,this.diagram_svg),Nt(this.button_svg,this.diagram_svg)}set(t,e){this.inp_setter[t](e)}get(t){return this.inp_variables[t]}label(t,e,n="white",i="square",r="#8B5CF6",s=Lt){let a=document.createElement("div");a.classList.add("diagramatics-label-container"),a.style.display="flex",a.style.alignItems="center",a.style.gap="8px";let l=document.createElement("div");l.classList.add("diagramatics-label-mark"),l.style.width="12px",l.style.height="12px",l.style.backgroundColor=r,"circle"===i&&(l.style.borderRadius="50%");let o=document.createElement("div");o.classList.add("diagramatics-label"),o.innerHTML=s(t,e,this.display_precision),o.style.color=n,a.appendChild(l),a.appendChild(o),this.inp_variables[t]=e;this.inp_setter[t]=e=>{this.inp_variables[t]=e,o.innerHTML=s(t,e,this.display_precision)};let c=document.createElement("div");c.classList.add("diagramatics-label-container"),c.appendChild(a),this.control_container_div.appendChild(c)}locator_draw(){var t;null===(t=this.locatorHandler)||void 0===t||t.setViewBox()}locator_initial_draw(){var t;null===(t=this.locatorHandler)||void 0===t||t.setViewBox()}drag_and_drop_initial_draw(){this.dnd_initial_draw()}dnd_initial_draw(){var t,e;null===(t=this.dragAndDropHandler)||void 0===t||t.setViewBox(),null===(e=this.dragAndDropHandler)||void 0===e||e.drawSvg()}registerEventListener(t,e,n,i){t.addEventListener(e,n,i);this.registeredEventListenerRemoveFunctions.push((()=>t.removeEventListener(e,n)))}removeRegisteredEventListener(){this.registeredEventListenerRemoveFunctions.forEach((t=>t())),this.registeredEventListenerRemoveFunctions=[]}get_svg_element(t,e=!1){var n;if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let i;for(let e in this.diagram_outer_svg.children){let n=this.diagram_outer_svg.children[e];n instanceof SVGSVGElement&&n.getAttribute("meta")==t&&(i=n)}return this.single_int_mode&&e&&null!=i&&(null===(n=i.remove)||void 0===n||n.call(i),i=void 0),null==i&&(i=document.createElementNS("http://www.w3.org/2000/svg","svg"),i.setAttribute("meta",t),i.setAttribute("width","100%"),i.setAttribute("height","100%"),this.isTargetingDocument()&&(i.style.overflow="visible"),this.diagram_outer_svg.appendChild(i)),i}get_diagram_svg(){let t=this.get_svg_element("diagram_svg");return this.diagram_svg=t,t}isTargetingDocument(){return this.event_target==Mt.DOCUMENT}set_focus_padding(t){this.focus_padding=t,this.dragAndDropHandler&&(this.dragAndDropHandler.focus_padding=t),this.buttonHandler&&(this.buttonHandler.focus_padding=t)}locator(t,e,n,i="blue",r,s=!0,l){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");this.inp_variables[t]=e;let o=this.get_diagram_svg(),c=this.get_svg_element(Ct.locator,!this.locator_svg);if(this.locator_svg=c,null==this.locatorHandler){let t=new Rt(c,o);this.locatorHandler=t;const e=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(e,"mousemove",(e=>{t.drag(e)})),this.registerEventListener(e,"mouseup",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchmove",(e=>{t.drag(e)})),this.registerEventListener(e,"touchend",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchcancel",(e=>{t.endDrag(e)}))}this.locatorHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,l&&n&&l(t,e),n&&this.draw()}));let h,d=this.locatorHandler.create_locator_circle_pointer_svg(t,n,e,i,s);if(s){let t=d.getElementsByClassName("diagramatics-locator-blink");for(let e=0;e<t.length;e++)this.locatorHandler.addBlinkingCircleOuter(t[e])}if(this.registerEventListener(d,"mousedown",(e=>{this.locatorHandler.startDrag(e,t,d)})),this.registerEventListener(d,"touchstart",(e=>{this.locatorHandler.startDrag(e,t,d)})),r){if(r.type!=a.Polygon&&r.type!=a.Curve)throw Error("Track diagram must be a polygon or curve");if(null==r.path)throw Error("diagram {diagtam.type} must have a path");let t=r.path.points;h=e=>{let n=Ht(e,t);return d.setAttribute("transform",`translate(${n.x},${-n.y})`),n}}else h=t=>(d.setAttribute("transform",`translate(${t.x},${-t.y})`),t);this.locatorHandler.registerSetter(t,h),this.inp_setter[t]=h;let u=h(e);this.locatorHandler.setPos(t,u)}locator_custom(t,e,n,i,r=!0,s,l){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");this.inp_variables[t]=e;let o=this.get_diagram_svg(),c=this.get_svg_element(Ct.locator,!this.locator_svg);if(this.locator_svg=c,null==this.locatorHandler){let t=new Rt(c,o);this.locatorHandler=t;const e=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(e,"mousemove",(e=>{t.drag(e)})),this.registerEventListener(e,"mouseup",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchmove",(e=>{t.drag(e)})),this.registerEventListener(e,"touchend",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchcancel",(e=>{t.endDrag(e)}))}this.locatorHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,s&&n&&s(t,e),n&&this.draw()}));let h,d=this.locatorHandler.create_locator_diagram_svg(t,n,r);if(this.registerEventListener(d,"mousedown",(e=>{this.locatorHandler.startDrag(e,t,d)})),this.registerEventListener(d,"touchstart",(e=>{this.locatorHandler.startDrag(e,t,d)})),l&&this.registerEventListener(d,"contextmenu",(e=>{e.preventDefault(),l(t)})),i){if(i.type!=a.Polygon&&i.type!=a.Curve)throw Error("Track diagram must be a polygon or curve");if(null==i.path)throw Error("diagram {diagtam.type} must have a path");let t=i.path.points;h=e=>{let n=Ht(e,t);return d.setAttribute("transform",`translate(${n.x},${-n.y})`),n}}else h=t=>(d.setAttribute("transform",`translate(${t.x},${-t.y})`),t);this.locatorHandler.registerSetter(t,h),this.inp_setter[t]=h;let u=h(e);this.locatorHandler.setPos(t,u)}slider(t,e=0,n=100,i=50,r=-1,s=1.5,a=Lt){-1==r&&(r=(n-e)/100),this.inp_variables[t]=i;let l=document.createElement("div");l.classList.add("diagramatics-label"),l.innerHTML=a(t,i,this.display_precision);const o=(e,n=!0)=>{this.inp_variables[t]=e,l.innerHTML=a(t,e,this.display_precision),n&&this.draw()};let c=function(t,e=0,n=100,i=50,r){let s=document.createElement("input");return s.type="range",s.min=e.toString(),s.max=n.toString(),s.value=i.toString(),s.step=r.toString(),s.oninput=()=>{let e=s.value;t(parseFloat(e))},s.classList.add("diagramatics-slider"),s}(o,e,n,i,r);this.inp_setter[t]=t=>{c.value=t.toString(),o(t,!1)};const h=1e3*s/((n-e)/r);let d=document.createElement("button"),u=document.createElement("div");u.classList.add("diagramatics-slider-playbutton-symbol"),d.appendChild(u),d.classList.add("diagramatics-slider-playbutton"),d.onclick=()=>{null==this.intervals[t]?(d.classList.add("paused"),this.intervals[t]=setInterval((()=>{let t=parseFloat(c.value);t+=r,t=(t-e)%(n-e)+e,c.value=t.toString(),o(t)}),h)):(d.classList.remove("paused"),clearInterval(this.intervals[t]),this.intervals[t]=void 0)};let g=document.createElement("div");g.classList.add("diagramatics-slider-leftcontainer"),g.appendChild(document.createElement("br")),g.appendChild(d);let p=document.createElement("div");p.classList.add("diagramatics-slider-rightcontainer"),p.appendChild(l),p.appendChild(c);let _=document.createElement("div");_.classList.add("diagramatics-slider-container"),_.appendChild(g),_.appendChild(p),this.control_container_div.appendChild(_)}init_drag_and_drop(){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let t=this.get_diagram_svg(),e=this.get_svg_element(Ct.dnd,!this.dnd_svg);if(this.dnd_svg=e,null==this.dragAndDropHandler){let n=new jt(e,t);n.focus_padding=this.focus_padding,this.dragAndDropHandler=n;const i=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(i,"mousemove",(t=>{n.drag(t)})),this.registerEventListener(i,"mouseup",(t=>{n.endDrag(t)})),this.registerEventListener(i,"touchmove",(t=>{n.drag(t)})),this.registerEventListener(i,"touchend",(t=>{n.endDrag(t)})),this.registerEventListener(i,"touchcancel",(t=>{n.endDrag(t)}))}}dnd_container(t,e,n,i){var r;this.init_drag_and_drop(),null===(r=this.dragAndDropHandler)||void 0===r||r.add_container(t,e,n,i)}dnd_draggable_to_container(t,e,n,i,r){if(this.init_drag_and_drop(),null==this.dragAndDropHandler)throw Error("dragAndDropHandler in Interactive class is undefined");this.inp_variables[t]=e.origin,this.dragAndDropHandler.add_draggable_to_container(t,e,n);this.dragAndDropHandler.registerCallback(t,((e,r=!0)=>{this.inp_variables[t]=e,i&&i(t,n),r&&this.draw()})),r&&this.dragAndDropHandler.register_clickstart_callback(t,r)}dnd_draggable(t,e,n,i,r){if(this.init_drag_and_drop(),null==this.dragAndDropHandler)throw Error("dragAndDropHandler in Interactive class is undefined");this.inp_variables[t]=e.origin,this.dragAndDropHandler.add_draggable_with_container(t,e,n);this.dragAndDropHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,i&&i(t,e),n&&this.draw()})),r&&this.dragAndDropHandler.register_clickstart_callback(t,r)}dnd_register_drop_outside_callback(t){var e;this.init_drag_and_drop(),null===(e=this.dragAndDropHandler)||void 0===e||e.register_dropped_outside_callback(t)}dnd_register_move_validation_function(t){var e;this.init_drag_and_drop(),null===(e=this.dragAndDropHandler)||void 0===e||e.register_move_validation_function(t)}dnd_move_to_container(t,e){var n;null===(n=this.dragAndDropHandler)||void 0===n||n.try_move_draggable_to_container(t,e)}get_dnd_data(){var t,e;return null!==(e=null===(t=this.dragAndDropHandler)||void 0===t?void 0:t.getData())&&void 0!==e?e:[]}set_dnd_data(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.setData(t)}dnd_reorder_tabindex(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.reorder_svg_container_tabindex(t)}get_dnd_container_content_size(t){return this.dragAndDropHandler?this.dragAndDropHandler.get_container_content_size(t):[NaN,NaN]}set_dnd_content_sort(t){this.dragAndDropHandler&&(this.dragAndDropHandler.sort_content=t)}remove_dnd_draggable(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.remove_draggable(t)}remove_locator(t){var e;null===(e=this.locatorHandler)||void 0===e||e.remove(t)}remove_button(t){var e;null===(e=this.buttonHandler)||void 0===e||e.remove(t)}custom_object(t,e,n){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let i=this.get_diagram_svg(),r=this.get_svg_element(Ct.custom,!this.custom_svg),s=document.createElementNS("http://www.w3.org/2000/svg","svg");return Y(s,s,n,!0,!1,W(i)),s.setAttribute("overflow","visible"),s.setAttribute("class",e.join(" ")),s.setAttribute("id",t),r.setAttribute("viewBox",i.getAttribute("viewBox")),r.setAttribute("preserveAspectRatio",i.getAttribute("preserveAspectRatio")),r.style.overflow="visible",r.appendChild(s),this.custom_svg=r,s}custom_object_g(t,e,n){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let i=this.get_diagram_svg(),r=this.get_svg_element(Ct.custom,!this.custom_svg),s=document.createElementNS("http://www.w3.org/2000/svg","g");return Y(r,s,n,!0,!1,W(i)),s.setAttribute("overflow","visible"),s.setAttribute("class",e.join(" ")),s.setAttribute("id",t),r.setAttribute("viewBox",i.getAttribute("viewBox")),r.setAttribute("preserveAspectRatio",i.getAttribute("preserveAspectRatio")),r.style.overflow="visible",r.appendChild(s),this.custom_svg=r,s}init_button(){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let t=this.get_diagram_svg(),e=this.get_svg_element(Ct.button,!this.button_svg);if(this.button_svg=e,null==this.buttonHandler){let n=new Bt(e,t);n.focus_padding=this.focus_padding,this.buttonHandler=n}}button_toggle(t,e,n,i=!1,r){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");let s;this.inp_variables[t]=i,s=r?(e,n=!0)=>{this.inp_variables[t]=e,r(t,e),n&&this.draw()}:(e,n=!0)=>{this.inp_variables[t]=e,n&&this.draw()};let a=this.buttonHandler.try_add_toggle(t,e,n,i,s);this.inp_setter[t]=a}button_click(t,e,n,i){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");this.buttonHandler.try_add_click(t,e,n,e,(()=>{i(),this.draw()}))}button_click_hover(t,e,n,i,r){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");this.buttonHandler.try_add_click(t,e,n,i,(()=>{r(),this.draw()}))}}function Nt(t,e){null!=t&&null!=e&&(t.setAttribute("viewBox",e.getAttribute("viewBox")),t.setAttribute("preserveAspectRatio",e.getAttribute("preserveAspectRatio")))}function Ht(t,e){if(0==e.length)return t;let n=1/0,i=e[0];for(let r=0;r<e.length;r++){let s=e[r].sub(t).length_sq();s<n&&(n=s,i=e[r])}return i}function Dt(t,e){let n;return n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?function(t){let e=t.getScreenCTM(),n=t.width.baseVal.value,i=t.height.baseVal.value,r=t.viewBox.baseVal,s=n/r.width,a=i/r.height,l=Math.min(s,a),o=n/2-(r.width/2+r.x)*l,c=i/2-(r.height/2+r.y)*l;return DOMMatrix.fromMatrix(e).translate(o,c).scale(l)}(e):e.getScreenCTM(),{x:(t.x-n.e)/n.a,y:-(t.y-n.f)/n.d}}function It(t,e){return window.TouchEvent&&t instanceof TouchEvent&&(t=t.touches[0]),Dt({x:t.clientX,y:t.clientY},e)}function qt(t,e){return It(t,e)}class Rt{constructor(t,n){this.control_svg=t,this.diagram_svg=n,this.selectedElement=null,this.selectedVariable=null,this.mouseOffset=e(0,0),this.callbacks={},this.setter={},this.svg_elements={},this.blinking_circle_outers=[],this.first_touch_callback=null,this.element_pos={}}startDrag(t,n,i){this.selectedElement=i,this.selectedVariable=n,t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault();let r=It(t,this.control_svg),s=e(r.x,r.y),a=this.element_pos[n];a&&(this.mouseOffset=a.sub(s)),this.handleBlinking()}drag(t){if(null==this.selectedElement)return;if(null==this.selectedVariable)return;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault();let n=It(t,this.control_svg),i=e(n.x,n.y).add(this.mouseOffset);this.element_pos[this.selectedVariable]=i,null!=this.setter[this.selectedVariable]&&(i=this.setter[this.selectedVariable](i)),null!=this.selectedVariable&&(null!=this.callbacks[this.selectedVariable]&&this.callbacks[this.selectedVariable](i),this.setViewBox())}setViewBox(){this.control_svg.setAttribute("viewBox",this.diagram_svg.getAttribute("viewBox")),this.control_svg.setAttribute("preserveAspectRatio",this.diagram_svg.getAttribute("preserveAspectRatio"))}endDrag(t){this.selectedElement=null,this.selectedVariable=null}remove(t){var e;this.selectedVariable==t&&(this.selectedElement=null,this.selectedVariable=null),delete this.callbacks[t],delete this.setter[t],null===(e=this.svg_elements[t])||void 0===e||e.remove(),delete this.svg_elements[t],delete this.element_pos[t]}setPos(t,e){this.element_pos[t]=e,this.callbacks[t](e,!1)}registerCallback(t,e){this.callbacks[t]=e}registerSetter(t,e){this.setter[t]=e}addBlinkingCircleOuter(t){this.blinking_circle_outers.push(t)}handleBlinking(){if(0!=this.blinking_circle_outers.length){for(let t=0;t<this.blinking_circle_outers.length;t++)this.blinking_circle_outers[t].classList.remove("diagramatics-locator-blink");this.blinking_circle_outers=[],null!=this.first_touch_callback&&this.first_touch_callback()}}create_locator_diagram_svg(t,n,i){let r=document.createElementNS("http://www.w3.org/2000/svg","g");return Y(this.control_svg,r,n.position(e(0,0)),!0,!1,W(this.diagram_svg)),r.style.cursor="pointer",r.setAttribute("overflow","visible"),i&&(r.classList.add("diagramatics-locator-blink"),this.addBlinkingCircleOuter(r)),this.svg_elements[t]?this.svg_elements[t].replaceWith(r):this.control_svg.appendChild(r),this.svg_elements[t]=r,this.element_pos[t],r}create_locator_circle_pointer_svg(t,e,n,i,r){let s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("overflow","visible"),s.style.cursor="pointer";let a=document.createElementNS("http://www.w3.org/2000/svg","circle"),l=document.createElementNS("http://www.w3.org/2000/svg","circle"),o=.4*e;return a.setAttribute("r",e.toString()),a.setAttribute("fill",w(i,x)),a.setAttribute("fill-opacity","0.3137"),a.setAttribute("stroke","none"),a.classList.add("diagramatics-locator-outer"),r&&a.classList.add("diagramatics-locator-blink"),l.setAttribute("r",o.toString()),l.setAttribute("fill",w(i,x)),l.setAttribute("stroke","none"),l.classList.add("diagramatics-locator-inner"),s.appendChild(a),s.appendChild(l),s.setAttribute("transform",`translate(${n.x},${-n.y})`),this.svg_elements[t]?this.svg_elements[t].replaceWith(s):this.control_svg.appendChild(s),this.svg_elements[t]=s,s}}!function(t){t.container="diagramatics-dnd-container",t.draggable="diagramatics-dnd-draggable",t.ghost="diagramatics-dnd-draggable-ghost"}(Tt||(Tt={}));class jt{constructor(t,e){this.dnd_svg=t,this.diagram_svg=e,this.containers={},this.draggables={},this.callbacks={},this.onclickstart_callback={},this.hoveredContainerName=null,this.draggedElementName=null,this.draggedElementGhost=null,this.dropped_outside_callback=null,this.move_validation_function=null,this.sort_content=!1,this.active_draggable_name=null,this.focus_padding=1,this.dom_to_id_map=new WeakMap}add_container(t,e,n,i){null==this.containers[t]?this.containers[t]={name:t,diagram:e,position:e.origin,content:[],config:null!=i?i:{type:"horizontal-uniform"},capacity:null!=n?n:1}:this.replace_container_svg(t,e,n,i)}generate_position_map(t,n,i,r){var s;const a=t[0].add(t[1]).scale(.5);switch(n.type){case"horizontal-uniform":{let n=(t[1].x-t[0].x)/i,r=t[0].x+n/2,s=a.y;return L(0,i).map((t=>e(r+n*t,s)))}case"vertical-uniform":{let n=(t[1].y-t[0].y)/i,r=a.x,s=t[1].y-n/2;return L(0,i).map((t=>e(r,s-n*t)))}case"grid":{let[r,s]=n.value,a=t[1].y-t[0].y,l=(t[1].x-t[0].x)/r,o=a/s,c=t[0].x+l/2,h=t[1].y-o/2;return L(0,i).map((t=>e(c+l*(t%r),h-o*Math.floor(t/r))))}case"vertical":{const i=e(a.x,t[1].y),s=r.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));return Et(s.map((([t,e])=>rt(t,e).mut())),n.padding).mut().move_origin("top-center").position(i).translate(e(0,-n.padding)).children.map((t=>t.origin))}case"horizontal":{const i=e(t[0].x,a.y),s=r.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));return kt(s.map((([t,e])=>rt(t,e).mut())),n.padding).mut().move_origin("center-left").position(i).translate(e(n.padding,0)).children.map((t=>t.origin))}case"flex-row":{const i=null!==(s=n.padding)&&void 0!==s?s:0,l=t[1].x-t[0].x-2*i,o=r.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));let c=St(o.map((([t,e])=>rt(t,e).mut())),l,i,i,n.vertical_alignment,n.horizontal_alignment).mut();switch(n.horizontal_alignment){case"center":c=c.move_origin("top-center").position(e(a.x,t[1].y-i));break;case"right":c=c.move_origin("top-right").position(e(t[1].x-i,t[1].y-i));break;default:c=c.move_origin("top-left").position(e(t[0].x+i,t[1].y-i))}return c.children.map((t=>t.origin))}default:return[]}}get_container_content_size(t){var e;const n=this.containers[t];if(null==n)return[NaN,NaN];const i=null!==(e=n.config.padding)&&void 0!==e?e:0,r=n.content.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram)&&void 0!==n?n:m()})),[s,a]=ft(u(...r));return[s+2*i,a+2*i]}replace_draggable_svg(t,e){var n,i;let r=this.draggables[t];if(null==r)return;let s=null===(n=r.svgelement)||void 0===n?void 0:n.parentNode;null!=s&&(null===(i=r.svgelement)||void 0===i||i.remove(),r.diagram=e,r.diagram_size=ft(e),this.add_draggable_svg(t,e,s),this.reposition_container_content(r.container))}replace_container_svg(t,e,n,i){var r;let s=this.containers[t];if(null==s)return;const a=this.get_container_outer_g(t);null!=a&&(null===(r=s.svgelement)||void 0===r||r.remove(),s.diagram=e,n&&(s.capacity=n),i&&(s.config=i),this.add_container_svg(t,e,a),this.reposition_container_content(t))}add_draggable_to_container(t,e,n){if(null!=this.draggables[t])return this.replace_draggable_svg(t,e),void this.move_draggable_to_container(t,n,!0);const i=ft(e);this.draggables[t]={name:t,diagram:e.mut(),diagram_size:i,position:e.origin,container:n},this.containers[n].content.push(t)}add_draggable_with_container(t,e,n){if(null!=this.draggables[t])return void this.replace_draggable_svg(t,e);let i=`_container0_${t}`;null==n&&(n=this.diagram_container_from_draggable(e)),this.add_container(i,n);const r=ft(e);this.containers[i].content.push(t),this.draggables[t]={name:t,diagram:e.mut(),diagram_size:r,position:e.origin,container:i}}remove_draggable(t){var e;for(let e in this.containers){const n=this.containers[e];n.content=n.content.filter((e=>e!=t))}null===(e=this.draggables[t].svgelement)||void 0===e||e.remove(),delete this.draggables[t]}registerCallback(t,e){this.callbacks[t]=e}register_clickstart_callback(t,e){this.onclickstart_callback[t]=e}register_dropped_outside_callback(t){this.dropped_outside_callback=t}register_move_validation_function(t){this.move_validation_function=t}setViewBox(){this.dnd_svg.setAttribute("viewBox",this.diagram_svg.getAttribute("viewBox")),this.dnd_svg.setAttribute("preserveAspectRatio",this.diagram_svg.getAttribute("preserveAspectRatio"))}drawSvg(){for(let t in this.containers){const e=this.containers[t];if(null==(null==e?void 0:e.svgelement)){const n=document.createElementNS("http://www.w3.org/2000/svg","g");this.dnd_svg.append(n),this.add_container_svg(t,e.diagram,n)}const n=this.get_container_outer_g(t);if(null!=n)for(let t of e.content){const e=this.draggables[t];(null==e?void 0:e.svgelement)||this.add_draggable_svg(t,e.diagram,n)}}for(let t in this.containers)this.reposition_container_content(t),this.reconfigure_container_tabindex(t)}getData(){let t=[];for(let e in this.containers)t.push({container:e,content:this.containers[e].content});return t}setData(t){try{for(let e of t)for(let t of e.content)this.try_move_draggable_to_container(t,e.container,!0)}catch(t){console.error("the data is not valid")}}diagram_container_from_draggable(t){return st(...t.bounding_box()).move_origin(t.origin).strokedasharray([5])}register_tap_enter(t,e){t.onclick=t=>{e(!1)},t.onkeydown=t=>{"Enter"==t.key&&e(!0)}}tap_enter_draggable(t,e){var n,i,r;if(null==this.active_draggable_name){this.reset_picked_class(),this.active_draggable_name=t;let r=this.draggables[t];if(null==r.svgelement)return;r.svgelement.classList.add("picked"),e&&(null===(i=(n=this.onclickstart_callback)[t])||void 0===i||i.call(n))}else if(t==this.active_draggable_name)this.reset_picked_class(),this.active_draggable_name=null;else{const e=null===(r=this.draggables[t])||void 0===r?void 0:r.container;e&&this.try_move_draggable_to_container(this.active_draggable_name,e),this.reset_picked_class(),this.active_draggable_name=null}}tap_enter_container(t){null!=this.active_draggable_name&&(this.try_move_draggable_to_container(this.active_draggable_name,t),this.active_draggable_name=null,this.reset_picked_class())}get_container_outer_g(t){var e;const n=this.containers[t];return null===(e=null==n?void 0:n.svgelement)||void 0===e?void 0:e.parentNode}add_container_svg(t,n,i){let r=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.dnd_svg,r,n.position(e(0,0)),!1,!1,W(this.diagram_svg),Tt.container);let s=n.origin;r.setAttribute("transform",`translate(${s.x},${-s.y})`),r.setAttribute("class",Tt.container),r.setAttribute("tabindex","0"),r.onmousedown=t=>{t.preventDefault()},this.register_tap_enter(r,(()=>{this.tap_enter_container(t)})),i.prepend(r),this.containers[t].svgelement=r,this.dom_to_id_map.set(r,t),this.add_focus_rect(r,n)}add_draggable_svg(t,n,i){let r=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.dnd_svg,r,n.position(e(0,0)),!0,!1,W(this.diagram_svg),Tt.draggable);let s=n.origin;r.setAttribute("transform",`translate(${s.x},${-s.y})`),r.setAttribute("class",Tt.draggable),r.setAttribute("draggable","true"),r.setAttribute("tabindex","0"),r.onmousedown=e=>{this.draggedElementName=t,this.startDrag(e)},r.ontouchstart=e=>{this.draggedElementName=t,this.tap_enter_draggable(t),this.startDrag(e)},this.register_tap_enter(r,(e=>{this.tap_enter_draggable(t,e)})),i.append(r),this.draggables[t].svgelement=r,this.dom_to_id_map.set(r,t),this.add_focus_rect(r,n)}add_focus_rect(t,n){const i=n.position(e(0,0)).bounding_box(),r=this.focus_padding,s=i[1].x-i[0].x+2*r,a=i[1].y-i[0].y+2*r,l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("width",s.toString()),l.setAttribute("height",a.toString()),l.setAttribute("x",(i[0].x-r).toString()),l.setAttribute("y",(-i[1].y-r).toString()),l.setAttribute("fill","none"),l.setAttribute("stroke","black"),l.setAttribute("stroke-width","1"),l.setAttribute("vector-effect","non-scaling-stroke"),l.setAttribute("class",Ot),t.appendChild(l)}move_svg_draggable_to_container(t,e){var n;const i=null===(n=this.draggables[t])||void 0===n?void 0:n.svgelement;if(null==i)return;const r=this.get_container_outer_g(e);null!=r&&r.appendChild(i)}reorder_svg_container_content(t){var e,n;const i=null===(e=this.containers[t])||void 0===e?void 0:e.content,r=this.get_container_outer_g(t);if(null!=i&&null!=r)for(let t of i){const e=null===(n=this.draggables[t])||void 0===n?void 0:n.svgelement;null!=e&&r.appendChild(e)}}reconfigure_container_tabindex(t){var e,n,i,r;const s=this.containers[t];if(null!=s&&1==s.capacity)if(1==s.content.length){if(null===(e=s.svgelement)||void 0===e||e.setAttribute("tabindex","-1"),s.svgelement==document.activeElement){const t=s.content[0];null===(i=null===(n=this.draggables[t])||void 0===n?void 0:n.svgelement)||void 0===i||i.focus()}}else null===(r=s.svgelement)||void 0===r||r.setAttribute("tabindex","0")}reorder_svg_container_tabindex(t){for(let e of t){const t=this.get_container_outer_g(e);null!=t&&this.dnd_svg.appendChild(t)}}reposition_container_content(t){var e,n,i,r;let s=this.containers[t];if(null==s)return;this.sort_content?(s.content.sort(),this.reorder_svg_container_content(t)):(null===(e=s.config)||void 0===e?void 0:e.sorting_function)&&(s.content.sort(s.config.sorting_function),this.reorder_svg_container_content(t));const a=null!==(n=s.config.custom_region_box)&&void 0!==n?n:s.diagram.bounding_box(),l=this.generate_position_map(a,s.config,s.capacity,s.content);for(let t=0;t<s.content.length;t++){let e=this.draggables[s.content[t]],n=null!==(i=l[t])&&void 0!==i?i:s.diagram.origin;e.diagram=e.diagram.position(n),e.position=n,null===(r=e.svgelement)||void 0===r||r.setAttribute("transform",`translate(${n.x},${-n.y})`)}}remove_draggable_from_container(t,e){this.containers[e].content=this.containers[e].content.filter((e=>e!=t))}move_draggable_to_container(t,e,n=!1){let i=this.draggables[t];if(null==i)return;if(i.container==e)return;let r=this.containers[e],s=i.container;if(this.remove_draggable_from_container(t,s),i.container=e,r.content.push(t),this.move_svg_draggable_to_container(t,e),this.reposition_container_content(e),this.reposition_container_content(s),this.reconfigure_container_tabindex(e),this.reconfigure_container_tabindex(s),n)return;let a=this.draggables[t];this.callbacks[a.name](a.position)}try_move_draggable_to_container(t,e,n=!1){if(this.move_validation_function){if(!this.move_validation_function(t,e))return}let i=this.draggables[t],r=this.containers[e];if(r.content.length+1<=r.capacity)this.move_draggable_to_container(t,e,n);else if(1==r.capacity){let s=i.container,a=r.content[0];this.move_draggable_to_container(t,e,!0),this.move_draggable_to_container(a,s,n)}}startDrag(t){var e,n;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),this.hoveredContainerName=null,this.reset_hovered_class();let i=this.dnd_svg.getElementsByClassName(Tt.ghost);for(let t=0;t<i.length;t++)i[t].remove();if(null==this.draggedElementName)return;let r=this.draggables[this.draggedElementName];null!=r.svgelement&&(r.svgelement.classList.add("picked"),null===(n=(e=this.onclickstart_callback)[this.draggedElementName])||void 0===n||n.call(e),this.draggedElementGhost=r.svgelement.cloneNode(!0),this.draggedElementGhost.style.pointerEvents="none",this.draggedElementGhost.setAttribute("opacity","0.5"),this.draggedElementGhost.setAttribute("class",Tt.ghost),this.dnd_svg.append(this.draggedElementGhost))}get_dnd_element_data_from_evt(t){let e=null;if(window.TouchEvent&&t instanceof TouchEvent){let n=t.touches[0];e=document.elementFromPoint(n.clientX,n.clientY)}else{const n=t;e=document.elementFromPoint(n.clientX,n.clientY)}if(null==e)return null;if("tspan"==e.localName&&(e=e.parentElement),null==e)return null;let n=e.getAttribute("_dg_tag");if(null==n)return null;if(n==Tt.container){let t=e.parentElement;if(null==t)return null;let n=this.dom_to_id_map.get(t);return null==n?null:{name:n,type:Tt.container}}if(n==Tt.draggable){let t=e.parentElement;if(null==t)return null;let n=this.dom_to_id_map.get(t);return null==n?null:{name:n,type:Tt.draggable}}return null}drag(t){var e,n,i;if(null==this.draggedElementName)return;if(null==this.draggedElementGhost)return;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),this.reset_hovered_class();let r=this.get_dnd_element_data_from_evt(t);null==r?this.hoveredContainerName=null:r.type==Tt.container?(this.hoveredContainerName=r.name,null===(e=this.containers[r.name].svgelement)||void 0===e||e.classList.add("hovered")):r.type==Tt.draggable&&(this.hoveredContainerName=null===(n=this.draggables[r.name])||void 0===n?void 0:n.container,null===(i=this.draggables[r.name].svgelement)||void 0===i||i.classList.add("hovered"));let s=It(t,this.dnd_svg);this.draggedElementGhost.setAttribute("transform",`translate(${s.x},${-s.y})`)}endDrag(t){null!=this.hoveredContainerName&&null!=this.draggedElementName&&this.try_move_draggable_to_container(this.draggedElementName,this.hoveredContainerName),null==this.hoveredContainerName&&null!=this.draggedElementName&&null!=this.dropped_outside_callback&&this.dropped_outside_callback(this.draggedElementName),this.draggedElementName=null,this.hoveredContainerName=null,this.reset_hovered_class(),this.reset_picked_class(),null!=this.draggedElementGhost&&(this.draggedElementGhost.remove(),this.draggedElementGhost=null)}reset_hovered_class(){var t,e;for(let e in this.containers)null===(t=this.containers[e].svgelement)||void 0===t||t.classList.remove("hovered");for(let t in this.draggables)null===(e=this.draggables[t].svgelement)||void 0===e||e.classList.remove("hovered")}reset_picked_class(){var t;for(let e in this.draggables)null===(t=this.draggables[e].svgelement)||void 0===t||t.classList.remove("picked")}}class Bt{constructor(t,e){this.button_svg=t,this.diagram_svg=e,this.states={},this.svg_g_element={},this.touchdownName=null,this.focus_padding=1}remove(t){delete this.states[t];const e=this.svg_g_element[t];null==e||e.remove(),delete this.svg_g_element[t]}try_add_toggle(t,e,n,i,r){let s=this.svg_g_element[t];return s?s.innerHTML="":(s=document.createElementNS("http://www.w3.org/2000/svg","g"),this.button_svg.appendChild(s)),this.add_toggle(t,e,n,i,s,r)}add_toggle(t,e,n,i,r,s){let a=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,a,n,!0,!1,W(this.diagram_svg)),a.setAttribute("overflow","visible"),a.style.cursor="pointer";let l=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,l,e,!0,!1,W(this.diagram_svg)),l.setAttribute("overflow","visible"),l.style.cursor="pointer",r.setAttribute("overflow","visible"),r.setAttribute("tabindex","0"),r.appendChild(l),r.appendChild(a),this.svg_g_element[t]=r,this.states[t]=i;const o=t=>{l.setAttribute("display",t?"block":"none"),a.setAttribute("display",t?"none":"block")};o(this.states[t]);const c=(e,n=!0)=>{this.states[t]=e,s(this.states[t],n),o(this.states[t])};r.onmousedown=t=>{t.preventDefault()},r.onclick=e=>{e.preventDefault(),c(!this.states[t])},r.onkeydown=e=>{"Enter"==e.key&&c(!this.states[t])};return t=>{c(t,!1)}}try_add_click(t,e,n,i,r){let s=this.svg_g_element[t];s?s.innerHTML="":(s=document.createElementNS("http://www.w3.org/2000/svg","g"),this.button_svg.appendChild(s)),this.add_click(t,e,n,i,s,r)}add_click(t,e,n,i,r,s){let a=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,a,e,!0,!1,W(this.diagram_svg)),a.setAttribute("overflow","visible"),a.style.cursor="pointer";let l=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,l,n,!0,!1,W(this.diagram_svg)),l.setAttribute("overflow","visible"),l.style.cursor="pointer";let o=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,o,i,!0,!1,W(this.diagram_svg)),o.setAttribute("overflow","visible"),o.style.cursor="pointer",r.setAttribute("class","diagramatics-focusable-no-outline"),r.setAttribute("overflow","visible"),r.setAttribute("tabindex","0"),r.appendChild(a),r.appendChild(l),r.appendChild(o),this.add_focus_rect(r,e),this.svg_g_element[t]=r;const c=(t,e)=>{a.setAttribute("display",t||e?"none":"block"),l.setAttribute("display",t?"block":"none"),o.setAttribute("display",e&&!t?"block":"none")};c(!1,!1);let h=!1,d=!1;const u=()=>{c(h,d)};r.onblur=t=>{d=!1,h=!1,u()},r.onmouseenter=t=>{d=!0,u()},r.onmouseleave=t=>{d=!1,h=!1,u()},r.onmousedown=t=>{t.preventDefault(),h=!0,u()},r.onmouseup=t=>{h=!1,u()},r.onclick=t=>{s(),d=!1,h=!1,u()},r.onkeydown=t=>{"Enter"==t.key&&(s(),h=!0,u())},r.onkeyup=t=>{h=!1,u()}}add_focus_rect(t,e){const n=e.bounding_box(),i=this.focus_padding,r=n[1].x-n[0].x+2*i,s=n[1].y-n[0].y+2*i,a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("width",r.toString()),a.setAttribute("height",s.toString()),a.setAttribute("x",(n[0].x-i).toString()),a.setAttribute("y",(-n[1].y-i).toString()),a.setAttribute("fill","none"),a.setAttribute("stroke","black"),a.setAttribute("stroke-width","1"),a.setAttribute("vector-effect","non-scaling-stroke"),a.setAttribute("class",Ot),t.appendChild(a)}}class Pt{constructor(t){this.elements=[],this.elementMap=new Map,this.nextId=1,this.contentDiv=t}generateId(t){return`${t}_${this.nextId++}`}addElement(t,e){const n=this.generateId(e);return t.id=n,this.elements.push(t),this.elementMap.set(n,t),t.appendTo(this.contentDiv),this}header(t,e=1){const n=new Vt(t,e);return this.addElement(n,"header"),n}paragraph(t){const e=new Gt(t);return this.addElement(e,"paragraph"),e}diagram(t=100,e=100){const n=new Ft(t,e,this.contentDiv);return this.addElement(n,"drawing"),n}getElement(t){return this.elementMap.get(t)}removeElement(t){const e=this.elementMap.get(t);if(e){const n=this.elements.indexOf(e);n>-1&&this.elements.splice(n,1),this.elementMap.delete(t);const i=this.contentDiv.querySelector(`#${t}`);return i&&this.contentDiv.removeChild(i),!0}return!1}toJSON(){return{elements:this.elements.map((t=>Object.assign({id:t.id},t.toJSON()))),nextId:this.nextId}}static fromJSON(t,e){const n=new Pt(e);return n.nextId=t.nextId,t.elements.forEach((t=>{let i;switch(t.type){case"header":i=Vt.fromJSON(t);break;case"paragraph":i=Gt.fromJSON(t);break;case"drawing":i=Ft.fromJSON(t,e);break;default:throw new Error(`Unknown element type: ${t.type}`)}i.id=t.id,n.elements.push(i),n.elementMap.set(i.id,i),i.appendTo(n.contentDiv)})),n}static CombineELements(t,...e){return e.forEach((e=>e.appendTo(t))),t}}class Ft{constructor(t,e,n){this.width=t,this.height=e,this.contentDiv=n,this.id="",this.callbacks={},this.contentDiv=n,this.element=document.createElementNS("http://www.w3.org/2000/svg","svg")}appendTo(t){this.element.setAttribute("id",this.id),this.element.setAttribute("width",`${this.width}px`),this.element.setAttribute("height",`${this.height}px`),this.element.style.margin="auto",this.attachEventListeners(this.element),t.appendChild(this.element)}init(){return{draw:(...t)=>{K(this.element,u(...t))},int:new zt(this.contentDiv,this.element)}}getElement(){return this.element}attachEventListeners(t){t.addEventListener("click",(()=>this.emit("click")))}emit(t){this.callbacks[t]&&this.callbacks[t].forEach((t=>t()))}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}toJSON(){return{type:"drawing",width:this.width,height:this.height}}static fromJSON(t,e){return new Ft(t.width,t.height,e)}}class Gt{constructor(t){this.text=t,this.id="",this.callbacks={},this.element=document.createElement("p")}attachEventListeners(t){t.addEventListener("click",(()=>this.emit("click")))}appendTo(t){this.element.id=this.id,this.element.textContent=this.text,this.attachEventListeners(this.element),t.appendChild(this.element)}getElement(){return this.element}emit(t){this.callbacks[t]&&this.callbacks[t].forEach((t=>t()))}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}toJSON(){return{type:"paragraph",text:this.text}}static fromJSON(t){return new Gt(t.text)}}class Vt{constructor(t,e){this.text=t,this.level=e,this.id="",this.callbacks={},this.element=document.createElement(`h${this.level}`)}appendTo(t){this.element.id=this.id,this.element.textContent=this.text,this.attachEventListeners(this.element),t.appendChild(this.element)}getElement(){return this.element}attachEventListeners(t){t.addEventListener("click",(()=>this.emit("click")))}emit(t){this.callbacks[t]&&this.callbacks[t].forEach((t=>t()))}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}toJSON(){return{type:"header",text:this.text,level:this.level}}static fromJSON(t){return new Vt(t.text,t.level)}}class $t{constructor(t,e,n=!1,i="",r=[]){this.questionElements=[],this.options=[],this.selectedOptions=new Set,this.explanationElements=[],this.callbacks={},this.id="",this.isExplanationVisible=!1,this.element=document.createElement("div"),this.questionElements=t,this.options=e,this.isMultipleSelection=n,this.hint=i,this.explanationElements=r,this.initQuizz()}initQuizz(){this.addQuestion(this.questionElements),this.addOptions(),this.addHint(),this.addExplanationButton(),this.addSubmitButton()}addQuestion(t){let e=document.createElement("div");e.classList.add("quizz_question"),e=Pt.CombineELements(e,...t),this.element.appendChild(e)}addOptions(){const t=this.element.querySelector(".quizz_options");t&&this.element.removeChild(t);let e=document.createElement("div");e.classList.add("quizz_options"),this.options.forEach(((t,n)=>{const i=t.getElement();i.classList.add("option",`option_${n+1}`),this.selectedOptions.has(n+1)?i.classList.add("selected"):i.classList.remove("selected"),i.addEventListener("click",(()=>this.onOptionClick(n+1))),t.appendTo(e)})),this.element.appendChild(e)}onOptionClick(t){this.isMultipleSelection?this.selectedOptions.has(t)?this.selectedOptions.delete(t):this.selectedOptions.add(t):(this.selectedOptions.clear(),this.selectedOptions.add(t)),this.updateOptionSelections(),this.emit("selection",Array.from(this.selectedOptions))}updateOptionSelections(){const t=this.element.querySelector(".quizz_options");t&&this.options.forEach(((e,n)=>{const i=t.querySelector(`.option_${n+1}`);i&&(this.selectedOptions.has(n+1)?i.classList.add("selected"):i.classList.remove("selected"))}))}addExplanationButton(){const t=document.createElement("button");t.textContent="Show Explanation",t.classList.add("quizz_explanation_button"),t.addEventListener("click",(()=>this.toggleExplanation())),this.element.appendChild(t);const e=document.createElement("div");e.classList.add("quizz_explanation_content"),e.style.display="none",this.explanationElements.forEach((t=>t.appendTo(e))),this.element.appendChild(e)}toggleExplanation(){this.isExplanationVisible=!this.isExplanationVisible;const t=this.element.querySelector(".quizz_explanation_button"),e=this.element.querySelector(".quizz_explanation_content");this.isExplanationVisible?(t.textContent="Hide Explanation",e.style.display="block"):(t.textContent="Show Explanation",e.style.display="none"),this.emit("explanationToggle",this.isExplanationVisible)}addHint(){if(this.hint){const t=document.createElement("div");t.classList.add("quizz_hint"),t.textContent=`Hint: ${this.hint}`,this.element.appendChild(t)}}addSubmitButton(){const t=document.createElement("button");t.textContent="Submit",t.classList.add("quizz_submit"),t.addEventListener("click",(()=>this.onSubmit())),this.element.appendChild(t)}onSubmit(){const t=Array.from(this.selectedOptions);this.emit("submit",t)}emit(t,e){this.callbacks[t]&&this.callbacks[t].forEach((t=>t(e)))}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}getElement(){return this.element}appendTo(t){this.element.id=this.id,this.element.classList.add("quizz"),t.appendChild(this.element)}toJSON(){return{type:"quizz",isMultipleSelection:this.isMultipleSelection,hint:this.hint,selectedOptions:Array.from(this.selectedOptions)}}}function Ut(t){return function e(n){if(n.type==a.Polygon||n.type==a.Curve)return t(n);if(n.type==a.Diagram)return n.children=n.children.map((t=>e(t))),n;if(n.type==a.Text||n.type==a.MultilineText)return n;throw new Error("Unreachable, unknown diagram type : "+n.type)}}function Xt(t){return Ut((function(e){if(null==e.path)return e;let n=(e.type==a.Curve?S(0,1,t):O(0,1,t)).map((t=>e.parametric_point(t)));return e.path=new d(n),e}))}function Wt(t,e,i){let[r,s,a]=e,l=r.sub(s).normalize(),o=a.sub(s).normalize(),c=Math.abs((l.angle()-o.angle())%Math.PI),h=t/Math.tan(c/2),d=r.sub(s).length(),u=a.sub(s).length();h=Math.min(h,d/2,u/2),t=h*Math.tan(c/2);let g=s.add(l.scale(h)),p=s.add(o.scale(h)),_=Math.sqrt(t*t+h*h),m=s.add(l.add(o).normalize().scale(_)),f=g.sub(m).angle(),b=p.sub(m).angle(),v=b+2*Math.PI,y=b-2*Math.PI,x=Math.abs(f-b);return Math.abs(f-v)<x&&(b=v),Math.abs(f-y)<x&&(b=y),S(f,b,i).map((e=>m.add(n(e).scale(t))))}function Jt(t=1,e,n=40){if(0==t)return t=>t;return"number"==typeof t&&(t=[t]),Ut((function(i){if(null==i.path)return i;let r=L(0,i.path.points.length);null==e&&(e=r),e=e.filter((t=>r.includes(t))),t=A(t,e.length);let s=[];for(let r=0;r<i.path.points.length;r++){let a=r;if(!e.includes(a)){s.push(i.path.points[r]);continue}let l=(a-1+i.path.points.length)%i.path.points.length,o=(a+1)%i.path.points.length,c=i.path.points[l],h=i.path.points[r],d=i.path.points[o],u=Wt(t[e.indexOf(a)],[c,h,d],n);s=s.concat(u)}return i.path=new d(s),i}))}var Yt,Kt=Object.freeze({__proto__:null,add_arrow:function(t,e=!1){return Ut((function(n){if(null==n.path)return n;let i=e?n.path.points[0]:n.path.points[n.path.points.length-1];return u(n,ut(e?n.path.points[1]:n.path.points[n.path.points.length-2],i,t)).clone_style_from(n)}))},arrowhead_replace:function(t){return function(e){return e.apply_to_tagged_recursive(s.ARROW_HEAD,(e=>{let n=function(t){var e;if(!t.contain_tag(s.ARROW_HEAD))return NaN;let n=null===(e=t.path)||void 0===e?void 0:e.points;if(null==n)return NaN;if(3!=n.length)return NaN;let i=n[0],r=n[1],a=n[2],l=r.add(a).scale(.5);return i.sub(l).angle()}(e);return t.copy().rotate(n).position(e.origin)}))}},resample:Xt,round_corner:Jt,slicepath:function(t,e,n=100){t>e&&([t,e]=[e,t]),t<0&&(t=0),e>1&&(e=1);let i=Math.floor(n/(e-t));return Ut((function(n){if(null==n.path)return n;let r=n.apply(Xt(i));if(null==r.path)return n;let s=r.path.points.slice(Math.floor(t*i),Math.floor(e*i)+1);return r.path=new d(s),r}))},subdivide:function(t=100){return Ut((function(n){if(null==n.path)return n;let i=[];for(let r=0;r<n.path.points.length;r++){let s=(r+1)%n.path.points.length,a=n.path.points[r],l=n.path.points[s],o=S(a.x,l.x,t+1),c=S(a.y,l.y,t+1),h=o.map(((t,n)=>e(t,c[n])));h.pop(),i=i.concat(h)}return n.path=new d(i),n}))}});!function(t){t[t.BeforeStart=0]="BeforeStart",t[t.EqualStart=1]="EqualStart",t[t.BetweenStartAndEnd=2]="BetweenStartAndEnd",t[t.EqualEnd=3]="EqualEnd",t[t.AfterEnd=4]="AfterEnd"}(Yt||(Yt={}));class Qt{pointsSame(t,e){return this.pointsSameX(t,e)&&this.pointsSameY(t,e)}pointsCompare(t,e){return this.pointsSameX(t,e)?this.pointsSameY(t,e)?0:t[1]<e[1]?-1:1:t[0]<e[0]?-1:1}}class Zt extends Qt{constructor(t=1e-10){super(),this.epsilon=t}pointAboveOrOnLine(t,e,n){const i=e[0],r=e[1],s=n[0],a=n[1],l=t[0];return(s-i)*(t[1]-r)-(a-r)*(l-i)>=-this.epsilon}pointBetween(t,e,n){const i=t[1]-e[1],r=n[0]-e[0],s=t[0]-e[0],a=n[1]-e[1],l=s*r+i*a;if(l<this.epsilon)return!1;return!(l-(r*r+a*a)>-this.epsilon)}pointsSameX(t,e){return Math.abs(t[0]-e[0])<this.epsilon}pointsSameY(t,e){return Math.abs(t[1]-e[1])<this.epsilon}pointsCollinear(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],s=e[0]-n[0],a=e[1]-n[1];return Math.abs(i*a-s*r)<this.epsilon}linesIntersect(t,e,n,i){const r=e[0]-t[0],s=e[1]-t[1],a=i[0]-n[0],l=i[1]-n[1],o=r*l-s*a;if(Math.abs(o)<this.epsilon)return null;const c=t[0]-n[0],h=t[1]-n[1],d=(a*h-l*c)/o,u=(r*h-s*c)/o,g=t=>t<=-this.epsilon?Yt.BeforeStart:t<this.epsilon?Yt.EqualStart:t-1<=-this.epsilon?Yt.BetweenStartAndEnd:t-1<this.epsilon?Yt.EqualEnd:Yt.AfterEnd,p=[t[0]+d*r,t[1]+d*s];return{alongA:g(d),alongB:g(u),p:p}}}class te{constructor(){this.nodes=[]}remove(t){const e=this.nodes.indexOf(t);e>=0&&this.nodes.splice(e,1)}getIndex(t){return this.nodes.indexOf(t)}isEmpty(){return this.nodes.length<=0}getHead(){return this.nodes[0]}removeHead(){this.nodes.shift()}insertBefore(t,e){this.findTransition(t,e).insert(t)}findTransition(t,e){var n,i;let r=0,s=this.nodes.length;for(;r<s;){const n=r+s>>1;a=this.nodes[n],e(t)-e(a)>0?s=n:r=n+1}var a;return{before:r<=0?null:null!==(n=this.nodes[r-1])&&void 0!==n?n:null,after:null!==(i=this.nodes[r])&&void 0!==i?i:null,insert:t=>(this.nodes.splice(r,0,t),t)}}}class ee{constructor(t,e,n,i){var r;this.otherFill=null,this.id=null!==(r=null==i?void 0:i.segmentId())&&void 0!==r?r:-1,this.start=t,this.end=e,this.myFill={above:n?n.myFill.above:null,below:n?n.myFill.below:null}}}class ne{constructor(t,e,n,i){this.status=null,this.isStart=t,this.p=e,this.seg=n,this.primary=i}}class ie{constructor(t,e,n=null){this.events=new te,this.status=new te,this.selfIntersection=t,this.geo=e,this.log=n}compareEvents(t,e,n,i,r,s){const a=this.geo.pointsCompare(e,r);return 0!==a?a:this.geo.pointsSame(n,s)?0:t!==i?t?1:-1:this.geo.pointAboveOrOnLine(n,i?r:s,i?s:r)?1:-1}addEvent(t){this.events.insertBefore(t,(e=>e===t?0:this.compareEvents(t.isStart,t.p,t.other.p,e.isStart,e.p,e.other.p)))}divideEvent(t,e){var n;const i=new ee(e,t.seg.end,t.seg,this.log);return null===(n=this.log)||void 0===n||n.segmentChop(t.seg,e),this.events.remove(t.other),t.seg.end=e,t.other.p=e,this.addEvent(t.other),this.addSegment(i,t.primary)}newSegment(t,e){const n=this.geo.pointsCompare(t,e);return 0===n?null:n<0?new ee(t,e,null,this.log):new ee(e,t,null,this.log)}addSegment(t,e){const n=new ne(!0,t.start,t,e),i=new ne(!1,t.end,t,e);return n.other=i,i.other=n,this.addEvent(n),this.addEvent(i),n}addRegion(t){let e,n=t[t.length-1];for(let i=0;i<t.length;i++){e=n,n=t[i];const r=this.newSegment(e,n);r&&this.addSegment(r,!0)}}compareStatus(t,e){const n=t.seg.start,i=t.seg.end,r=e.seg.start,s=e.seg.end;return this.geo.pointsCollinear(n,r,s)?this.geo.pointsCollinear(i,r,s)||this.geo.pointAboveOrOnLine(i,r,s)?1:-1:this.geo.pointAboveOrOnLine(n,r,s)?1:-1}statusFindSurrounding(t){return this.status.findTransition(t,(e=>e===t?0:-this.compareStatus(t,e)))}checkIntersection(t,e){var n;const i=t.seg,r=e.seg,s=i.start,a=i.end,l=r.start,o=r.end;null===(n=this.log)||void 0===n||n.checkIntersection(i,r);const c=this.geo.linesIntersect(s,a,l,o);if(null===c){if(!this.geo.pointsCollinear(s,a,l))return null;if(this.geo.pointsSame(s,o)||this.geo.pointsSame(a,l))return null;const n=this.geo.pointsSame(s,l),i=this.geo.pointsSame(a,o);if(n&&i)return e;const r=!n&&this.geo.pointBetween(s,l,o),c=!i&&this.geo.pointBetween(a,l,o);if(n)return c?this.divideEvent(e,a):this.divideEvent(t,o),e;r&&(i||(c?this.divideEvent(e,a):this.divideEvent(t,o)),this.divideEvent(e,s))}else c.alongA===Yt.BetweenStartAndEnd&&(c.alongB===Yt.EqualStart?this.divideEvent(t,l):c.alongB===Yt.BetweenStartAndEnd?this.divideEvent(t,c.p):c.alongB===Yt.EqualEnd&&this.divideEvent(t,o)),c.alongB===Yt.BetweenStartAndEnd&&(c.alongA===Yt.EqualStart?this.divideEvent(e,s):c.alongA===Yt.BetweenStartAndEnd?this.divideEvent(e,c.p):c.alongA===Yt.EqualEnd&&this.divideEvent(e,a));return null}calculate(t,e){var n,i,r,s,a,l,o,c;const h=[];for(;!this.events.isEmpty();){const c=this.events.getHead();if(null===(n=this.log)||void 0===n||n.vert(c.p[0]),c.isStart){null===(i=this.log)||void 0===i||i.segmentNew(c.seg,c.primary);const n=this.statusFindSurrounding(c),o=n.before,h=n.after;null===(r=this.log)||void 0===r||r.tempStatus(c.seg,!!o&&o.seg,!!h&&h.seg);const d=()=>{if(o){const t=this.checkIntersection(c,o);if(t)return t}return h?this.checkIntersection(c,h):null},u=d();if(u){if(this.selfIntersection){let t;t=null===c.seg.myFill.below||c.seg.myFill.above!==c.seg.myFill.below,t&&(u.seg.myFill.above=!u.seg.myFill.above)}else u.seg.otherFill=c.seg.myFill;null===(s=this.log)||void 0===s||s.segmentUpdate(u.seg),this.events.remove(c.other),this.events.remove(c)}if(this.events.getHead()!==c){null===(a=this.log)||void 0===a||a.rewind(c.seg);continue}if(this.selfIntersection){let e;e=null===c.seg.myFill.below||c.seg.myFill.above!==c.seg.myFill.below,c.seg.myFill.below=h?h.seg.myFill.above:t,c.seg.myFill.above=e?!c.seg.myFill.below:c.seg.myFill.below}else if(null===c.seg.otherFill){let n;if(h)if(c.primary===h.primary){if(null===h.seg.otherFill)throw new Error("otherFill is null");n=h.seg.otherFill.above}else n=h.seg.myFill.above;else n=c.primary?e:t;c.seg.otherFill={above:n,below:n}}null===(l=this.log)||void 0===l||l.status(c.seg,!!o&&o.seg,!!h&&h.seg),c.other.status=n.insert(c)}else{const t=c.status;if(null===t)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");const e=this.status.getIndex(t);if(e>0&&e<this.status.nodes.length-1){const t=this.status.nodes[e-1],n=this.status.nodes[e+1];this.checkIntersection(t,n)}if(null===(o=this.log)||void 0===o||o.statusRemove(t.seg),this.status.remove(t),!c.primary){if(!c.seg.otherFill)throw new Error("otherFill is null");const t=c.seg.myFill;c.seg.myFill=c.seg.otherFill,c.seg.otherFill=t}h.push(c.seg)}this.events.removeHead()}return null===(c=this.log)||void 0===c||c.done(),h}}function re(t,e,n){const i=[];for(const r of t){const t=(r.myFill.above?8:0)+(r.myFill.below?4:0)+(r.otherFill&&r.otherFill.above?2:0)+(r.otherFill&&r.otherFill.below?1:0);if(0!==e[t]){const s=new ee(r.start,r.end,null,n);s.myFill.above=1===e[t],s.myFill.below=2===e[t],i.push(s)}}return null==n||n.selected(i),i}class se{static union(t,e){return re(t,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],e)}static intersect(t,e){return re(t,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],e)}static difference(t,e){return re(t,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],e)}static differenceRev(t,e){return re(t,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],e)}static xor(t,e){return re(t,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],e)}}function ae(t,e,n){const i=[],r=[];for(const s of t){const a=s.start,l=s.end;if(e.pointsSame(a,l)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");continue}null==n||n.chainStart(s);const o={index:0,matches_head:!1,matches_pt1:!1},c={index:0,matches_head:!1,matches_pt1:!1};let h=o;function d(t,e,n){return h&&(h.index=t,h.matches_head=e,h.matches_pt1=n),h===o?(h=c,!1):(h=null,!0)}for(let f=0;f<i.length;f++){const b=i[f],v=b[0],y=b[b.length-1];if(e.pointsSame(v,a)){if(d(f,!0,!0))break}else if(e.pointsSame(v,l)){if(d(f,!0,!1))break}else if(e.pointsSame(y,a)){if(d(f,!1,!0))break}else if(e.pointsSame(y,l)&&d(f,!1,!1))break}if(h===o){i.push([a,l]),null==n||n.chainNew(a,l);continue}if(h===c){null==n||n.chainMatch(o.index);const x=o.index,w=o.matches_pt1?l:a,k=o.matches_head,E=i[x];let A=k?E[0]:E[E.length-1];const S=k?E[1]:E[E.length-2],O=k?E[E.length-1]:E[0],L=k?E[E.length-2]:E[1];if(e.pointsCollinear(S,A,w)&&(k?(null==n||n.chainRemoveHead(o.index,w),E.shift()):(null==n||n.chainRemoveTail(o.index,w),E.pop()),A=S),e.pointsSame(O,w)){i.splice(x,1),e.pointsCollinear(L,O,A)&&(k?(null==n||n.chainRemoveTail(o.index,A),E.pop()):(null==n||n.chainRemoveHead(o.index,A),E.shift())),null==n||n.chainClose(o.index),r.push(E);continue}k?(null==n||n.chainAddHead(o.index,w),E.unshift(w)):(null==n||n.chainAddTail(o.index,w),E.push(w));continue}function u(t){null==n||n.chainReverse(t),i[t].reverse()}function g(t,r){const s=i[t],a=i[r];let l=s[s.length-1];const o=s[s.length-2],c=a[0],h=a[1];e.pointsCollinear(o,l,c)&&(null==n||n.chainRemoveTail(t,l),s.pop(),l=o),e.pointsCollinear(l,c,h)&&(null==n||n.chainRemoveHead(r,c),a.shift()),null==n||n.chainJoin(t,r),i[t]=s.concat(a),i.splice(r,1)}const p=o.index,_=c.index;null==n||n.chainConnect(p,_);const m=i[p].length<i[_].length;o.matches_head?c.matches_head?m?(u(p),g(p,_)):(u(_),g(_,p)):g(_,p):c.matches_head?g(p,_):m?(u(p),g(_,p)):(u(_),g(p,_))}return r}class le{constructor(){this.list=[],this.nextSegmentId=0,this.curVert=NaN}push(t,e){this.list.push({type:t,data:JSON.parse(JSON.stringify(e))})}segmentId(){return this.nextSegmentId++}checkIntersection(t,e){this.push("check",{seg1:t,seg2:e})}segmentChop(t,e){this.push("div_seg",{seg:t,p:e}),this.push("chop",{seg:t,p:e})}statusRemove(t){this.push("pop_seg",{seg:t})}segmentUpdate(t){this.push("seg_update",{seg:t})}segmentNew(t,e){this.push("new_seg",{seg:t,primary:e})}tempStatus(t,e,n){this.push("temp_status",{seg:t,above:e,below:n})}rewind(t){this.push("rewind",{seg:t})}status(t,e,n){this.push("status",{seg:t,above:e,below:n})}vert(t){t!==this.curVert&&(this.push("vert",{x:t}),this.curVert=t)}selected(t){this.push("selected",{segs:t})}chainStart(t){this.push("chain_start",{seg:t})}chainRemoveHead(t,e){this.push("chain_rem_head",{index:t,p:e})}chainRemoveTail(t,e){this.push("chain_rem_tail",{index:t,p:e})}chainNew(t,e){this.push("chain_new",{p1:t,p2:e})}chainMatch(t){this.push("chain_match",{index:t})}chainClose(t){this.push("chain_close",{index:t})}chainAddHead(t,e){this.push("chain_add_head",{index:t,p:e})}chainAddTail(t,e){this.push("chain_add_tail",{index:t,p:e})}chainConnect(t,e){this.push("chain_con",{index1:t,index2:e})}chainReverse(t){this.push("chain_rev",{index:t})}chainJoin(t,e){this.push("chain_join",{index1:t,index2:e})}done(){this.push("done",null)}}class oe{constructor(t){this.log=null,this.geo=t}buildLog(t){var e;return this.log=t?new le:null,null===(e=this.log)||void 0===e?void 0:e.list}segments(t){const e=new ie(!0,this.geo,this.log);for(const n of t.regions)e.addRegion(n);return{segments:e.calculate(t.inverted,!1),inverted:t.inverted}}combine(t,e){const n=new ie(!1,this.geo,this.log);for(const e of t.segments)n.addSegment(new ee(e.start,e.end,e,this.log),!0);for(const t of e.segments)n.addSegment(new ee(t.start,t.end,t,this.log),!1);return{combined:n.calculate(t.inverted,e.inverted),inverted1:t.inverted,inverted2:e.inverted}}selectUnion(t){return{segments:se.union(t.combined,this.log),inverted:t.inverted1||t.inverted2}}selectIntersect(t){return{segments:se.intersect(t.combined,this.log),inverted:t.inverted1&&t.inverted2}}selectDifference(t){return{segments:se.difference(t.combined,this.log),inverted:t.inverted1&&!t.inverted2}}selectDifferenceRev(t){return{segments:se.differenceRev(t.combined,this.log),inverted:!t.inverted1&&t.inverted2}}selectXor(t){return{segments:se.xor(t.combined,this.log),inverted:t.inverted1!==t.inverted2}}polygon(t){return{regions:ae(t.segments,this.geo,this.log),inverted:t.inverted}}union(t,e){const n=this.segments(t),i=this.segments(e),r=this.combine(n,i),s=this.selectUnion(r);return this.polygon(s)}intersect(t,e){const n=this.segments(t),i=this.segments(e),r=this.combine(n,i),s=this.selectIntersect(r);return this.polygon(s)}difference(t,e){const n=this.segments(t),i=this.segments(e),r=this.combine(n,i),s=this.selectDifference(r);return this.polygon(s)}differenceRev(t,e){const n=this.segments(t),i=this.segments(e),r=this.combine(n,i),s=this.selectDifferenceRev(r);return this.polygon(s)}xor(t,e){const n=this.segments(t),i=this.segments(e),r=this.combine(n,i),s=this.selectXor(r);return this.polygon(s)}}const ce=new oe(new Zt);function he(t){var e,n;return{regions:[(null!==(n=null===(e=t.path)||void 0===e?void 0:e.points)&&void 0!==n?n:[]).map((t=>[t.x,t.y]))],inverted:!1}}function de(t){const n=t.regions.map((t=>_(t.map((t=>e(t[0],t[1]))))));return n.length<1?m():1==n.length?n[0]:u(...n)}var ue,ge=Object.freeze({__proto__:null,difference:function(t,e,n){const i=n?new oe(new Zt(n)):ce,r=he(t),s=he(e);return de(i.difference(r,s))},intersect:function(t,e,n){const i=n?new oe(new Zt(n)):ce,r=he(t),s=he(e);return de(i.intersect(r,s))},union:function(t,e,n){const i=n?new oe(new Zt(n)):ce,r=he(t),s=he(e);return de(i.union(r,s))},xor:function(t,e,n){const i=n?new oe(new Zt(n)):ce,r=he(t),s=he(e);return de(i.xor(r,s))}});!function(t){t.outer_shadow=function(t,e,n,i,r,s="outer-shadow",a,l,o=1){return`\n        <filter id="${s}" x="-${100*((a-1)/2)}%" y="-${100*((l-1)/2)}%" width="${100*a}%" height="${100*l}%">\n            <feMorphology operator="dilate" radius="${n*o}" in="SourceAlpha" result="dilated" />\n            <feGaussianBlur in="dilated" stdDeviation="${i*o}" />\n            <feOffset dx="${t*o}" dy="${e*o}" result="offsetblur" />\n            <feFlood flood-color="${r}" result="colorblur"/>\n            <feComposite in="colorblur" in2="offsetblur" operator="in" result="shadow" />\n            <feComposite in="shadow" in2="SourceAlpha" operator="out" result="clipped-shadow"/>\n        </filter>\n        `}}(ue||(ue={}));var pe=Object.freeze({__proto__:null,get string_filter(){return ue}});let _e={bbox:void 0,xrange:[-2,2],yrange:[-2,2],xticks:void 0,yticks:void 0,n_sample:100,ticksize:.1,headsize:.05,tick_label_offset:0};function me(t){let n=Object.assign(Object.assign({},_e),t);if(null==n.bbox){let[t,i]=n.xrange,[r,s]=n.yrange;n.bbox=[e(t,r),e(i,s)]}let[i,r]=n.bbox,[s,a]=n.xrange,[l,o]=n.yrange;return function(t){return e(i.x+(t.x-s)/(a-s)*(r.x-i.x),i.y+(t.y-l)/(o-l)*(r.y-i.y))}}let fe=me;function be(t){let n=Object.assign(Object.assign({},_e),t);if(null==n.bbox){let[t,i]=n.xrange,[r,s]=n.yrange;n.bbox=[e(t,r),e(i,s)]}let[i,r]=n.bbox,a=i.x+(r.x-i.x)/(n.xrange[1]-n.xrange[0])*(0-n.xrange[0]),l=i.y+(r.y-i.y)/(n.yrange[1]-n.yrange[0])*(0-n.yrange[0]);return u(gt(e(i.x,l),e(r.x,l),n.headsize).append_tags(s.GRAPH_AXIS),gt(e(a,i.y),e(a,r.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function ve(t){let n=Object.assign(Object.assign({},_e),t);if(null==n.bbox){let[t,i]=n.xrange,[r,s]=n.yrange;n.bbox=[e(t,r),e(i,s)]}let[i,r]=n.bbox;return u(ut(i,e(r.x,i.y),n.headsize).append_tags(s.GRAPH_AXIS),ut(i,e(i.x,r.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function ye(t){let n=Object.assign(Object.assign({},_e),t);if(null==n.bbox){let[t,i]=n.xrange,[r,s]=n.yrange;n.bbox=[e(t,r),e(i,s)]}let[i,r]=n.bbox,a=2*n.ticksize;null==n.xticks&&(n.xticks=Oe(n.xrange[0],n.xrange[1],!1),n.xticks=n.xticks.filter((t=>t>n.xrange[0]&&t<n.xrange[1])));let l=(n.xticks[1]-n.xticks[0])/2,o=n.xticks[0]-l,c=me(n),h=c(e(o-l/2,0)),d=c(e(o+l/2,0)),_=d.x-h.x,m=h.add(e(1*_/3,-a/2)),f=h.add(e(2*_/3,a/2)),b=g([h,m,f,d]),v=u(p(i,h),b,ut(d,e(r.x,i.y),n.headsize)).append_tags(s.GRAPH_AXIS);return u(v,ut(i,e(i.x,r.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function xe(t,n,i){let r=Object.assign(Object.assign({},_e),i),a=r.ticksize,l=me(r)(e(t,n));return p(e(l.x,l.y+a/2),e(l.x,l.y-a/2)).stroke("gray").append_tags(s.GRAPH_TICK)}function we(t,n,i,r){let a=xe(t,n,r),l=pt(i).move_origin_text("top-center").translate(a.get_anchor("bottom-center")).translate(e(0,-((null==r?void 0:r.tick_label_offset)||0))).textfill("gray").append_tags(s.GRAPH_TICK_LABEL);return u(a,l)}function ke(t,n,i){let r=Object.assign(Object.assign({},_e),i),a=r.ticksize,l=me(r)(e(n,t));return p(e(l.x+a/2,l.y),e(l.x-a/2,l.y)).stroke("gray").append_tags(s.GRAPH_TICK)}function Ee(t,n,i,r){let a=ke(t,n,r),l=pt(i).move_origin_text("center-right").translate(a.get_anchor("center-left")).translate(e(-((null==r?void 0:r.tick_label_offset)||0),0)).textfill("gray").append_tags(s.GRAPH_TICK_LABEL);return u(a,l)}function Ae(t){return.1<t&&t<2?1:t}function Se(t,e){let n=e-t,i=Math.floor(Math.log10(n)),r=[.1,.15,.2,.5,1].map((t=>t*Math.pow(10,i))),s=r.map((t=>Math.floor(n/t)));for(let t=0;t<s.length;t++)if(s[t]<=10)return Ae(r[t]);return Ae(r.slice(-1)[0])}function Oe(t,e,n=!0){return n&&t<0&&e>0?function(t,e,n=!0){if(t>0)throw new Error("neg must be negative");if(e<0)throw new Error("pos must be positive");let i=Math.max(-t,e),r=Se(-i,i),s=Math.ceil(t/r)*r,a=Math.floor(e/r)*r,l=S(s,a,Math.floor((a-s)/r)+1),o=-Math.floor(Math.log10(r));return o>=0&&(l=l.map((t=>parseFloat(t.toFixed(o))))),n?l.filter((t=>0!=t)):l}(t,e):function(t,e){let n=Se(t,e),i=Math.round(t/n)*n,r=Math.round(e/n)*n,s=C(0,Math.round((r-i)/n)).map((t=>i+t*n)),a=-Math.floor(Math.log10(n)-1);return a>=0&&(s=s.map((t=>parseFloat(t.toFixed(a))))),s}(t,e)}function Le(t,e=0,n=!1){let i=Object.assign(Object.assign({},_e),t);return null==i.xticks&&(i.xticks=Oe(i.xrange[0],i.xrange[1],0==e)),i.xticks=i.xticks.filter((t=>t>i.xrange[0]&&t<i.xrange[1])),u(...n?i.xticks.map((t=>xe(t,e,i))):i.xticks.map((t=>we(t,e,t.toString(),i))))}function Ce(t,e=0,n=!1){let i=Object.assign(Object.assign({},_e),t);return null==i.yticks&&(i.yticks=Oe(i.yrange[0],i.yrange[1],0==e)),i.yticks=i.yticks.filter((t=>t>i.yrange[0]&&t<i.yrange[1])),u(...n?i.yticks.map((t=>ke(t,e,i))):i.yticks.map((t=>Ee(t,e,t.toString(),i))))}function Me(t){let e=Object.assign(Object.assign({},_e),t),n=e.xrange[0],i=e.yrange[0];return u(ve(e),Le(e,i),Ce(e,n))}function Te(t){let e=Object.assign(Object.assign({},_e),t);return u(be(e),Le(e),Ce(e))}function ze(t){let n=Object.assign(Object.assign({},_e),t);if(null==n.bbox){let[t,i]=n.xrange,[r,s]=n.yrange;n.bbox=[e(t,r),e(i,s)]}let i=me(n)(e(0,0));return u(gt(e(n.bbox[0].x,i.y),e(n.bbox[1].x,i.y),n.headsize).append_tags(s.GRAPH_AXIS),Le(n,0))}function Ne(t){let n=Object.assign(Object.assign({},_e),t);if(null==n.bbox){let[t,i]=n.xrange,[r,s]=n.yrange;n.bbox=[e(t,r),e(i,s)]}let i=me(n)(e(0,0));return u(gt(e(i.x,n.bbox[0].y),e(i.x,n.bbox[1].y),n.headsize).append_tags(s.GRAPH_AXIS),Ce(n,0))}function He(t){let n=Object.assign(Object.assign({},_e),t);return null==n.xticks&&(n.xticks=Oe(n.xrange[0],n.xrange[1],!1)),u(...n.xticks.map((t=>p(e(t,n.yrange[0]),e(t,n.yrange[1])).transform(me(n)).stroke("gray")))).append_tags(s.GRAPH_GRID)}function De(t){let n=Object.assign(Object.assign({},_e),t);return null==n.yticks&&(n.yticks=Oe(n.yrange[0],n.yrange[1],!1)),u(...n.yticks.map((t=>p(e(n.xrange[0],t),e(n.xrange[1],t)).transform(me(n)).stroke("gray")))).append_tags(s.GRAPH_GRID)}function Ie(t){let n=Object.assign(Object.assign({},_e),t);return null==n.xticks&&(n.xticks=Oe(n.xrange[0],n.xrange[1],!1)),null==n.yticks&&(n.yticks=Oe(n.yrange[0],n.yrange[1],!1)),u(...n.xticks.map((t=>p(e(t,n.yrange[0]),e(t,n.yrange[1])).transform(me(n)).stroke("gray"))),...n.yticks.map((t=>p(e(n.xrange[0],t),e(n.xrange[1],t)).transform(me(n)).stroke("gray"))))}function qe(t,e){let n,i=Object.assign(Object.assign({},_e),e),[r,s]=i.xrange,[a,l]=i.yrange,o=[],c=[];for(let e=0;e<t.length;e++){let n=t[e];n.x>=r&&n.x<=s&&n.y>=a&&n.y<=l?c.push(n):(c.length>1&&o.push(c),c=[])}c.length>1&&o.push(c);let h=o.map((t=>g(t)));return n=1==h.length?h[0]:u(...h).stroke("black").fill("none"),n.transform(me(i))}function Re(t,n,i){if(t.length!=n.length)throw new Error("xdata and ydata must have the same length");return qe(t.map(((t,i)=>e(t,n[i]))),i)}function je(t,n){let i=Object.assign(Object.assign({},_e),n);return qe(S(...i.xrange,i.n_sample).map((n=>e(n,t(n)))),n)}function Be(t,n,i,r){let s=Object.assign(Object.assign({},_e),r),a=Object.assign({},s);return a.xrange=[n,i],a.bbox=void 0,je(t,a).add_points([e(i,0),e(n,0)]).to_polygon().transform(me(s))}var Pe=Object.freeze({__proto__:null,ax:fe,axes_corner_empty:ve,axes_corner_empty_xbreak:ye,axes_empty:be,axes_transform:me,default_axes_options:_e,get_tick_numbers:Oe,plot:Re,plotf:je,plotv:qe,under_curvef:Be,xaxis:ze,xgrid:De,xtickmark:we,xtickmark_empty:xe,xticks:Le,xyaxes:Te,xycorneraxes:Me,xycorneraxes_xbreak:function(t){let e=Object.assign(Object.assign({},_e),t),n=e.xrange[0],i=e.yrange[0];return u(ye(e),Le(e,i),Ce(e,n))},xygrid:Ie,yaxis:Ne,ygrid:He,ytickmark:Ee,ytickmark_empty:ke,yticks:Ce});function Fe(t,n,i=1,r){let[s,a,l]=t,o=s.sub(a),c=l.sub(a);if(null==r&&(r=e(0,0)),"number"==typeof r){r=o.normalize().add(c.normalize()).normalize().scale(r)}let h=o.angle(),d=c.angle();d<h&&(d+=2*Math.PI);let g=ht(i,d-h).rotate(h).add_points([e(0,0)]).to_polygon();return""==n||null==n?g.position(a):u(g,pt(n).translate(r)).position(a)}var Ge=Object.freeze({__proto__:null,angle:Fe,angle_smaller:function(t,e,n=1,i){let[r,s,a]=t,l=r.sub(s),o=a.sub(s),c=l.angle(),h=o.angle();return h<c&&(h+=2*Math.PI),Fe(h-c>Math.PI?[a,s,r]:[r,s,a],e,n,i)},congruence_mark:function(t,n,i,r=1,s){let a=n.sub(t),l=Math.atan2(a.x,-a.y),o=t.add(n).scale(.5);s=null!=s?s:r/2;let c=[];for(let t=0;t<i;t++){let n=p(e(-r/2,t*s),e(r/2,t*s));c.push(n)}return u(...c).rotate(l).move_origin("center-center").position(o)},length:function(t,n,i,r,s,a,l=!0){s=null!=s?s:n.sub(t).length()/20,a=null!=a?a:2*r;let o=t.equals(n)?e(0,0):n.sub(t).normalize(),c=e(o.y,-o.x),h=t.add(c.scale(r)),d=n.add(c.scale(r)),g=l?p(h.sub(c.scale(s/2)),h.add(c.scale(s/2))):p(h,h.sub(c.scale(s))),_=l?p(d.sub(c.scale(s/2)),d.add(c.scale(s/2))):p(d,d.sub(c.scale(s))),m=u(p(h,d),g,_),f=t.add(n).scale(.5);return u(m,pt(i).position(f.add(c.scale(a))))},parallel_mark:function(t,n,i,r=1,s,a=.5){let l=n.sub(t),o=Math.atan2(l.x,-l.y),c=t.add(n).scale(.5);s=null!=s?s:r/2;let h=[],d=r/2*Math.cos(a);for(let t=0;t<i;t++){let n=e(0,t*s-d),i=p(e(-r/2,t*s),n),a=p(e(r/2,t*s),n);h.push(i.combine(a))}return u(...h).rotate(o).move_origin("center-center").position(c)},right_angle:function(t,n=1){let[i,r,s]=t,a=i.sub(r).normalize().scale(n).add(r),l=s.sub(r).normalize().scale(n).add(r);return g([a,e(a.x,l.y),l])},vector:function(t,n,i,r){null==i&&(i=e(0,0));let s=dt(t,r);return""==n||null==n?s:u(s,pt(n).position(t.add(i)))}});var Ve=Object.freeze({__proto__:null,inclined_plane:function(t,n){return _([e(0,0),e(t,t*Math.tan(n)),e(t,0)])},spring:function(t,n,i=1,r=10,s=.5,a=100){let l=n.sub(t).angle(),o=n.sub(t).length(),c=s,h=i/c,d=(2*r+1)*Math.PI,u=(o-2*c)/d;return g(S(0,d,a).map((t=>e(u*t+c-c*Math.cos(t),h*c*Math.sin(t))))).rotate(l).translate(t)}});let $e={gap:.1,ticksize:.2,bbox:[e(0,0),e(10,10)]};function Ue(t,n){var i,r;let s=Object.assign(Object.assign({},$e),n),a=t.length,l=Math.max(...t),o=null!==(i=s.yrange)&&void 0!==i?i:[0,l],c=null!==(r=s.bbox)&&void 0!==r?r:[e(0,0),e(10,l)];return{xrange:[-1,a],yrange:o,headsize:0,ticksize:s.ticksize,bbox:c}}var Xe=Object.freeze({__proto__:null,axes_tansform:function(t,e={}){return me(Ue(t,Object.assign(Object.assign({},$e),e)))},default_bar_options:$e,plot:function(t,n={}){let i=Object.assign(Object.assign({},$e),n),r=me(Ue(t,i));return u(...t.map(((t,n)=>rt(1-i.gap,t).move_origin("bottom-center").position(e(Number(n),0)).transform(r))))},xaxes:function(t,n={}){let i=Object.assign(Object.assign({},$e),n),r=t.length,s=me(Ue(t.map((()=>1)),i));return u(p(e(-1,0),e(r,0)).transform(s).stroke("gray"),...t.map(((t,n)=>f(t).move_origin_text("top-center").position(e(Number(n),0)).transform(s).translate(e(0,-i.ticksize/2)).textfill("gray"))))},yaxes:function(t,n={}){var i;let r=Object.assign(Object.assign({},$e),n),s=Ue(t,r),a=s.yrange[1],l=null!==(i=r.yrange)&&void 0!==i?i:[0,a],o=me(s),c=p(e(-1,0),e(-1,l[1])).transform(o).stroke("gray");return Ce(s,-1).combine(c)}});var We,Je=Object.freeze({__proto__:null,axis:function(t,n,i=1){return gt(e(t,0),e(n,0),i).fill("black").append_tags(s.GRAPH_AXIS)},numbered_ticks:function(t,n,i){let r=[];for(let a of t){let t=p(e(a,-n/2),e(a,n/2)).stroke("black").append_tags(s.GRAPH_TICK),l=f(a.toString()).move_origin("top-center").position(e(a,-n/2-i)).append_tags(s.GRAPH_TICK_LABEL);r.push(u(t,l))}return u(...r)},single_tick:function(t,n,i,r){let a=p(e(t,-i/2),e(t,i/2)).stroke("black").append_tags(s.GRAPH_TICK);return""==n?a:u(a,f(n).move_origin("top-center").position(e(t,-i/2-r)).append_tags(s.GRAPH_TICK_LABEL))},ticks:function(t,n){let i=[];for(let r of t){let t=p(e(r,-n/2),e(r,n/2)).stroke("black").append_tags(s.GRAPH_TICK);i.push(t)}return u(...i)}});function Ye(t,e,n,i=We.ROWS){let r=i==We.ROWS?t:M(t),a=r.length,l=Math.max(...r.map((t=>t.length)));const o=function(t){var e;let n=t.length,i=Math.max(...t.map((t=>t.length))),r=Array(n).fill(!1).map((()=>Array(i).fill(!1)));for(let s=0;s<n;s++)for(let n=0;n<i;n++){const i=t[s][n];(null==i||(null===(e=null==i?void 0:i.is_empty)||void 0===e?void 0:e.call(i)))&&(r[s][n]=!0)}return r}(t);let c=Ke(a,l,e,n,o),h=Qe(c),d=[];for(let t=0;t<a;t++)for(let e=0;e<l;e++){let n=r[t][e];null!=n&&(n=n.move_origin("center-center").position(h[t][e]).append_tags(s.TABLE_CONTENT).append_tags(s.ROW_+t).append_tags(s.COL_+e),d.push(n))}let g=u(...d);return u(c,g).append_tags(s.CONTAIN_TABLE)}function Ke(t,n,i,r,a){for(;i.length<t;)i.push(i[i.length-1]);for(;r.length<n;)r.push(r[r.length-1]);let l=[],o=0;for(let c=0;c<t;c++){let t=o-i[c],h=0,d=[];for(let i=0;i<n;i++){let n=h+r[i],l=(h+n)/2,u=(o+t)/2,g=st(e(h,t),e(n,o)).move_origin(e(l,u)).append_tags(s.TABLE_CELL).append_tags(s.ROW_+c).append_tags(s.COL_+i);a[c][i]&&(g=g.append_tags(s.EMPTY_CELL)),d.push(g),h=n}l.push(u(...d)),o=t}return u(...l).append_tags(s.TABLE)}function Qe(t){let e=t;if(t.tags.includes(s.CONTAIN_TABLE))for(let n of t.children)if(n.tags.includes(s.TABLE)){e=n;break}if(!e.tags.includes(s.TABLE))return[];let n=[];for(let t of e.children){let e=[];for(let n of t.children)e.push(n.origin);n.push(e)}return n}!function(t){t.ROWS="rows",t.COLUMNS="columns"}(We||(We={}));var Ze=Object.freeze({__proto__:null,empty_fixed_size:Ke,fixed_size:Ye,get_points:Qe,style_cell:function t(e,n){let i=e.copy();if(e.tags.includes(s.CONTAIN_TABLE)){let e=i.children.findIndex((t=>t.tags.includes(s.TABLE))),r=t(i.children[e],n);return i.children[e]=r,i}if(!e.tags.includes(s.TABLE))return e;for(let t of n){let[e,n]=t.index,r=i.children[e].children[n];t.fill&&(r=r.fill(t.fill)),t.stroke&&(r=r.stroke(t.stroke)),t.strokewidth&&(r=r.strokewidth(t.strokewidth)),i.children[e].children[n]=r}return i},table:function(t,e=0,n=We.ROWS,i=0,r=0){let s=n==We.ROWS?t:M(t);const a=T(e);function l(t){if(null==t)return[r,i];let[e,n]=t.bounding_box();return[n.x-e.x+a[1]+a[3],n.y-e.y+a[0]+a[2]]}let o=s.length,c=Math.max(...s.map((t=>t.length))),h=Array(o).fill(i),d=Array(c).fill(r);for(let t=0;t<o;t++)for(let e=0;e<c;e++){let[n,i]=l(s[t][e]);h[t]=Math.max(h[t],i),d[e]=Math.max(d[e],n)}return Ye(t,h,d,n)}});let tn={ticksize:.2,range:[0,1],bbox:[e(0,0),e(10,10)],orientation:"x",headsize:.05,tick_label_offset:0};function en(t){var n;let i=Object.assign(Object.assign({},tn),t);if(i.bbox=null!==(n=i.bbox)&&void 0!==n?n:[e(0,0),e(10,10)],"x"==i.orientation){return{xrange:i.range,yrange:[i.bbox[0].y,i.bbox[1].y],xticks:i.ticks,headsize:i.headsize,ticksize:i.ticksize,bbox:i.bbox,tick_label_offset:i.tick_label_offset}}return{xrange:[i.bbox[0].x,i.bbox[1].x],yrange:i.range,yticks:i.ticks,headsize:i.headsize,ticksize:i.ticksize,bbox:i.bbox,tick_label_offset:i.tick_label_offset}}var nn,rn=Object.freeze({__proto__:null,axes:function(t={}){let n=Object.assign(Object.assign({},tn),t),i=en(n),[r,s]=n.bbox;if("x"==n.orientation){return u(gt(e(r.x,0),e(s.x,0),n.headsize),Le(i,0)).stroke("gray").fill("gray")}return u(gt(e(0,r.y),e(0,s.y),n.headsize),Ce(i,0)).stroke("gray").fill("gray")},default_bar_options:tn,empty_tickmarks:function(t,e={}){let n=Object.assign(Object.assign({},tn),e),i=en(n);return"x"==n.orientation?(i.xticks=t,Le(i,0,!0)):(i.yticks=t,Ce(i,0,!0))},plotQ:function(t,n,i,r){let s=Object.assign(Object.assign({},tn),r),a=me(en(s)),[l,o,c,h,d]=t,g=.8*i;if("x"==s.orientation){return u(rt(h-o,i).move_origin("center-left").position(e(o,n)).transform(a),p(e(l,n-g/2),e(l,n+g/2)).transform(a),p(e(d,n-g/2),e(d,n+g/2)).transform(a),p(e(c,n-i/2),e(c,n+i/2)).transform(a),p(e(l,n),e(o,n)).transform(a),p(e(h,n),e(d,n)).transform(a))}return u(rt(i,h-o).move_origin("bottom-center").position(e(n,o)).transform(a),p(e(n-g/2,l),e(n+g/2,l)).transform(a),p(e(n-g/2,d),e(n+g/2,d)).transform(a),p(e(n-i/2,c),e(n+i/2,c)).transform(a),p(e(n,l),e(n,o)).transform(a),p(e(n,h),e(n,d)).transform(a))},to_ax_options:en});function sn(t,n){let i=t.p,r=t.p.add(t.dir),s=n.p,a=n.p.add(n.dir),l=i.x,o=i.y,c=r.x,h=r.y,d=s.x,u=s.y,g=a.x,p=a.y,_=(l-c)*(u-p)-(o-h)*(d-g);return e(((l*h-o*c)*(d-g)-(l-c)*(d*p-u*g))/_,((l*h-o*c)*(u-p)-(o-h)*(d*p-u*g))/_)}function an(t,e){return{type:nn.LINE,p:t,dir:e}}function ln(t,e){return an(t,e.sub(t))}function on(t,n){let[i,r]=n,s=i,a=r,l=e(s.x,a.y),o=e(a.x,s.y),c=[sn(t,ln(l,a)),sn(t,ln(a,o)),sn(t,ln(o,s)),sn(t,ln(s,l))];const h=1e-6;let d=c.filter((t=>(t=>t.x>=s.x-h&&t.x<=a.x+h&&t.y>=s.y-h&&t.y<=a.y+h)(t)));if(!(d.length<=1))return p(d[0],d[1])}!function(t){t.LINE="LINE"}(nn||(nn={}));var cn=Object.freeze({__proto__:null,get_preview_diagram:function(n,i){let r=[],s=[],a={[nn.LINE]:s},l=Object.keys(n);for(let e of l){let i=n[e];"number"!=typeof i&&(i instanceof t?r.push({name:e,p:i}):a[i.type].push({name:e,obj:i}))}let o=Math.min(...r.map((t=>t.p.x))),c=Math.max(...r.map((t=>t.p.x))),h=Math.min(...r.map((t=>t.p.y))),d=Math.max(...r.map((t=>t.p.y)));null==i&&(i=.1*Math.max(c-o,d-h));let g=[e(o-(i=function(t){let e="number"==typeof t?[t]:t;switch(e.length){case 0:return[0,0,0,0];case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];default:return[e[0],e[1],e[2],e[3]]}}(i))[0],h-i[1]),e(c+i[2],d+i[3])],p=s.map((t=>on(t.obj,g))).filter((t=>void 0!==t)),_=.01*Math.max(g[1].x-g[0].x,g[1].y-g[0].y)*2/3;return u(...p,...r.map((t=>{let n=ct(_).translate(t.p).fill("black"),i=pt(t.name).translate(t.p.add(e(2*_,2*_))).move_origin_text("bottom-left"),r=i.copy().textfill("white").textstroke("white").textstrokewidth(10).opacity(.7);return n.combine(r,i)})))},intersect:function(t,e){if(t.type===nn.LINE&&e.type===nn.LINE){return[sn(t,e)]}return[]},line:an,line_from_angle:function(t,e){return an(t,n(e))},line_from_points:ln,line_from_slope:function(t,n){return an(t,e(1,n))},line_intersection:sn,line_parallel_at_point:function(t,e){return an(e,t.dir)},line_perpendicular_at_point:function(t,n){return an(n,e(-t.dir.y,t.dir.x))},line_rotated_at_point:function(t,e,n){return an(n,t.dir.rotate(e))},point_collinear_extend_length:function(t,e,n){let i=e.sub(t).normalize();return e.add(i.scale(n))},point_collinear_fraction:function(t,e,n){let i=e.sub(t);return t.add(i.scale(n))},point_onLine_atDistance_from:function(t,e,n){let i=t.dir.normalize();return n.add(i.scale(e))},point_onLine_with_x:function(t,n){let i=t.dir.y/t.dir.x;return e(n,i*n+(t.p.y-i*t.p.x))},point_onLine_with_y:function(t,n){let i=t.dir.y/t.dir.x;return e((n-(t.p.y-i*t.p.x))/i,n)}});class hn{constructor(t,e,n=0,i=0){var r;this.diagram=t.value,this.size=ft(this.diagram),this.x=-1,this.y=n,this.tree=t;let s=null!==(r=t.children)&&void 0!==r?r:[];this.children=s.map(((t,e)=>new hn(t,this,n+1,e))),this.parent=e,this.thread=void 0,this.mod=0,this.ancestor=this,this.change=0,this.shift=0,this.number=i}left(){return this.thread?this.thread:this.children.length>0?this.children[0]:void 0}right(){return this.thread?this.thread:this.children.length>0?this.children[this.children.length-1]:void 0}lsibling(){if(this.parent)return this.number>0?this.parent.children[this.number-1]:void 0}}function dn(t,e,n){let i=pn(new hn(t,void 0),n),r=fn(i,0,0,e,0);return r<0&&gn(i,-r),un(i),i}function un(t){t.diagram=t.diagram.position(e(t.x,t.y)),t.children.forEach(un)}function gn(t,e){t.x+=e,t.children.forEach((t=>gn(t,e)))}function pn(t,e){let n=t.size[0]/2;if(0===t.children.length){let i=t.lsibling();if(i){let r=i.size[0]/2+n+e;t.x=i.x+r}else t.x=0}else{let i=t.children[0];t.children.forEach((t=>{pn(t,e),i=function(t,e,n){let i=t.lsibling();if(void 0!==i){let r=t,s=t,a=i,l=t.parent&&0!==t.number?t.parent.children[0]:void 0,o=t.mod,c=t.mod,h=a.mod,d=l.mod;for(;void 0!==(null==a?void 0:a.right())&&void 0!==(null==r?void 0:r.left());){a=a.right(),r=r.left(),l=null==l?void 0:l.left(),s=null==s?void 0:s.right(),s.ancestor=t;let i=a.size[0]/2+r.size[0]/2+n,u=a.x+h-(r.x+o)+i;if(u>0){_n(mn(a,t,e),t,u),o+=u,c+=u}h+=a.mod,o+=r.mod,d+=l.mod,c+=s.mod}void 0!==a.right()&&void 0===s.right()?(s.thread=a.right(),s.mod+=h-c):(void 0!==(null==r?void 0:r.left())&&void 0===(null==l?void 0:l.left())&&(l.thread=r.left(),l.mod+=o-d),e=t)}return e}(t,i,e)})),function(t){let e=0,n=0;for(let i=t.children.length-1;i>=0;i--){let r=t.children[i];r.x+=e,r.mod+=e,n+=r.change,e+=r.shift+n}}(t);let r=(t.children[0].x+t.children[t.children.length-1].x)/2,s=t.lsibling();if(s){let i=s.size[0]/2+n+e;t.x=s.x+i,t.mod=t.x-r}else t.x=r}return t}function _n(t,e,n){let i=e.number-t.number;e.change-=n/i,e.shift+=n,t.change+=n/i,e.x+=n,e.mod+=n}function mn(t,e,n){var i;return(null===(i=e.parent)||void 0===i?void 0:i.children.includes(t.ancestor))?t.ancestor:n}function fn(t,e,n,i,r){return t.x+=e,t.y=-n*i,r=Math.min(null!=r?r:t.x,t.x),t.children.forEach((s=>{r=fn(s,e+t.mod,n+1,i,r)})),r}function bn(t){let e=t.diagram,n=t.children.map(bn),i=t.children.map((t=>p(e.get_anchor("bottom-center"),t.diagram.get_anchor("top-center"))));return u(e,...i,...n)}var vn=Object.freeze({__proto__:null,mirror_treenode:function t(e){var n;return{value:e.value,children:(null!==(n=e.children)&&void 0!==n?n:[]).map(t).reverse()}},tree:function(t,e,n){return bn(dn(t,e,n))}});function yn(t,n=10){const i=t.length;let r=t.map((t=>t.y)),s=new Array(i).fill(0),a=new Array(i).fill(0),l=new Array(i-1);for(let e=0;e<i-1;e++)l[e]=t[e+1].x-t[e].x;let o=new Array(i-1).fill(0),c=new Array(i).fill(0),h=new Array(i).fill(1),d=new Array(i).fill(0),u=new Array(i).fill(0);for(let t=1;t<i-1;t++)o[t]=3/l[t]*(r[t+1]-r[t])-3/l[t-1]*(r[t]-r[t-1]);for(let e=1;e<i-1;e++)h[e]=2*(t[e+1].x-t[e-1].x)-l[e-1]*d[e-1],d[e]=l[e]/h[e],u[e]=(o[e]-l[e-1]*u[e-1])/h[e];for(let t=i-2;t>=0;t--)c[t]=u[t]-d[t]*c[t+1],s[t]=(r[t+1]-r[t])/l[t]-l[t]*(c[t+1]+2*c[t])/3,a[t]=(c[t+1]-c[t])/(3*l[t]);let g=[];for(let l=0;l<i-1;l++)for(let i=0;i<=n;i++){let o=t[l].x+i*(t[l+1].x-t[l].x)/n,h=r[l]+s[l]*(o-t[l].x)+c[l]*Math.pow(o-t[l].x,2)+a[l]*Math.pow(o-t[l].x,3);g.push(e(o,h))}return g}var xn=Object.freeze({__proto__:null,bezier_cubic:function(t,e,n,i,r=100){const s=1/(r-1),a=Array(r);for(let l=0;l<r;l++){const r=l*s,o=t.scale((1-r)*(1-r)*(1-r)),c=e.scale(3*r*(1-r)*(1-r)),h=n.scale(3*r*r*(1-r)),d=i.scale(r*r*r);a[l]=o.add(c).add(h).add(d)}return g(a)},bezier_quadratic:function(t,e,n,i=100){const r=1/(i-1),s=Array(i);for(let a=0;a<i;a++){const i=a*r,l=t.scale((1-i)*(1-i)),o=e.scale(2*i*(1-i)),c=n.scale(i*i);s[a]=l.add(o).add(c)}return g(s)},cubic_spline:function(t,e=10){return g(yn(t,e))},curve_combine:function(...t){return g(t.map((t=>{var e,n;return null!==(n=null===(e=t.path)||void 0===e?void 0:e.points)&&void 0!==n?n:[]})).flat())},interpolate_cubic_spline:yn});function wn(t){return g([e(-t,-t),e(0,0),e(t,-t)]).fill("none").move_origin(e(0,0)).append_tags(s.ARROW_HEAD)}function kn(t,n,i){const r=wn(n).stroke(i).strokewidth(3).translate(e(0,t)).strokewidth(2),a=p(e(0,t),e(0,-t)).stroke(i).strokewidth(2).append_tags(s.ARROW_LINE),l=r.position(a.get_anchor("bottom-center")).reflect();return u(r,l,a).move_origin(a.get_anchor("center-center"))}function En(t=3,e="white",n="#8B5CF6",i=1.2){const r=.5*t;return u(at(2.4*t).fill(n).opacity(.25).apply(Jt(4)).stroke("none"),at(2*t).fill(e).apply(Jt(3)).stroke("none"),kn(r,i,n))}var An=Object.freeze({__proto__:null,arrow2:kn,arrowHead:wn,horizontalLocator:function(t=3,e="white",n="#8B5CF6",i=1.2){return En(t,e,n,i).rotate(Math.PI/2)},spanLocator:function(t=3,e="white",n="#8B5CF6",i=1.2){const r=.5*t;return u(at(2.4*t).fill(n).opacity(.25).apply(Jt(4)).stroke("none"),at(2*t).fill(e).apply(Jt(3)).stroke("none"),ct(r).stroke("none").fill(n))},verticalLocator:En});var Sn=Object.freeze({__proto__:null,decode:function(t){return decodeURIComponent(atob(t))},encode:function(t){return btoa(encodeURIComponent(t))}});export{Pt as Content,h as Diagram,Ft as DrawingElement,Vt as HeaderElement,zt as Interactive,Gt as ParagraphElement,d as Path,$t as Quizz,s as TAG,e as V2,n as Vdir,t as Vector2,j as _init_default_diagram_style,P as _init_default_text_diagram_style,G as _init_default_textdata,yt as align_horizontal,vt as align_vertical,Ge as annotation,ht as arc,A as array_repeat,dt as arrow,ut as arrow1,gt as arrow2,fe as ax,ve as axes_corner_empty,be as axes_empty,me as axes_transform,Xe as bar,ge as boolean,rn as boxplot,ct as circle,Dt as clientPos_to_svgPos,g as curve,xn as curves,R as default_diagram_style,B as default_text_diagram_style,F as default_textdata,u as diagram_combine,At as distribute_grid_row,xt as distribute_horizontal,kt as distribute_horizontal_and_align,St as distribute_variable_row,wt as distribute_vertical,Et as distribute_vertical_and_align,it as download_svg_as_png,nt as download_svg_as_svg,K as draw_to_svg,Q as draw_to_svg_element,m as empty,Sn as encoding,pe as filter,cn as geo_construct,bt as geometry,qt as get_SVGPos_from_event,J as get_tagged_svg_element,Pe as graph,et as handle_tex_in_svg,b as image,An as interactive,p as line,S as linspace,O as linspace_exc,Ve as mechanics,Kt as mod,v as multiline,y as multiline_bb,Je as numberline,Re as plot,je as plotf,qe as plotv,_ as polygon,L as range,C as range_inc,rt as rectangle,st as rectangle_corner,lt as regular_polygon,ot as regular_polygon_side,V as reset_default_styles,at as square,I as str_latex_to_unicode,q as str_to_mathematical_italic,Ze as table,f as text,pt as textvar,E as to_degree,k as to_radian,M as transpose,vn as tree,Be as under_curvef,z as utils,ze as xaxis,De as xgrid,we as xtickmark,xe as xtickmark_empty,Le as xticks,Te as xyaxes,Me as xycorneraxes,Ie as xygrid,Ne as yaxis,He as ygrid,Ee as ytickmark,ke as ytickmark_empty,Ce as yticks};
//# sourceMappingURL=diagrams.min.js.map
