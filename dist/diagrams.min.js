class t{constructor(t,e){this.x=t,this.y=e}add(e){return new t(this.x+e.x,this.y+e.y)}sub(e){return new t(this.x-e.x,this.y-e.y)}scale(e){return new t(this.x*e,this.y*e)}mul(e){return new t(this.x*e.x,this.y*e.y)}rotate(e){let n=this.x*Math.cos(e)-this.y*Math.sin(e),r=this.x*Math.sin(e)+this.y*Math.cos(e);return new t(n,r)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}equals(t){return this.x==t.x&&this.y==t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}length_sq(){return this.x*this.x+this.y*this.y}angle(){return Math.atan2(this.y,this.x)}normalize(){let e=this.length();return new t(this.x/e,this.y/e)}copy(){return new t(this.x,this.y)}apply(t){return t(this.copy())}}function e(e,n){return new t(e,n)}function n(e){return new t(Math.cos(e),Math.sin(e))}class r{static translate(t){return e=>e.add(t)}static rotate(t,e){return n=>n.sub(e).rotate(t).add(e)}static scale(t,e){return n=>n.sub(e).mul(t).add(e)}static reflect_over_point(t){return e=>e.sub(t).rotate(Math.PI).add(t)}static reflect_over_line(t,e){let n=e.sub(t).rotate(Math.PI/2).normalize();return e=>{let r=n.dot(e.sub(t));return e.sub(n.scale(2*r))}}static skewX(e,n){return r=>{let i=r.x+(n-r.y)*Math.tan(e);return new t(i,r.y)}}static skewY(e,n){return r=>{let i=r.y+(n-r.x)*Math.tan(e);return new t(r.x,i)}}}var i,s,a;!function(t){t.TEXT="TEXT",t.OPEN_TAG="OPEN_TAG",t.CLOSE_TAG="CLOSE_TAG",t.EOF="EOF"}(i||(i={}));class l{static parse_tag_content(t){if("/"===t[0]){let e=t.substring(1);return{type:i.CLOSE_TAG,attributes:{_tag_name:e}}}let e=t.indexOf(" "),n=t.indexOf("=");if(-1===e&&-1===n)return{type:i.OPEN_TAG,attributes:{_tag_name:t}};if(-1===e&&n>0){let e=t.substring(0,n),r=t.substring(n+1),s={_tag_name:e};return s[e]=r,{type:i.OPEN_TAG,attributes:s}}throw new Error("Unimplemented")}static parse(t){let e=[],n=0,r=t.length;for(;n<r;){let r=t.indexOf("[",n);if(-1===r){e.push({type:i.TEXT,attributes:{_text:t.substring(n)}});break}r>n&&e.push({type:i.TEXT,attributes:{_text:t.substring(n,r)}});let s=t.indexOf("]",r),a=t.indexOf("[",r+1);if(a>0&&a<s)return null;if(-1===s)return null;let o=t.substring(r+1,s);e.push(l.parse_tag_content(o)),n=s+1}return e}}class o{static from_BBCode(t,e="1em"){var n;let r=[],s=[],a=l.parse(t);if(null===a)return console.error("Invalid BBCode"),[];for(let t of a)switch(t.type){case i.OPEN_TAG:if("br"===t.attributes._tag_name){const t=null!==(n=o.build_style(s)["_line-height"])&&void 0!==n?n:e;r.push({text:"\n",style:{dy:t}});break}s.push(t.attributes);break;case i.CLOSE_TAG:if(0===s.length)return console.error("Invalid BBCode"),[];if(s[s.length-1]._tag_name!==t.attributes._tag_name)return console.error("Invalid BBCode"),[];s.pop();break;case i.TEXT:{let e=o.build_style(s);r.push({text:t.attributes._text,style:e})}}return r}static split_tspans_by_words(t){let e=[];for(let n of t){let t=n.text.split(" ");for(let e=0;e<t.length-1;e++)t[e]+=" ";for(let r of t)e.push({text:r,style:JSON.parse(JSON.stringify(n.style))})}return e}static build_style(t){let e={};for(let n of t)switch(n._tag_name){case"b":e["font-weight"]="bold";break;case"i":e["font-style"]="italic";break;case"color":e.fill=n.color;break;case"size":e["font-size"]=n.size;break;case"dx":e.dx=n.dx;break;case"dy":e.dy=n.dy;break;case"font":e["font-family"]=n.font;break;case"var":e.textvar=!0;break;case"tag":e.tag=n.tag;break;case"lineheight":e["_line-height"]=n.lineheight;break;case"sup":e["baseline-shift"]="super",e["font-size-scale-factor"]=.7,e["is-prev-word"]=!0;break;case"sub":e["baseline-shift"]="-20%",e["font-size-scale-factor"]=.7,e["is-prev-word"]=!0}return e}}!function(t){t.EMPTY="empty",t.LINE="line",t.CIRCLE="circle",t.TEXTVAR="textvar",t.ROW_="row_",t.COL_="col_",t.ARROW_LINE="arrow_line",t.ARROW_HEAD="arrow_head",t.TABLE="table",t.CONTAIN_TABLE="contain_table",t.TABLE_CELL="table_cell",t.TABLE_CONTENT="table_content",t.EMPTY_CELL="empty_cell",t.GRAPH_AXIS="graph_axis_line",t.GRAPH_TICK="graph_tick",t.GRAPH_TICK_LABEL="graph_tick_label",t.GRAPH_GRID="graph_grid"}(s||(s={})),function(t){t.Polygon="polygon",t.Curve="curve",t.Text="text",t.Image="image",t.Diagram="diagram",t.MultilineText="multilinetext"}(a||(a={}));const c="16";class h{constructor(e,n={}){this.children=[],this.path=void 0,this.origin=new t(0,0),this.style={},this.textdata={},this.multilinedata={},this.imgdata={},this.mutable=!1,this.tags=[],this._bbox_cache=void 0,this.type=e,this.path=n.path,n.children&&(this.children=n.children),n.textdata&&(this.textdata=n.textdata),n.imgdata&&(this.imgdata=n.imgdata),n.tags&&(this.tags=n.tags),n.multilinedata&&(this.multilinedata=n.multilinedata)}mut(){this.mutable=!0,null!=this.path&&(this.path.mutable=!0);for(let t=0;t<this.children.length;t++)this.children[t].mut();return this}mut_parent_only(){return this.mutable=!0,null!=this.path&&(this.path.mutable=!0),this}immut(){let t=this.copy();t.mutable=!1,null!=this.path&&(this.path.mutable=!1);for(let e=0;e<t.children.length;e++)t.children[e].immut();return t}static deep_setPrototypeOf(e){Object.setPrototypeOf(e,h.prototype);let n=e;n.origin=Object.setPrototypeOf(n.origin,t.prototype);for(let t=0;t<n.children.length;t++)h.deep_setPrototypeOf(n.children[t]);null!=n.path&&(Object.setPrototypeOf(n.path,d.prototype),n.path=n.path.copy()),null!=n._bbox_cache&&2==n._bbox_cache.length&&(Object.setPrototypeOf(n._bbox_cache[0],t.prototype),Object.setPrototypeOf(n._bbox_cache[1],t.prototype))}copy(){let t=JSON.parse(JSON.stringify(this));return h.deep_setPrototypeOf(t),t}copy_if_not_mutable(){return this.mutable?this:this.copy()}append_tags(t){let e=this.copy_if_not_mutable();Array.isArray(t)||(t=[t]);for(let n of t)e.tags.includes(n)||e.tags.push(n);return e}remove_tags(t){let e=this.copy_if_not_mutable();return e.tags=e.tags.filter((e=>!t.includes(e))),e}reset_tags(){let t=this.copy_if_not_mutable();return t.tags=[],t}contain_tag(t){return this.tags.includes(t)}contain_all_tags(t){for(let e of t)if(!this.tags.includes(e))return!1;return!0}collect_children(){let t=[];if(this.type==a.Diagram)for(let e of this.children)t=t.concat(e.collect_children());else t.push(this);return t}flatten(){let t=this.copy_if_not_mutable();return t.children=t.collect_children(),t}apply(t){return t(this.copy_if_not_mutable())}apply_recursive(t){let e=this.copy_if_not_mutable();e=t(e);for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].apply_recursive(t);return e}apply_to_tagged_recursive(t,e){Array.isArray(t)||(t=[t]);let n=this.copy_if_not_mutable();n.contain_all_tags(t)&&(n=e(n));for(let r=0;r<n.children.length;r++)n.children[r]=n.children[r].apply_to_tagged_recursive(t,e);return n}get_tagged_elements(t){Array.isArray(t)||(t=[t]);let e=[];this.contain_all_tags(t)&&e.push(this.copy_if_not_mutable());for(let n=0;n<this.children.length;n++)e=e.concat(this.children[n].get_tagged_elements(t));return e}combine(...t){return u(this,...t)}to_curve(){let t=this.copy_if_not_mutable();if(t.type==a.Polygon)t.type=a.Curve;else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].to_curve();return t}to_polygon(){let t=this.copy_if_not_mutable();if(t.type==a.Curve)t.type=a.Polygon;else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].to_polygon();return t}add_points(t){let e=this.copy_if_not_mutable();if(e.type==a.Polygon||e.type==a.Curve){if(null==e.path)throw new Error(this.type+" must have a path");e.path=e.path.add_points(t)}else if(e.type==a.Diagram){let n=e.children[e.children.length-1];e.children[e.children.length-1]=n.add_points(t)}return e}update_style(t,e,n){let r=this.copy_if_not_mutable();if(null==n?void 0:n.includes(r.type))return r;if(r.type==a.Polygon||r.type==a.Curve||r.type==a.Text||r.type==a.Image||r.type==a.MultilineText)r.style[t]=e;else{if(r.type!=a.Diagram)throw new Error("Unreachable, unknown diagram type : "+r.type);for(let i=0;i<r.children.length;i++)r.children[i]=r.children[i].update_style(t,e,n)}return r}clone_style_from(t){return this.apply_recursive((e=>(e.style=Object.assign({},t.style),e)))}fill(t){return this.update_style("fill",t,[a.Text])}stroke(t){return this.update_style("stroke",t,[a.Text])}opacity(t){return this.update_style("opacity",t.toString())}strokewidth(t){return this.update_style("stroke-width",t.toString(),[a.Text])}strokelinecap(t){return this.update_style("stroke-linecap",t)}strokelinejoin(t){return this.update_style("stroke-linejoin",t)}strokedasharray(t){return this.update_style("stroke-dasharray",t.join(","))}vectoreffect(t){return this.update_style("vector-effect",t)}filter(t){return this.update_style("filter",`url(#${t})`)}textfill(t){return this.update_style("fill",t,[a.Polygon,a.Curve])}textstroke(t){return this.update_style("stroke",t,[a.Polygon,a.Curve])}textstrokewidth(t){return this.update_style("stroke-width",t.toString(),[a.Polygon,a.Curve])}update_textdata(t,e){let n=this.copy_if_not_mutable();if(n.type==a.Text||n.type==a.MultilineText)n.textdata[t]=e;else if(n.type==a.Diagram)for(let r=0;r<n.children.length;r++)n.children[r]=n.children[r].update_textdata(t,e);else if(n.type!=a.Polygon&&n.type!=a.Curve)throw new Error("Unreachable, unknown diagram type : "+n.type);return n}fontfamily(t){return this.update_textdata("font-family",t)}fontstyle(t){return this.update_textdata("font-style",t)}fontsize(t){return this.update_textdata("font-size",t.toString())}fontweight(t){return this.update_textdata("font-weight",t.toString())}fontscale(t){return this.update_textdata("font-scale",t.toString())}textanchor(t){return this.update_textdata("text-anchor",t)}textdy(t){return this.update_textdata("dy",t)}textangle(t){return this.update_textdata("angle",t.toString())}text_tovar(){let t=this.copy_if_not_mutable();if(t.type==a.Text)t=t.append_tags(s.TEXTVAR);else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].text_tovar();return t}text_totext(){let t=this.copy_if_not_mutable();if(t.type==a.Text)t=t.remove_tags("textvar");else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].text_totext();return t}bounding_box(){if(null!=this._bbox_cache)return this._bbox_cache;let e=1/0,n=1/0,r=-1/0,i=-1/0;if(this.type==a.Diagram){for(let t=0;t<this.children.length;t++){let s=this.children[t],[a,l]=s.bounding_box();e=Math.min(e,a.x),n=Math.min(n,a.y),r=Math.max(r,l.x),i=Math.max(i,l.y)}const s=[new t(e,n),new t(r,i)];return this._bbox_cache=s,s}if(this.type==a.Curve||this.type==a.Polygon||this.type==a.Image){if(null==this.path)throw new Error(this.type+" must have a path");for(let t=0;t<this.path.points.length;t++){let s=this.path.points[t];e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}const s=[new t(e,n),new t(r,i)];return this._bbox_cache=s,s}if(this.type==a.Text||this.type==a.MultilineText){const t=[this.origin.copy(),this.origin.copy()];return this._bbox_cache=t,t}throw new Error("Unreachable, unknown diagram type : "+this.type)}transform(t){let e=this.copy_if_not_mutable();e._bbox_cache=void 0;for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].transform(t);return null!=e.path&&(e.path=e.path.transform(t)),e.origin=t(e.origin),e}translate(t){const e=this._bbox_cache,n=this.transform(r.translate(t));return null!=e&&(n._bbox_cache=e.map((e=>r.translate(t)(e)))),n}position(e=new t(0,0)){let n=e.sub(this.origin);return this.translate(n)}rotate(t,e=void 0){return null==e&&(e=this.origin),this.transform(r.rotate(t,e))}scale(e,n){return null==n&&(n=this.origin),"number"==typeof e&&(e=new t(e,e)),this.transform(r.scale(e,n))}scaletext(t){return this.apply_recursive((e=>{switch(e.type){case a.Text:{let n=parseFloat(e.textdata["font-size"]||c),r=e.copy_if_not_mutable();return r.textdata["font-size"]=(n*t).toString(),r}case a.MultilineText:{let n=e.copy_if_not_mutable();return n.multilinedata["scale-factor"]=(n.multilinedata["scale-factor"]||1)*t,n}default:return e}}))}skewX(t,e){return null==e&&(e=this.origin),this.transform(r.skewX(t,e.y))}skewY(t,e){return null==e&&(e=this.origin),this.transform(r.skewY(t,e.x))}reflect_over_point(t){return this.transform(r.reflect_over_point(t))}reflect_over_line(t,e){return this.transform(r.reflect_over_line(t,e))}reflect(t,e){if(null==t&&null==e)return this.reflect_over_point(this.origin);if(null!=t&&null==e)return this.reflect_over_point(t);if(null!=t&&null!=e)return this.reflect_over_line(t,e);throw new Error("Unreachable")}vflip(e){return null==e&&(e=this.origin.y),this.reflect(new t(0,e),new t(1,e))}hflip(e){return null==e&&(e=this.origin.x),this.reflect(new t(e,0),new t(e,1))}get_anchor(e){let[n,r]=this.bounding_box(),i=n.x,s=n.y,a=r.x,l=r.y,o=(i+a)/2,c=(s+l)/2;switch(e){case"top-left":return new t(i,l);case"top-center":return new t(o,l);case"top-right":return new t(a,l);case"center-left":return new t(i,c);case"center-center":return new t(o,c);case"center-right":return new t(a,c);case"bottom-left":return new t(i,s);case"bottom-center":return new t(o,s);case"bottom-right":return new t(a,s);default:throw new Error("Unknown anchor "+e)}}move_origin(e){let n=this.copy_if_not_mutable();return n.origin=e instanceof t?e:n.get_anchor(e),n}__move_origin_text(t){let e=this.copy_if_not_mutable(),n=function(t){switch(t){case"top-left":return{"text-anchor":"start",dy:"0.75em"};case"top-center":return{"text-anchor":"middle",dy:"0.75em"};case"top-right":return{"text-anchor":"end",dy:"0.75em"};case"center-left":return{"text-anchor":"start",dy:"0.25em"};case"center-center":return{"text-anchor":"middle",dy:"0.25em"};case"center-right":return{"text-anchor":"end",dy:"0.25em"};case"bottom-left":return{"text-anchor":"start",dy:"-0.25em"};case"bottom-center":return{"text-anchor":"middle",dy:"-0.25em"};case"bottom-right":return{"text-anchor":"end",dy:"-0.25em"};default:throw new Error("Unknown anchor "+t)}}(t);return e.textdata["text-anchor"]=n["text-anchor"],e.textdata.dy=n.dy,e}move_origin_text(t){let e=this.copy_if_not_mutable();if(this.type==a.Text||this.type==a.MultilineText)e=e.__move_origin_text(t);else if(this.type==a.Diagram)for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].move_origin_text(t);return e}path_length(){if(this.type==a.Diagram){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].path_length();return t}if(this.type==a.Curve||this.type==a.Polygon){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.length()}throw new Error("Unreachable, unknown diagram type : "+this.type)}reverse_path(){var t;let e=this.copy_if_not_mutable();return e.path&&(e.path=null===(t=e.path)||void 0===t?void 0:t.reverse()),e}parametric_point(t,e){if(this.type==a.Diagram){let e=[],n=0;for(let t=0;t<this.children.length;t++)n+=this.children[t].path_length(),e.push(n);let r=n,i=e.map((t=>t/r));for(let e=0;e<i.length;e++)if(t<=i[e]){let n=e,r=0==e?0:i[e-1],s=(t-r)/(i[e]-r);return this.children[n].parametric_point(s)}throw Error("Unreachable")}if(this.type==a.Curve){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.parametric_point(t,!1,e)}if(this.type==a.Polygon){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.parametric_point(t,!0,e)}throw new Error("Unreachable, unknown diagram type : "+this.type)}debug_bbox(){let[e,n]=this.bounding_box(),r=_([new t(e.x,e.y),new t(n.x,e.y),new t(n.x,n.y),new t(e.x,n.y)]).apply((t=>t.fill("none").stroke("gray").strokedasharray([5,5]))),i=m("+").position(this.origin);return r.combine(i)}debug(t=!0){let e=t=>t.fill("none").stroke("red").strokedasharray([5,5]),n=t=>{let e=t.textfill("white").textstroke("white").textstrokewidth(5),n=t.fill("black");return e.combine(n)};if(this.type==a.Diagram)return this.debug_bbox();if(this.type==a.Text)return f(this.origin);if(this.type==a.Polygon||this.type==a.Curve||this.type==a.Image){let r=this.type==a.Polygon||a.Image?_:g,i=this.debug_bbox();if(null==this.path)throw new Error(this.type+" must have a path");let s=r(this.path.points).apply(e);if(0==t)return i.combine(s);let l,o=this.path.points,c=[],[h,d]=this.bounding_box(),u=Math.min(d.x-h.x,d.y-h.y)/10;for(let t=0;t<o.length;t++){(null==l?1/0:o[t].sub(l).length())<u||(c.push(m(t.toString()).position(o[t]).apply(n)),l=o[t])}return i.combine(s,...c)}throw new Error("Unreachable, unknown diagram type : "+this.type)}is_empty(){return this.contain_tag(s.EMPTY)}}class d{constructor(t){this.points=t,this.mutable=!1}copy(){let e=this.points.map((e=>new t(e.x,e.y)));return new d(e)}copy_if_not_mutable(){return this.mutable?this:this.copy()}reverse(){let t=this.copy_if_not_mutable();return t.points=t.points.reverse(),t}length(){let t=0;for(let e=1;e<this.points.length;e++)t+=this.points[e].sub(this.points[e-1]).length();return t}add_points(t){let e=this.copy_if_not_mutable();return e.points=e.points.concat(t),e}parametric_point(t,e=!1,n){let r=this.points;if(e&&(r=this.points.concat(this.points[0])),null==n){if(t<0||t>1)throw Error("t must be between 0 and 1");let n=[],i=0;for(let t=1;t<r.length;t++)i+=r[t].sub(r[t-1]).length(),n.push(i);let s=i,a=n.map((t=>t/s));for(let n=0;n<a.length;n++)if(t<=a[n]){let r=n,i=0==n?0:a[n-1],s=(t-i)/(a[n]-i);return this.parametric_point(s,e,r)}throw Error("Unreachable")}{if(n<0||n>r.length-1)throw Error("segment_index must be between 0 and n-1");let e=r[n],i=r[n+1].sub(e);return e.add(i.scale(t))}}transform(t){let e=this.copy_if_not_mutable();for(let n=0;n<e.points.length;n++)e.points[n]=t(e.points[n]);return e}}function u(...t){if(0==t.length)return f();let e=t.map((t=>t.copy_if_not_mutable())),n=!0;for(let t=0;t<e.length;t++)if(!e[t].mutable){n=!1;break}let r=new h(a.Diagram,{children:e});return r.mutable=n,r.move_origin(t[0].origin)}function g(t){let e=new d(t);return new h(a.Curve,{path:e})}function p(t,e){return g([t,e]).append_tags(s.LINE)}function _(t){!function(t,e){if(!t)throw new Error(e)}(t.length>=3,"Polygon must have at least 3 points");let e=new d(t);return new h(a.Polygon,{path:e})}function f(t=e(0,0)){return g([t]).append_tags(s.EMPTY)}function m(e){return new h(a.Text,{textdata:{text:e,"font-size":c},path:new d([new t(0,0)])})}function b(t,n,r){let i={src:t},s=new d([e(-n/2,-r/2),e(n/2,-r/2),e(n/2,r/2),e(-n/2,r/2)]);return new h(a.Image,{imgdata:i,path:s})}function v(e){var n;let r=[];for(let t=0;t<e.length;t++){let i=e[t][0],s=null!==(n=e[t][1])&&void 0!==n?n:{};r.push({text:i,style:s})}return new h(a.MultilineText,{multilinedata:{content:r,"scale-factor":1},path:new d([new t(0,0)])})}function y(e,n,r=!1){let i=o.from_BBCode(e,n);return r&&(i=o.split_tspans_by_words(i)),new h(a.MultilineText,{multilinedata:{content:i,"scale-factor":1},path:new d([new t(0,0)])})}const x={blue:"#1f77b4",lightblue:"#aec7e8",orange:"#ff7f0e",lightorange:"#ffbb78",green:"#2ca02c",lightgreen:"#98df8a",red:"#d62728",lightred:"#ff9896",purple:"#9467bd",lightpurple:"#c5b0d5",brown:"#8c564b",lightbrown:"#c49c94",pink:"#e377c2",lightpink:"#f7b6d2",grey:"#7f7f7f",lightgrey:"#c7c7c7",gray:"#7f7f7f",lightgray:"#c7c7c7",olive:"#bcbd22",lightolive:"#dbdb8d",cyan:"#17becf",lightcyan:"#9edae5"};function w(t,e){var n;return null!==(n=e[t])&&void 0!==n?n:t}function k(t){return t*Math.PI/180}function A(t){return 180*t/Math.PI}function E(t,e){let n=[];for(let r=0;r<e;r++)n.push(t[r%t.length]);return n}function O(t,e,n=100){let r=[],i=(e-t)/(n-1);for(let e=0;e<n;e++)r.push(t+i*e);return r}function S(t,e,n=100){let r=[],i=(e-t)/n;for(let e=0;e<n;e++)r.push(t+i*e);return r}function L(t,e,n=1){if(0==n)return[];if(Math.floor((e-t)/n)<=0)return[];let r=[];if(n>0)for(let i=t;i<e;i+=n)r.push(i);else for(let i=t;i>e;i+=n)r.push(i);return r}function C(t,e,n=1){if(0==n)return[];if(Math.floor((e-t)/n)<=0)return[];let r=[];if(n>0)for(let i=t;i<=e;i+=n)r.push(i);else for(let i=t;i>=e;i+=n)r.push(i);return r}function M(t){let e=[],n=Math.max(...t.map((t=>t.length)));for(let r=0;r<n;r++){e.push([]);for(let n=0;n<t.length;n++)e[r].push(t[n][r])}return e}function T(t){let e=t;return"number"==typeof e?[e,e,e,e]:Array.isArray(e)?1===e.length?[e[0],e[0],e[0],e[0]]:2===e.length?[e[0],e[1],e[0],e[1]]:3===e.length?[e[0],e[1],e[2],e[1]]:e.length>=4?[e[0],e[1],e[2],e[3]]:[0,0,0,0]:[0,0,0,0]}var N=Object.freeze({__proto__:null,array_repeat:E,expand_directional_value:T,linspace:O,linspace_exc:S,range:L,range_inc:C,to_degree:A,to_radian:k,transpose:M});const H={A:"𝐴",B:"𝐵",C:"𝐶",D:"𝐷",E:"𝐸",F:"𝐹",G:"𝐺",H:"𝐻",I:"𝐼",J:"𝐽",K:"𝐾",L:"𝐿",M:"𝑀",N:"𝑁",O:"𝑂",P:"𝑃",Q:"𝑄",R:"𝑅",S:"𝑆",T:"𝑇",U:"𝑈",V:"𝑉",W:"𝑊",X:"𝑋",Y:"𝑌",Z:"𝑍",a:"𝑎",b:"𝑏",c:"𝑐",d:"𝑑",e:"𝑒",f:"𝑓",g:"𝑔",h:"ℎ",i:"𝑖",j:"𝑗",k:"𝑘",l:"𝑙",m:"𝑚",n:"𝑛",o:"𝑜",p:"𝑝",q:"𝑞",r:"𝑟",s:"𝑠",t:"𝑡",u:"𝑢",v:"𝑣",w:"𝑤",x:"𝑥",y:"𝑦",z:"𝑧","Α":"𝛢","Β":"𝛣","Γ":"𝛤","Δ":"𝛥","Ε":"𝛦","Ζ":"𝛧","Η":"𝛨","Θ":"𝛩","Ι":"𝛪","Κ":"𝛫","Λ":"𝛬","Μ":"𝛭","Ν":"𝛮","Ξ":"𝛯","Ο":"𝛰","Π":"𝛱","Ρ":"𝛲","Σ":"𝛴","Τ":"𝛵","Υ":"𝛶","Φ":"𝛷","Χ":"𝛸","Ψ":"𝛹","Ω":"𝛺","α":"𝛼","β":"𝛽","γ":"𝛾","δ":"𝛿","ε":"𝜀","ζ":"𝜁","η":"𝜂","θ":"𝜃","ι":"𝜄","κ":"𝜅","λ":"𝜆","μ":"𝜇","ν":"𝜈","ξ":"𝜉","ο":"𝜊","π":"𝜋","ρ":"𝜌","ς":"𝜍","σ":"𝜎","τ":"𝜏","υ":"𝜐","φ":"𝜑","χ":"𝜒","ψ":"𝜓","ω":"𝜔","ϑ":"𝜗","ϰ":"𝜘","ϕ":"𝜙","ϱ":"𝜚","ϖ":"𝜛"};Object.fromEntries(Object.entries(H).map((([t,e])=>[e,t])));const D={"\\alpha":"α","\\beta":"β","\\gamma":"γ","\\delta":"δ","\\epsilon":"ε","\\zeta":"ζ","\\eta":"η","\\theta":"θ","\\iota":"ι","\\kappa":"κ","\\lambda":"λ","\\mu":"μ","\\nu":"ν","\\xi":"ξ","\\omicron":"ο","\\pi":"π","\\rho":"ρ","\\sigma":"σ","\\tau":"τ","\\upsilon":"υ","\\phi":"ϕ","\\chi":"χ","\\psi":"ψ","\\omega":"ω","\\vartheta":"ϑ","\\varchi":"ϰ","\\varphi":"φ","\\varepsilon":"ε","\\varrho":"ϱ","\\varsigma":"ς"},I={textfractionsolidus:"⁄",leftrightsquigarrow:"↭",textpertenthousand:"‱",blacktriangleright:"▸",blacktriangledown:"▾",blacktriangleleft:"◂",twoheadrightarrow:"↠",leftrightharpoons:"⇋",rightleftharpoons:"⇌",textreferencemark:"※",circlearrowright:"↻",rightrightarrows:"⇉",vartriangleright:"⊳",textordmasculine:"º",textvisiblespace:"␣",twoheadleftarrow:"↞",downharpoonright:"⇂",ntrianglerighteq:"⋭",rightharpoondown:"⇁",textperthousand:"‰",leftrightarrows:"⇆",textmusicalnote:"♪",nleftrightarrow:"↮",rightleftarrows:"⇄",bigtriangledown:"▽",textordfeminine:"ª",ntrianglelefteq:"⋬",rightthreetimes:"⋌",trianglerighteq:"⊵",vartriangleleft:"⊲",rightsquigarrow:"⇝",downharpoonleft:"⇃",curvearrowright:"↷",circlearrowleft:"↺",leftharpoondown:"↽",nLeftrightarrow:"⇎",curvearrowleft:"↶",guilsinglright:"›",leftthreetimes:"⋋",leftrightarrow:"↔",rightharpoonup:"⇀",guillemotright:"»",downdownarrows:"⇊",hookrightarrow:"↪",dashrightarrow:"⇢",leftleftarrows:"⇇",trianglelefteq:"⊴",ntriangleright:"⋫",doublebarwedge:"⌆",upharpoonright:"↾",rightarrowtail:"↣",looparrowright:"↬",Leftrightarrow:"⇔",sphericalangle:"∢",divideontimes:"⋇",measuredangle:"∡",blacktriangle:"▴",ntriangleleft:"⋪",mathchar1356:"⁁",texttrademark:"™",mathchar2208:"⌖",triangleright:"▹",leftarrowtail:"↢",guilsinglleft:"‹",upharpoonleft:"↿","mathbb{gamma}":"ℽ",fallingdotseq:"≒",looparrowleft:"↫",textbrokenbar:"¦",hookleftarrow:"↩",smallsetminus:"﹨",dashleftarrow:"⇠",guillemotleft:"«",leftharpoonup:"↼","mathbb{Gamma}":"ℾ",bigtriangleup:"△",textcircledP:"℗",risingdotseq:"≓",triangleleft:"◃",mathsterling:"£",textcurrency:"¤",triangledown:"▿",blacklozenge:"","sfrac{5}{6}":"⅚",preccurlyeq:"≼",Rrightarrow:"⇛",circledcirc:"⊚",nRightarrow:"⇏","sfrac{3}{8}":"⅜","sfrac{1}{3}":"⅓","sfrac{2}{5}":"⅖",vartriangle:"▵",Updownarrow:"⇕",nrightarrow:"↛","sfrac{1}{2}":"½","sfrac{3}{5}":"⅗",succcurlyeq:"≽","sfrac{4}{5}":"⅘",diamondsuit:"♦","sfrac{1}{6}":"⅙",curlyeqsucc:"⋟",blacksquare:"▪",curlyeqprec:"⋞","sfrac{1}{8}":"⅛","sfrac{7}{8}":"⅞","sfrac{1}{5}":"⅕","sfrac{2}{3}":"⅔",updownarrow:"↕",backepsilon:"∍",circleddash:"⊝",eqslantless:"⋜","sfrac{3}{4}":"¾","sfrac{5}{8}":"⅝","sfrac{1}{4}":"¼","mathbb{Pi}":"ℿ","mathcal{M}":"ℳ","mathcal{o}\t":"ℴ","mathcal{O}\t":"𝒪",nsupseteqq:"⊉","mathcal{B}":"ℬ",textrecipe:"℞",nsubseteqq:"⊈",subsetneqq:"⊊","mathcal{I}":"ℑ",upuparrows:"⇈","mathcal{e}":"ℯ","mathcal{L}":"ℒ",nleftarrow:"↚","mathcal{H}":"ℋ","mathcal{E}":"ℰ",eqslantgtr:"⋝",curlywedge:"⋏",varepsilon:"ε",supsetneqq:"⊋",rightarrow:"→","mathcal{R}":"ℛ",sqsubseteq:"⊑","mathcal{g}":"ℊ",sqsupseteq:"⊒",complement:"∁",Rightarrow:"⇒",gtreqqless:"⋛",lesseqqgtr:"⋚",circledast:"⊛",nLeftarrow:"⇍",Lleftarrow:"⇚",varnothing:"∅","mathcal{N}":"𝒩",Leftarrow:"⇐",gvertneqq:"≩","mathbb{C}":"ℂ",supsetneq:"⊋",leftarrow:"←",nleqslant:"≰","mathbb{Q}":"ℚ","mathbb{Z}":"ℤ",llbracket:"〚","mathbb{H}":"ℍ",spadesuit:"♠","mathit{o}":"ℴ","mathbb{P}":"ℙ",rrbracket:"〛",supseteqq:"⊇",copyright:"©","textsc{k}":"ĸ",gtreqless:"⋛","mathbb{j}":"ⅉ",pitchfork:"⋔",estimated:"℮",ngeqslant:"≱","mathbb{e}":"ⅇ",therefore:"∴",triangleq:"≜",varpropto:"∝",subsetneq:"⊊",heartsuit:"♥","mathbb{d}":"ⅆ",lvertneqq:"≨",checkmark:"✓",nparallel:"∦","mathbb{R}":"ℝ",lesseqgtr:"⋚",downarrow:"↓","mathbb{D}":"ⅅ","mathbb{i}":"ⅈ",backsimeq:"⋍","mathbb{N}":"ℕ",Downarrow:"⇓",subseteqq:"⊆",setminus:"∖",succnsim:"⋩",doteqdot:"≑",clubsuit:"♣",emptyset:"∅",sqsupset:"⊐","fbox{~~}":"▭",curlyvee:"⋎",varkappa:"ϰ",llcorner:"⌞",varsigma:"ς",approxeq:"≊",backcong:"≌",supseteq:"⊇",circledS:"Ⓢ",circledR:"®",textcent:"¢",urcorner:"⌝",lrcorner:"⌟",boxminus:"⊟",texteuro:"€",vartheta:"ϑ",barwedge:"⊼","ding{86}":"✶",sqsubset:"⊏",subseteq:"⊆",intercal:"⊺","ding{73}":"☆",ulcorner:"⌜",recorder:"⌕",precnsim:"⋨",parallel:"∥",boxtimes:"⊠","ding{55}":"✗",multimap:"⊸",maltese:"✠",nearrow:"↗",swarrow:"↙",lozenge:"◊","sqrt[3]":"∛",succsim:"≿",dotplus:"∔","tilde{}":"~","check{}":"ˇ",lessgtr:"≶",Upsilon:"ϒ",Cdprime:"Ъ",gtrless:"≷",backsim:"∽",nexists:"∄",searrow:"↘",lessdot:"⋖",boxplus:"⊞",upsilon:"υ",epsilon:"ε",diamond:"⋄",bigstar:"★",ddagger:"‡",cdprime:"ъ",Uparrow:"⇑","sqrt[4]":"∜",between:"≬",sqangle:"∟",digamma:"Ϝ",uparrow:"↑",nwarrow:"↖",precsim:"≾","breve{}":"˘",because:"∵",bigcirc:"◯","acute{}":"´","grave{}":"`",lesssim:"≲",partial:"∂",natural:"♮",supset:"⊃",hstrok:"ħ",Tstrok:"Ŧ",coprod:"∐",models:"⊧",otimes:"⊗",degree:"°",gtrdot:"⋗",preceq:"≼",Lambda:"Λ",lambda:"λ",cprime:"ь",varrho:"ϱ",Bumpeq:"≎",hybull:"⁃",lmidot:"ŀ",nvdash:"⊬",lbrace:"{",bullet:"•",varphi:"φ",bumpeq:"≏","ddot{}":"¨",Lmidot:"Ŀ",Cprime:"Ь",female:"♀",rtimes:"⋊",gtrsim:"≳",mapsto:"↦",daleth:"ℸ",square:"■",nVDash:"⊯",rangle:"⟩",tstrok:"ŧ",oslash:"⊘",ltimes:"⋉",lfloor:"⌊",marker:"▮",Subset:"⋐",Vvdash:"⊪",propto:"∝",Hstrok:"Ħ",dlcrop:"⌍",forall:"∀",nVdash:"⊮",Supset:"⋑",langle:"⟨",ominus:"⊖",rfloor:"⌋",circeq:"≗",eqcirc:"≖",drcrop:"⌌",veebar:"⊻",ulcrop:"⌏",nvDash:"⊭",urcrop:"⌎",exists:"∃",approx:"≈",dagger:"†",boxdot:"⊡",succeq:"≽",bowtie:"⋈",subset:"⊂",notin:"∉",Sigma:"Σ",Omega:"Ω",nabla:"∇",colon:":",boxHu:"╧",boxHd:"╤",aleph:"ℵ",gnsim:"⋧",boxHU:"╩",boxHD:"╦",equiv:"≡",lneqq:"≨",alpha:"α",amalg:"∐",boxhU:"╨",boxhD:"╥",uplus:"⊎",boxhu:"┴",kappa:"κ",sigma:"σ",boxDL:"╗",Theta:"Θ",Vdash:"⊩",boxDR:"╔",boxDl:"╖",sqcap:"⊓",boxDr:"╓","bar{}":"¯",dashv:"⊣",vDash:"⊨",boxdl:"┐",boxVl:"╢",boxVh:"╫",boxVr:"╟",boxdr:"┌",boxdL:"╕",boxVL:"╣",boxVH:"╬",boxVR:"╠",boxdR:"╒",theta:"θ",lhblk:"▄",uhblk:"▀",ldotp:".",ldots:"…",boxvL:"╡",boxvH:"╪",boxvR:"╞",boxvl:"┤",boxvh:"┼",boxvr:"├",Delta:"Δ",boxUR:"╚",boxUL:"╝",oplus:"⊕",boxUr:"╙",boxUl:"╜",doteq:"≐",happy:"㋡",varpi:"ϖ",smile:"☺",boxul:"┘",simeq:"≃",boxuR:"╘",boxuL:"╛",boxhd:"┬",gimel:"ℷ",Gamma:"Γ",lnsim:"⋦",sqcup:"⊔",omega:"ω",sharp:"♯",times:"×",block:"█","hat{}":"^",wedge:"∧",vdash:"⊢",angle:"∠",infty:"∞",gamma:"γ",asymp:"≍",rceil:"⌉","dot{}":"˙",lceil:"⌈",delta:"δ",gneqq:"≩",frown:"⌢",phone:"☎",vdots:"⋮",boxr:"└","k{i}":"į","`{I}":"Ì",perp:"⊥",'"{o}':"ö","={I}":"Ī","`{a}":"à","v{T}":"Ť",surd:"√","H{O}":"Ő",vert:"|","k{I}":"Į",'"{y}':"ÿ",'"{O}':"Ö","u{u}":"ў","u{G}":"Ğ",".{E}":"Ė",".{z}":"ż","v{t}":"ť",prec:"≺","H{o}":"ő",mldr:"…",cong:"≅",".{e}":"ė",star:"*",".{Z}":"Ż",geqq:"≧",cdot:"⋅",cdots:"…","`{U}":"Ù","v{L}":"Ľ","c{s}":"ş","~{A}":"Ã",Vert:"‖","k{e}":"ę",lnot:"¬",leqq:"≦",beta:"β",beth:"ℶ","~{n}":"ñ","u{i}":"й","c{S}":"Ş","c{N}":"Ņ","H{u}":"ű","v{n}":"ň","={U}":"Ū","~{O}":"Õ","v{E}":"Ě","H{U}":"Ű","v{N}":"Ň",prod:"∏","v{s}":"š",'"{U}':"Ü","c{n}":"ņ","k{U}":"Ų","c{R}":"Ŗ","~{o}":"õ","v{e}":"ě","v{S}":"Š","u{A}":"Ă",circ:"∘",'"{u}':"ü",flat:"♭","v{z}":"ž","r{U}":"Ů","`{O}":"Ò","={u}":"ū",oint:"∮","c{K}":"Ķ","k{u}":"ų","not<":"≮","not>":"≯","`{o}":"ò",'"{I}':"Ï","v{D}":"Ď",".{G}":"Ġ","r{u}":"ů","not=":"≠","`{u}":"ù","v{c}":"č","c{k}":"ķ",".{g}":"ġ",odot:"⊙","`{e}":"э","c{T}":"Ţ","v{d}":"ď",'"{e}':"ё","v{R}":"Ř","k{a}":"ą",nldr:"‥","`{A}":"À","~{N}":"Ñ",nmid:"∤",".{C}":"Ċ",zeta:"ζ","~{u}":"ũ","`{E}":"Э","~{a}":"ã","c{t}":"ţ","={o}":"ō","v{r}":"ř","={A}":"Ā",".{c}":"ċ","~{U}":"Ũ","k{A}":"Ą",'"{a}':"ä","u{U}":"Ў",iota:"ι","={O}":"Ō","c{C}":"Ç",gneq:"≩",boxH:"═",hbar:"ℏ",'"{A}':"Ä",boxv:"│",boxh:"─",male:"♂",sqrt:"√",succ:"≻","c{c}":"ç","v{l}":"ľ","u{a}":"ă","v{Z}":"Ž","c{G}":"Ģ","v{C}":"Č",lneq:"≨","{E}":"Ё","={a}":"ā","c{l}":"ļ","={E}":"Ē",boxV:"║","u{g}":"ğ","u{I}":"Й","c{L}":"Ļ","k{E}":"Ę",".{I}":"İ","~{I}":"Ĩ","c{r}":"ŗ","{Y}":"Ÿ","={e}":"ē",leq:"≤",Cup:"⋓",Psi:"Ψ",neq:"≠","k{}":"˛","={}":"‾","H{}":"˝",cup:"∪",geq:"≥",mho:"℧",Dzh:"Џ",cap:"∩",bot:"⊥",psi:"ψ",chi:"χ","c{}":"¸",Phi:"Φ",ast:"*",ell:"ℓ",top:"⊤",lll:"⋘",tau:"τ",Cap:"⋒",sad:"☹",iff:"⇔",eta:"η",eth:"ð","d{":"\ṭ",rho:"ρ",dzh:"џ",div:"÷",phi:"ϕ",Rsh:"↱",vee:"∨","b{}":"ˍ","t{":"\t͡",int:"∫",sim:"∼","r{}":"˚",Lsh:"↰",yen:"¥",ggg:"⋙",mid:"∣",sum:"∑",neg:"¬",Dz:"Ѕ",Re:"ℜ",oe:"œ",DH:"Ð",ll:"≪",ng:"ŋ",wr:"≀",wp:"℘","=I":"І",":)":"☺",":(":"☹",AE:"Æ",AA:"Å",ss:"ß",dz:"ѕ",ae:"æ",aa:"å",th:"þ",to:"→",Pi:"Π",mp:"∓",Im:"ℑ",pm:"±",pi:"π",'"I':"Ї",in:"∈",ni:"∋",ne:"≠",TH:"Þ",Xi:"Ξ",nu:"ν",NG:"Ŋ",":G":"㋡",xi:"ξ",OE:"Œ",gg:"≫",DJ:"Đ","=e":"є","=E":"Є",mu:"μ",dj:"đ",S:"§",P:"¶",O:"Ø",L:"Ł",o:"ø",l:"ł",h:"ℎ",i:"ℹ","'{Y}":"Ý","'{y}":"ý","'{L}":"Ĺ","'{e}":"é","'{l}":"ĺ","'{s}":"ś","'{z}":"ź","'{E}":"É","'{S}":"Ś","'{Z}":"Ź","'{R}":"Ŕ","'{A}":"Á","'{N}":"Ń","'{I}":"Í","'{n}":"ń","'{c}":"ć","'{u}":"ú","'{C}":"Ć","'{o}":"ó","'{a}":"á","'{O}":"Ó","'{g}":"ǵ","'{r}":"ŕ","'{U}":"Ú","'G":"Ѓ","'C":"Ћ","'K":"Ќ","'k":"ќ","'c":"ћ","'g":"ѓ"};function R(t){for(let e in D)t=t.replaceAll(e,D[e]);for(let e in I)t=t.replaceAll("\\"+e,I[e]);return t}function j(t){return[...R(t)].map((t=>H[t]||t)).join("")}const z={fill:"none",stroke:"black","stroke-width":"1","stroke-linecap":"butt","stroke-dasharray":"none","stroke-linejoin":"round","vector-effect":"non-scaling-stroke",opacity:"1"},q=Object.assign({},z),B={fill:"black",stroke:"none","stroke-width":"1","stroke-linecap":"butt","stroke-dasharray":"none","stroke-linejoin":"round","vector-effect":"non-scaling-stroke",opacity:"1"},P=Object.assign({},B),F={text:"","font-family":"Latin Modern Math, sans-serif","font-size":c,"font-weight":"normal","text-anchor":"middle",dy:"0.25em",angle:"0","font-style":"normal","font-scale":"auto"},G=Object.assign({},F);function V(){for(let t in z)z[t]=q[t];for(let t in B)B[t]=P[t];for(let t in F)F[t]=G[t]}const $=new Map;function U(t,e,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","image");if(i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),null==e.imgdata.src)return;if(null==e.path)return;if(4!=e.path.points.length)return;let s=e.path.points[1].sub(e.path.points[0]).length(),a=e.path.points[2].sub(e.path.points[1]).length(),l=e.path.points[1].sub(e.path.points[0]).normalize(),o=e.path.points[3].sub(e.path.points[0]).normalize(),c=l.x,h=-l.y,d=-o.x,u=o.y,g=e.path.points[3].x,p=-e.path.points[3].y;n?function(t,e){if(/^data:image\/(png|jpeg|jpg|gif|svg\+xml);base64,/.test(e))return t.setAttribute("href",e),void t.setAttribute("xlink:href",e);if($.has(e)){const n=$.get(e);if(!n)return;return t.setAttribute("href",n),void t.setAttribute("xlink:href",n)}let n=document.createElement("canvas"),r=n.getContext("2d"),i=new Image;i.crossOrigin="anonymous",i.onload=()=>{n.height=i.height,n.width=i.width,null==r||r.drawImage(i,0,0);const s=n.toDataURL("image/png");t.setAttribute("href",s),t.setAttribute("xlink:href",s),$.set(e,s),n.remove()},i.src=e}(i,e.imgdata.src):i.setAttribute("href",e.imgdata.src),i.setAttribute("width",s.toString()),i.setAttribute("height",a.toString()),i.setAttribute("transform",`matrix(${c} ${h} ${d} ${u} ${g} ${p})`),i.setAttribute("preserveAspectRatio","none"),null!=r&&i.setAttribute("_dg_tag",r),t.appendChild(i)}function X(t,e){if(t.type==e)return[t];if(t.type==a.Diagram){let n=[];for(let r of t.children)n=n.concat(X(r,e));return n}return[]}function W(t,e){const n=T(null!=e?e:0);let r=t.getBBox(),i=t.width.baseVal.value-n[1]-n[3],s=t.height.baseVal.value-n[0]-n[2];return Math.max(r.width/i,r.height/s)}function J(t,e){var n;let r=[];for(let i in e.children){let s=e.children[i];s instanceof SVGElement&&(s.getAttribute("_dg_tag")==t&&r.push(s),(null===(n=s.children)||void 0===n?void 0:n.length)&&(r=r.concat(J(t,s))))}return r}function Y(t,e,n,r=!0,i=!1,l,o){if(n.type==a.Polygon)!function(t,e,n,r){let i=Object.assign(Object.assign({},z),n.style);i.fill=w(i.fill,x),i.stroke=w(i.stroke,x);let s=t.querySelector("defs");if(s||(s=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.appendChild(s)),"object"==typeof(a=i.fill)&&"linearGradient"===a.type){const t=`gradient-${Math.random().toString(36).substr(2,9)}`,e=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");let{x1:n,x2:r,y1:a,y2:l}=i.fill;e.setAttribute("id",t),e.setAttribute("x1",n||"0%"),e.setAttribute("y1",a||"0%"),e.setAttribute("x2",r||"100%"),e.setAttribute("y2",l||"0%"),i.fill.stops.forEach((t=>{const n=document.createElementNS("http://www.w3.org/2000/svg","stop");n.setAttribute("offset",t.offset),n.setAttribute("stop-color",w(t.color,x)),void 0!==t.opacity&&n.setAttribute("stop-opacity",t.opacity.toString()),e.appendChild(n)})),s.appendChild(e),i.fill=`url(#${t})`}else i.fill=w(i.fill,x);var a;let l=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t in i)l.style[t]=i[t];if(null!=r&&l.setAttribute("_dg_tag",r),e.appendChild(l),null!=n.path)for(let e=0;e<n.path.points.length;e++){let r=n.path.points[e];var o=t.createSVGPoint();o.x=r.x,o.y=-r.y,l.points.appendItem(o)}}(t,e,n,o);else if(n.type==a.Curve)!function(t,e,n,r){let i=Object.assign(Object.assign({},z),n.style);i.fill="none",i.stroke=w(i.stroke,x);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");for(let t in i)s.style[t]=i[t];if(null!=r&&s.setAttribute("_dg_tag",r),e.appendChild(s),null!=n.path)for(let e=0;e<n.path.points.length;e++){let r=n.path.points[e];var a=t.createSVGPoint();a.x=r.x,a.y=-r.y,s.points.appendItem(a)}}(t,e,n,o);else if(n.type==a.Text||n.type==a.MultilineText);else if(n.type==a.Image)U(e,n,i,o);else if(n.type==a.Diagram)for(let r of n.children)Y(t,e,r,!1,i,void 0,o);else console.warn("Unreachable, unknown diagram type : "+n.type);if(r){null==l&&(l=W(t));let r=X(n,a.Text),i=X(n,a.MultilineText);!function(t,e,n,r){for(let i of e){let e=Object.assign(Object.assign({},B),i.style);e.fill=w(e.fill,x),e.stroke=w(e.stroke,x);let a=Object.assign(Object.assign({},F),i.textdata);if(null==i.path)throw new Error("Text must have a path");let l=document.createElementNS("http://www.w3.org/2000/svg","text"),o=i.path.points[0].x,c=-i.path.points[0].y,h=A(parseFloat(a.angle)),d="auto"==a["font-scale"]?n:parseFloat(a["font-scale"]),u=parseFloat(a["font-size"])*d;l.setAttribute("font-family",a["font-family"]),l.setAttribute("font-style",a["font-style"]),l.setAttribute("font-size",u.toString()),l.setAttribute("font-weight",a["font-weight"]),l.setAttribute("text-anchor",a["text-anchor"]),l.setAttribute("dy",a.dy),l.setAttribute("transform",`translate(${o} ${c}) rotate(${h}) `),null!=r&&l.setAttribute("_dg_tag",r),l.setAttribute("_x",o.toString()),l.setAttribute("_y",c.toString()),l.setAttribute("_angle",h.toString());for(let t in e)l.style[t]=e[t];let g=a.text;i.tags.includes(s.TEXTVAR)&&!Q(g)&&(g=j(g)),l.innerHTML=g,t.appendChild(l)}}(e,r,null!=l?l:1,o),function(t,e,n,r){var i,s,a,l,o;for(let c of e){if(null==c.path)throw new Error("Text must have a path");let e=document.createElementNS("http://www.w3.org/2000/svg","text"),h=c.path.points[0].x,d=-c.path.points[0].y,u=0,g=Object.assign(Object.assign(Object.assign({},F),{dy:"0","text-anchor":"start"}),c.textdata),p=g["font-size"];if(null==(null===(i=c.multilinedata)||void 0===i?void 0:i.content))throw new Error("MultilineText must have multilinedata");let _=null!==(s=c.multilinedata["scale-factor"])&&void 0!==s?s:1,f=!0,m=!0,b="1em";for(let t of c.multilinedata.content){if("\n"==t.text){m=!0,b=null!==(a=t.style.dy)&&void 0!==a?a:"1em";continue}let r=document.createElementNS("http://www.w3.org/2000/svg","tspan"),i=null==t.style.dy,s=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},B),g),{dy:"0",dx:"0"}),{"font-size":p}),t.style);if(m){r.setAttribute("x","0");let t=null!==(l=g.dy)&&void 0!==l?l:"0";i&&(s.dy=f?t:b),m=!1}let c="auto"==s["font-scale"]?n:parseFloat(s["font-scale"]),h=null!==(o=s["font-size-scale-factor"])&&void 0!==o?o:1,d=parseFloat(s["font-size"])*c*_*h;s.tag&&r.setAttribute("_dg_tag",s.tag),r.style.whiteSpace="pre",r.setAttribute("dx",s.dx),r.setAttribute("dy",s.dy),r.setAttribute("font-style",s["font-style"]),r.setAttribute("font-family",s["font-family"]),r.setAttribute("font-size",d.toString()),r.setAttribute("font-weight",s["font-weight"]),r.style.fill=w(s.fill,x),r.style.stroke=w(s.stroke,x),r.style.opacity=s.opacity,s["baseline-shift"]&&r.setAttribute("baseline-shift",s["baseline-shift"]);let u=t.text;s.textvar&&(u=j(u)),r.innerHTML=u,e.appendChild(r),f=!1}e.setAttribute("dy",g.dy),e.setAttribute("text-anchor",g["text-anchor"]),e.setAttribute("transform",`translate(${h} ${d}) rotate(${u}) `),null!=r&&e.setAttribute("_dg_tag",r),t.appendChild(e)}}(e,i,null!=l?l:1,o)}}function K(t,e,n=!0,r=!0,i=!0){Z(t,e,{set_html_attribute:n,render_text:r,clear_svg:i})}function Z(t,e,n={}){var r,i,s,a,l,o,c;const h=null===(r=n.set_html_attribute)||void 0===r||r,d=null===(i=n.render_text)||void 0===i||i,u=null===(s=n.clear_svg)||void 0===s||s,g=null!==(a=n.embed_image)&&void 0!==a&&a;let p,_;for(let e in t.children){let n=t.children[e];if(n instanceof SVGSVGElement&&"diagram_svg"==n.getAttribute("meta")){p=n;break}}if(null==p&&(p=document.createElementNS("http://www.w3.org/2000/svg","svg"),p.setAttribute("meta","diagram_svg"),p.setAttribute("width","100%"),p.setAttribute("height","100%"),t.appendChild(p)),function(t,e){if(null==e||0==e.length)return;let n=t.querySelector("defs");null==n&&(n=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(n,t.firstChild));n.innerHTML="";for(let t of e)n.innerHTML+=t}(t,n.filter_strings),n.text_scaling_reference_svg&&(n.text_scaling_reference_padding=null!==(o=null!==(l=n.text_scaling_reference_padding)&&void 0!==l?l:n.padding)&&void 0!==o?o:10,n.text_scaling_reference_padding=T(n.text_scaling_reference_padding),_=W(n.text_scaling_reference_svg,n.text_scaling_reference_padding)),u&&(p.innerHTML=""),Y(p,p,e,d,g,_),h){const e=T(null!==(c=n.padding)&&void 0!==c?c:10);let r=p.getBBox(),i=p.width.baseVal.value-e[1]-e[3],s=p.height.baseVal.value-e[0]-e[2],a=Math.max(r.width/i,r.height/s),l=e.map((t=>t*a));r.x-=l[3],r.y-=l[0],r.width+=l[1]+l[3],r.height+=l[0]+l[2],p.setAttribute("viewBox",`${r.x} ${r.y} ${r.width} ${r.height}`),p.setAttribute("preserveAspectRatio","xMidYMid meet"),t.style.overflow="visible"}if(n.background_color){let t=p.getBBox();0!==p.viewBox.baseVal.width&&(t=p.viewBox.baseVal);let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",t.x.toString()),e.setAttribute("y",t.y.toString()),e.setAttribute("width",t.width.toString()),e.setAttribute("height",t.height.toString()),e.style.fill=w(n.background_color,x),e.style.stroke="none",p.insertBefore(e,p.firstChild)}}function Q(t){return t.startsWith("$")&&t.endsWith("$")}function tt(t){return t.startsWith("$$")&&t.endsWith("$$")}function et(t,e){for(let r=0;r<t.children.length;r++){let i=t.children[r];if(i instanceof SVGTextElement){let s=i.innerHTML;if(!Q(s))continue;let a=i.getAttribute("font-size");if(null==a)continue;let l=parseFloat(a),o=e(tt(n=s)?n.substring(2,n.length-2):Q(n)?n.substring(1,n.length-1):n,{display:tt(s)}),c=i.getAttribute("_x"),h=i.getAttribute("_y");if(null==c||null==h)continue;let d=i.getAttribute("text-anchor"),u=i.getAttribute("dy");if(null==d||null==u)continue;i.outerHTML=o,i=t.children[r];let g=i.getAttribute("width");if(null==g)continue;let p=parseFloat(g.substring(0,g.length-2)),_=i.getAttribute("height");if(null==_)continue;const f=2;let m=p*l/f,b=parseFloat(_.substring(0,_.length-2))*l/f,v=parseFloat(c),y=parseFloat(h);switch(d){case"start":break;case"middle":v-=m/2;break;case"end":v-=m}switch(u){case"0.75em":break;case"0.25em":y-=b/2;break;case"-0.25em":y-=b}i.setAttribute("width",m.toString()),i.setAttribute("height",b.toString()),i.setAttribute("x",v.toString()),i.setAttribute("y",y.toString())}else i instanceof SVGElement&&et(i,e)}var n}function nt(t){let e=t.querySelector("svg[meta=diagram_svg]");if(null==e)return void console.warn("Cannot find svg element");let n=t.querySelector("svg[meta=control_svg]"),r=e;if(null!=n){let t=e.cloneNode(!0);for(let e in n.children){let r=n.children[e];r instanceof SVGSVGElement&&t.appendChild(r.cloneNode(!0))}r=t}let i=(new XMLSerializer).serializeToString(r),s=new Blob([i],{type:"image/svg+xml"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="diagramatics.svg",l.click()}function rt(t){if(null==t.querySelector("svg[meta=diagram_svg]"))return void console.warn("Cannot find svg element");let e=t,n=(new XMLSerializer).serializeToString(e),r=new Blob([n],{type:"image/svg+xml"});const i=window.URL||window.webkitURL||window,s=i.createObjectURL(r),a=new Image;a.width=e.width.baseVal.value,a.height=e.height.baseVal.value,a.src=s,a.onload=function(){const t=document.createElement("canvas");t.width=a.width,t.height=a.height;const e=t.getContext("2d");null==e||e.drawImage(a,0,0),i.revokeObjectURL(s);const n=t.toDataURL("image/png").replace("image/png","image/octet-stream"),r=document.createElement("a");r.href=n,r.download="diagramatics.png",r.click()}}function it(t,n){return _([e(-t/2,-n/2),e(t/2,-n/2),e(t/2,n/2),e(-t/2,n/2)])}function st(t,n){return _([t,e(n.x,t.y),n,e(t.x,n.y)])}function at(t=1){return it(t,t)}function lt(t,n=1){let r=[];for(let i=0;i<t;i++)r.push(e(0,n).rotate(2*i*Math.PI/t));return _(r)}function ot(t,e=1){return lt(t,e/(2*Math.sin(Math.PI/t)))}function ct(t=1){return lt(50,t).append_tags(s.CIRCLE)}function ht(t=1,n=k(360)){let r=[];for(let i=0;i<100;i++)r.push(e(t,0).rotate(i*n/99));return g(r)}function dt(t,n=1){return u(p(e(0,0),t).append_tags(s.ARROW_LINE),_([e(0,0),e(-n,n/2),e(-n,-n/2)]).rotate(t.angle()).position(t).append_tags(s.ARROW_HEAD))}function ut(t,e,n=1){return dt(e.sub(t),n).position(t)}function gt(t,n,r=1){let i=p(t,n).append_tags(s.ARROW_LINE),a=n.sub(t),l=_([e(0,0),e(-r,r/2),e(-r,-r/2)]);return u(i,l.rotate(a.angle()).position(n).append_tags(s.ARROW_HEAD),l.rotate(a.angle()+Math.PI).position(t).append_tags(s.ARROW_HEAD))}function pt(t){return m(t).append_tags(s.TEXTVAR)}function _t(t){if(!t.tags.includes(s.CIRCLE))return-1;let e=t.get_anchor("center-center");if(null==t.path)return-1;let n=t.path.points[0];return e.sub(n).length()}function ft(t){return t.tags.includes(s.LINE)?null==t.path?[e(0,0),e(0,0)]:[t.path.points[0],t.path.points[1]]:[e(0,0),e(0,0)]}function mt(t){let e=t.bounding_box();return[e[1].x-e[0].x,e[1].y-e[0].y]}var bt=Object.freeze({__proto__:null,area:function t(e){var n,r;return e.type==a.Polygon?function(t){let e=0;const n=t.length;for(let r=0;r<n;r++){const i=(r+1)%n,s=t[r].x,a=t[r].y,l=t[i].x;e+=s*t[i].y-l*a}return Math.abs(e)/2}(null!==(r=null===(n=e.path)||void 0===n?void 0:n.points)&&void 0!==r?r:[]):e.type==a.Diagram?e.children.reduce(((e,n)=>e+t(n)),0):0},circle_radius:_t,circle_tangent_point_from_point:function(t,n){let r=_t(n);if(-1==r)return[e(0,0),e(0,0)];let i=n.get_anchor("center-center"),s=r,a=i.sub(t).length_sq(),l=s*s,o=t.sub(i),c=l/a,h=o.scale(c),d=s*Math.sqrt(a-l)/a,u=e(-o.y,o.x).scale(d);return[h.add(u).add(i),h.sub(u).add(i)]},line_extend:function(t,e,n){if(!t.tags.includes(s.LINE))return t;if(null==t.path)return t;let r=t.path.points[0],i=t.path.points[1],a=i.sub(r).normalize(),l=r.sub(a.scale(e)),o=i.add(a.scale(n)),c=t.copy();return null==c.path?t:(c.path.points=[l,o],c)},line_intersection:function(t,n){if(!t.tags.includes(s.LINE)||!n.tags.includes(s.LINE))return e(1/0,1/0);let[r,i]=ft(t),[a,l]=ft(n),o=r.x,c=r.y,h=i.x,d=i.y,u=a.x,g=a.y,p=l.x,_=l.y,f=(o-h)*(g-_)-(c-d)*(u-p);return 0==f?e(1/0,1/0):e(((o*d-c*h)*(u-p)-(o-h)*(u*_-g*p))/f,((o*d-c*h)*(g-_)-(c-d)*(u*_-g*p))/f)},line_intersection_x:function(t,n){let[r,i]=ft(t);return e(n,r.y+(i.y-r.y)*(n-r.x)/(i.x-r.x))},line_intersection_y:function(t,n){let[r,i]=ft(t);return e(r.x+(i.x-r.x)*(n-r.y)/(i.y-r.y),n)},line_points:ft,size:mt});function vt(t,n="center"){if(0==t.length)return f();let r=[...t];if("top"==n){let t=r[0].get_anchor("top-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("top-left").y));return u(...r)}if("center"==n){let t=r[0].get_anchor("center-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("center-left").y));return u(...r)}if("bottom"==n){let t=r[0].get_anchor("bottom-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("bottom-left").y));return u(...r)}throw new Error("Unknown vertical alignment : "+n)}function yt(t,n="center"){if(0==t.length)return f();let r=[...t];if("left"==n){let t=r[0].get_anchor("top-left").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-left").x,0));return u(...r)}if("center"==n){let t=r[0].get_anchor("top-center").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-center").x,0));return u(...r)}if("right"==n){let t=r[0].get_anchor("top-right").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-right").x,0));return u(...r)}throw new Error("Unknown horizontal alignment : "+n)}function xt(t,n=0){if(0==t.length)return f();let r=[...t],i=[r[0]];for(let t=1;t<r.length;t++){let s=i[t-1],a=r[t],l=s.get_anchor("top-right").x-a.get_anchor("top-left").x+n;i.push(a.translate(e(l,0)))}return u(...i)}function wt(t,n=0){if(0==t.length)return f();let r=[...t],i=[r[0]];for(let t=1;t<r.length;t++){let s=i[t-1],a=r[t],l=s.get_anchor("bottom-left").y-a.get_anchor("top-left").y-n;i.push(a.translate(e(0,l)))}return u(...i)}function kt(t,e=0,n="center"){return xt(vt(t,n).children,e)}function At(t,e=0,n="center"){return wt(yt(t,n).children,e)}function Et(t,e,n=0,r=0){if(0==t.length)return f();let i=[...t],s=Math.ceil(i.length/e),a=[];for(let t=0;t<s;t++)a.push(i.slice(t*e,(t+1)*e));let l=wt(a.map((t=>xt(t,r))),n),o=[];for(let t=0;t<l.children.length;t++)for(let e=0;e<l.children[t].children.length;e++)o.push(l.children[t].children[e]);return u(...o)}function Ot(t,e,n=0,r=0,i="center",s="left"){if(0==t.length)return f();let a=[],l=[],o=0;function c(t){let e=kt(t,r,i);a.push(e),l=[],o=0}for(let n=0;n<t.length;n++){let i=t[n],s=mt(i)[0];s>e?(l.length>0&&c(l),l.push(i),c(l)):(o+r+s>e&&c(l),l.push(i),o+=s+r)}l.length>0&&c(l);let h=At(a,n,s),d=[];for(let t=0;t<h.children.length;t++)for(let e=0;e<h.children[t].children.length;e++)d.push(h.children[t].children[e]);return u(...d)}const St="diagramatics-focusrect";const Lt=(t,e,n)=>{let r="number"==typeof e&&null!=n?function(t,e){return t.toFixed(e).replace(/\.?0+$/,"")}(e,n):e.toString();return`${j(t)} = ${r}`};var Ct,Mt,Tt;!function(t){t.locator="control_svg",t.dnd="dnd_svg",t.custom="custom_int_svg",t.button="button_svg"}(Ct||(Ct={})),function(t){t.DOCUMENT="document",t.SVG="svg"}(Mt||(Mt={}));class Nt{constructor(t,e,n,r=Mt.SVG){this.control_container_div=t,this.diagram_outer_svg=e,this.event_target=r,this.inp_variables={},this.inp_setter={},this.display_mode="svg",this.diagram_svg=void 0,this.locator_svg=void 0,this.dnd_svg=void 0,this.custom_svg=void 0,this.button_svg=void 0,this.locatorHandler=void 0,this.dragAndDropHandler=void 0,this.buttonHandler=void 0,this.focus_padding=1,this.draw_function=t=>{},this.display_precision=5,this.intervals={},this.registeredEventListenerRemoveFunctions=[],this.single_int_mode=!1,null!=n&&(this.inp_variables=n)}draw(){var t,e;this.draw_function(this.inp_variables,this.inp_setter),null===(t=this.locatorHandler)||void 0===t||t.setViewBox(),null===(e=this.dragAndDropHandler)||void 0===e||e.setViewBox(),Ht(this.custom_svg,this.diagram_svg),Ht(this.button_svg,this.diagram_svg)}set(t,e){this.inp_setter[t](e)}get(t){return this.inp_variables[t]}label(t,e,n="white",r="square",i="#8B5CF6",s=Lt){let a=document.createElement("div");a.classList.add("diagramatics-label-container"),a.style.display="flex",a.style.alignItems="center",a.style.gap="8px";let l=document.createElement("div");l.classList.add("diagramatics-label-mark"),l.style.width="12px",l.style.height="12px",l.style.backgroundColor=i,"circle"===r&&(l.style.borderRadius="50%");let o=document.createElement("div");o.classList.add("diagramatics-label"),o.innerHTML=s(t,e,this.display_precision),o.style.color=n,a.appendChild(l),a.appendChild(o),this.inp_variables[t]=e;this.inp_setter[t]=e=>{this.inp_variables[t]=e,o.innerHTML=s(t,e,this.display_precision)};let c=document.createElement("div");c.classList.add("diagramatics-label-container"),c.appendChild(a),this.control_container_div.appendChild(c)}locator_draw(){var t;null===(t=this.locatorHandler)||void 0===t||t.setViewBox()}locator_initial_draw(){var t;null===(t=this.locatorHandler)||void 0===t||t.setViewBox()}drag_and_drop_initial_draw(){this.dnd_initial_draw()}dnd_initial_draw(){var t,e;null===(t=this.dragAndDropHandler)||void 0===t||t.setViewBox(),null===(e=this.dragAndDropHandler)||void 0===e||e.drawSvg()}registerEventListener(t,e,n,r){t.addEventListener(e,n,r);this.registeredEventListenerRemoveFunctions.push((()=>t.removeEventListener(e,n)))}removeRegisteredEventListener(){this.registeredEventListenerRemoveFunctions.forEach((t=>t())),this.registeredEventListenerRemoveFunctions=[]}get_svg_element(t,e=!1){var n;if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let r;for(let e in this.diagram_outer_svg.children){let n=this.diagram_outer_svg.children[e];n instanceof SVGSVGElement&&n.getAttribute("meta")==t&&(r=n)}return this.single_int_mode&&e&&null!=r&&(null===(n=r.remove)||void 0===n||n.call(r),r=void 0),null==r&&(r=document.createElementNS("http://www.w3.org/2000/svg","svg"),r.setAttribute("meta",t),r.setAttribute("width","100%"),r.setAttribute("height","100%"),this.isTargetingDocument()&&(r.style.overflow="visible"),this.diagram_outer_svg.appendChild(r)),r}get_diagram_svg(){let t=this.get_svg_element("diagram_svg");return this.diagram_svg=t,t}isTargetingDocument(){return this.event_target==Mt.DOCUMENT}set_focus_padding(t){this.focus_padding=t,this.dragAndDropHandler&&(this.dragAndDropHandler.focus_padding=t),this.buttonHandler&&(this.buttonHandler.focus_padding=t)}locator(t,e,n,r="blue",i,s=!0,l){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");this.inp_variables[t]=e;let o=this.get_diagram_svg(),c=this.get_svg_element(Ct.locator,!this.locator_svg);if(this.locator_svg=c,null==this.locatorHandler){let t=new zt(c,o);this.locatorHandler=t;const e=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(e,"mousemove",(e=>{t.drag(e)})),this.registerEventListener(e,"mouseup",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchmove",(e=>{t.drag(e)})),this.registerEventListener(e,"touchend",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchcancel",(e=>{t.endDrag(e)}))}this.locatorHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,l&&n&&l(t,e),n&&this.draw()}));let h,d=this.locatorHandler.create_locator_circle_pointer_svg(t,n,e,r,s);if(s){let t=d.getElementsByClassName("diagramatics-locator-blink");for(let e=0;e<t.length;e++)this.locatorHandler.addBlinkingCircleOuter(t[e])}if(this.registerEventListener(d,"mousedown",(e=>{this.locatorHandler.startDrag(e,t,d)})),this.registerEventListener(d,"touchstart",(e=>{this.locatorHandler.startDrag(e,t,d)})),i){if(i.type!=a.Polygon&&i.type!=a.Curve)throw Error("Track diagram must be a polygon or curve");if(null==i.path)throw Error("diagram {diagtam.type} must have a path");let t=i.path.points;h=e=>{let n=Dt(e,t);return d.setAttribute("transform",`translate(${n.x},${-n.y})`),n}}else h=t=>(d.setAttribute("transform",`translate(${t.x},${-t.y})`),t);this.locatorHandler.registerSetter(t,h),this.inp_setter[t]=h;let u=h(e);this.locatorHandler.setPos(t,u)}locator_custom(t,e,n,r,i=!0,s,l){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");this.inp_variables[t]=e;let o=this.get_diagram_svg(),c=this.get_svg_element(Ct.locator,!this.locator_svg);if(this.locator_svg=c,null==this.locatorHandler){let t=new zt(c,o);this.locatorHandler=t;const e=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(e,"mousemove",(e=>{t.drag(e)})),this.registerEventListener(e,"mouseup",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchmove",(e=>{t.drag(e)})),this.registerEventListener(e,"touchend",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchcancel",(e=>{t.endDrag(e)}))}this.locatorHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,s&&n&&s(t,e),n&&this.draw()}));let h,d=this.locatorHandler.create_locator_diagram_svg(t,n,i);if(this.registerEventListener(d,"mousedown",(e=>{this.locatorHandler.startDrag(e,t,d)})),this.registerEventListener(d,"touchstart",(e=>{this.locatorHandler.startDrag(e,t,d)})),l&&this.registerEventListener(d,"contextmenu",(e=>{e.preventDefault(),l(t)})),r){if(r.type!=a.Polygon&&r.type!=a.Curve)throw Error("Track diagram must be a polygon or curve");if(null==r.path)throw Error("diagram {diagtam.type} must have a path");let t=r.path.points;h=e=>{let n=Dt(e,t);return d.setAttribute("transform",`translate(${n.x},${-n.y})`),n}}else h=t=>(d.setAttribute("transform",`translate(${t.x},${-t.y})`),t);this.locatorHandler.registerSetter(t,h),this.inp_setter[t]=h;let u=h(e);this.locatorHandler.setPos(t,u)}slider(t,e=0,n=100,r=50,i=-1,s=1.5,a=Lt){-1==i&&(i=(n-e)/100),this.inp_variables[t]=r;let l=document.createElement("div");l.classList.add("diagramatics-label"),l.innerHTML=a(t,r,this.display_precision);const o=(e,n=!0)=>{this.inp_variables[t]=e,l.innerHTML=a(t,e,this.display_precision),n&&this.draw()};let c=function(t,e=0,n=100,r=50,i){let s=document.createElement("input");return s.type="range",s.min=e.toString(),s.max=n.toString(),s.value=r.toString(),s.step=i.toString(),s.oninput=()=>{let e=s.value;t(parseFloat(e))},s.classList.add("diagramatics-slider"),s}(o,e,n,r,i);this.inp_setter[t]=t=>{c.value=t.toString(),o(t,!1)};const h=1e3*s/((n-e)/i);let d=document.createElement("button"),u=document.createElement("div");u.classList.add("diagramatics-slider-playbutton-symbol"),d.appendChild(u),d.classList.add("diagramatics-slider-playbutton"),d.onclick=()=>{null==this.intervals[t]?(d.classList.add("paused"),this.intervals[t]=setInterval((()=>{let t=parseFloat(c.value);t+=i,t=(t-e)%(n-e)+e,c.value=t.toString(),o(t)}),h)):(d.classList.remove("paused"),clearInterval(this.intervals[t]),this.intervals[t]=void 0)};let g=document.createElement("div");g.classList.add("diagramatics-slider-leftcontainer"),g.appendChild(document.createElement("br")),g.appendChild(d);let p=document.createElement("div");p.classList.add("diagramatics-slider-rightcontainer"),p.appendChild(l),p.appendChild(c);let _=document.createElement("div");_.classList.add("diagramatics-slider-container"),_.appendChild(g),_.appendChild(p),this.control_container_div.appendChild(_)}init_drag_and_drop(){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let t=this.get_diagram_svg(),e=this.get_svg_element(Ct.dnd,!this.dnd_svg);if(this.dnd_svg=e,null==this.dragAndDropHandler){let n=new qt(e,t);n.focus_padding=this.focus_padding,this.dragAndDropHandler=n;const r=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(r,"mousemove",(t=>{n.drag(t)})),this.registerEventListener(r,"mouseup",(t=>{n.endDrag(t)})),this.registerEventListener(r,"touchmove",(t=>{n.drag(t)})),this.registerEventListener(r,"touchend",(t=>{n.endDrag(t)})),this.registerEventListener(r,"touchcancel",(t=>{n.endDrag(t)}))}}dnd_container(t,e,n,r){var i;this.init_drag_and_drop(),null===(i=this.dragAndDropHandler)||void 0===i||i.add_container(t,e,n,r)}dnd_draggable_to_container(t,e,n,r,i){if(this.init_drag_and_drop(),null==this.dragAndDropHandler)throw Error("dragAndDropHandler in Interactive class is undefined");this.inp_variables[t]=e.origin,this.dragAndDropHandler.add_draggable_to_container(t,e,n);this.dragAndDropHandler.registerCallback(t,((e,i=!0)=>{this.inp_variables[t]=e,r&&r(t,n),i&&this.draw()})),i&&this.dragAndDropHandler.register_clickstart_callback(t,i)}dnd_draggable(t,e,n,r,i){if(this.init_drag_and_drop(),null==this.dragAndDropHandler)throw Error("dragAndDropHandler in Interactive class is undefined");this.inp_variables[t]=e.origin,this.dragAndDropHandler.add_draggable_with_container(t,e,n);this.dragAndDropHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,r&&r(t,e),n&&this.draw()})),i&&this.dragAndDropHandler.register_clickstart_callback(t,i)}dnd_register_drop_outside_callback(t){var e;this.init_drag_and_drop(),null===(e=this.dragAndDropHandler)||void 0===e||e.register_dropped_outside_callback(t)}dnd_register_move_validation_function(t){var e;this.init_drag_and_drop(),null===(e=this.dragAndDropHandler)||void 0===e||e.register_move_validation_function(t)}dnd_move_to_container(t,e){var n;null===(n=this.dragAndDropHandler)||void 0===n||n.try_move_draggable_to_container(t,e)}get_dnd_data(){var t,e;return null!==(e=null===(t=this.dragAndDropHandler)||void 0===t?void 0:t.getData())&&void 0!==e?e:[]}set_dnd_data(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.setData(t)}dnd_reorder_tabindex(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.reorder_svg_container_tabindex(t)}get_dnd_container_content_size(t){return this.dragAndDropHandler?this.dragAndDropHandler.get_container_content_size(t):[NaN,NaN]}set_dnd_content_sort(t){this.dragAndDropHandler&&(this.dragAndDropHandler.sort_content=t)}remove_dnd_draggable(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.remove_draggable(t)}remove_locator(t){var e;null===(e=this.locatorHandler)||void 0===e||e.remove(t)}remove_button(t){var e;null===(e=this.buttonHandler)||void 0===e||e.remove(t)}custom_object(t,e,n){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let r=this.get_diagram_svg(),i=this.get_svg_element(Ct.custom,!this.custom_svg),s=document.createElementNS("http://www.w3.org/2000/svg","svg");return Y(s,s,n,!0,!1,W(r)),s.setAttribute("overflow","visible"),s.setAttribute("class",e.join(" ")),s.setAttribute("id",t),i.setAttribute("viewBox",r.getAttribute("viewBox")),i.setAttribute("preserveAspectRatio",r.getAttribute("preserveAspectRatio")),i.style.overflow="visible",i.appendChild(s),this.custom_svg=i,s}custom_object_g(t,e,n){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let r=this.get_diagram_svg(),i=this.get_svg_element(Ct.custom,!this.custom_svg),s=document.createElementNS("http://www.w3.org/2000/svg","g");return Y(i,s,n,!0,!1,W(r)),s.setAttribute("overflow","visible"),s.setAttribute("class",e.join(" ")),s.setAttribute("id",t),i.setAttribute("viewBox",r.getAttribute("viewBox")),i.setAttribute("preserveAspectRatio",r.getAttribute("preserveAspectRatio")),i.style.overflow="visible",i.appendChild(s),this.custom_svg=i,s}init_button(){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let t=this.get_diagram_svg(),e=this.get_svg_element(Ct.button,!this.button_svg);if(this.button_svg=e,null==this.buttonHandler){let n=new Bt(e,t);n.focus_padding=this.focus_padding,this.buttonHandler=n}}button_toggle(t,e,n,r=!1,i){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");let s;this.inp_variables[t]=r,s=i?(e,n=!0)=>{this.inp_variables[t]=e,i(t,e),n&&this.draw()}:(e,n=!0)=>{this.inp_variables[t]=e,n&&this.draw()};let a=this.buttonHandler.try_add_toggle(t,e,n,r,s);this.inp_setter[t]=a}button_click(t,e,n,r){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");this.buttonHandler.try_add_click(t,e,n,e,(()=>{r(),this.draw()}))}button_click_hover(t,e,n,r,i){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");this.buttonHandler.try_add_click(t,e,n,r,(()=>{i(),this.draw()}))}}function Ht(t,e){null!=t&&null!=e&&(t.setAttribute("viewBox",e.getAttribute("viewBox")),t.setAttribute("preserveAspectRatio",e.getAttribute("preserveAspectRatio")))}function Dt(t,e){if(0==e.length)return t;let n=1/0,r=e[0];for(let i=0;i<e.length;i++){let s=e[i].sub(t).length_sq();s<n&&(n=s,r=e[i])}return r}function It(t,e){let n;return n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?function(t){let e=t.getScreenCTM(),n=t.width.baseVal.value,r=t.height.baseVal.value,i=t.viewBox.baseVal,s=n/i.width,a=r/i.height,l=Math.min(s,a),o=n/2-(i.width/2+i.x)*l,c=r/2-(i.height/2+i.y)*l;return DOMMatrix.fromMatrix(e).translate(o,c).scale(l)}(e):e.getScreenCTM(),{x:(t.x-n.e)/n.a,y:-(t.y-n.f)/n.d}}function Rt(t,e){return window.TouchEvent&&t instanceof TouchEvent&&(t=t.touches[0]),It({x:t.clientX,y:t.clientY},e)}function jt(t,e){return Rt(t,e)}class zt{constructor(t,n){this.control_svg=t,this.diagram_svg=n,this.selectedElement=null,this.selectedVariable=null,this.mouseOffset=e(0,0),this.callbacks={},this.setter={},this.svg_elements={},this.blinking_circle_outers=[],this.first_touch_callback=null,this.element_pos={}}startDrag(t,n,r){this.selectedElement=r,this.selectedVariable=n,t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault();let i=Rt(t,this.control_svg),s=e(i.x,i.y),a=this.element_pos[n];a&&(this.mouseOffset=a.sub(s)),this.handleBlinking()}drag(t){if(null==this.selectedElement)return;if(null==this.selectedVariable)return;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault();let n=Rt(t,this.control_svg),r=e(n.x,n.y).add(this.mouseOffset);this.element_pos[this.selectedVariable]=r,null!=this.setter[this.selectedVariable]&&(r=this.setter[this.selectedVariable](r)),null!=this.selectedVariable&&(null!=this.callbacks[this.selectedVariable]&&this.callbacks[this.selectedVariable](r),this.setViewBox())}setViewBox(){this.control_svg.setAttribute("viewBox",this.diagram_svg.getAttribute("viewBox")),this.control_svg.setAttribute("preserveAspectRatio",this.diagram_svg.getAttribute("preserveAspectRatio"))}endDrag(t){this.selectedElement=null,this.selectedVariable=null}remove(t){var e;this.selectedVariable==t&&(this.selectedElement=null,this.selectedVariable=null),delete this.callbacks[t],delete this.setter[t],null===(e=this.svg_elements[t])||void 0===e||e.remove(),delete this.svg_elements[t],delete this.element_pos[t]}setPos(t,e){this.element_pos[t]=e,this.callbacks[t](e,!1)}registerCallback(t,e){this.callbacks[t]=e}registerSetter(t,e){this.setter[t]=e}addBlinkingCircleOuter(t){this.blinking_circle_outers.push(t)}handleBlinking(){if(0!=this.blinking_circle_outers.length){for(let t=0;t<this.blinking_circle_outers.length;t++)this.blinking_circle_outers[t].classList.remove("diagramatics-locator-blink");this.blinking_circle_outers=[],null!=this.first_touch_callback&&this.first_touch_callback()}}create_locator_diagram_svg(t,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","g");return Y(this.control_svg,i,n.position(e(0,0)),!0,!1,W(this.diagram_svg)),i.style.cursor="pointer",i.setAttribute("overflow","visible"),r&&(i.classList.add("diagramatics-locator-blink"),this.addBlinkingCircleOuter(i)),this.svg_elements[t]?this.svg_elements[t].replaceWith(i):this.control_svg.appendChild(i),this.svg_elements[t]=i,this.element_pos[t],i}create_locator_circle_pointer_svg(t,e,n,r,i){let s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("overflow","visible"),s.style.cursor="pointer";let a=document.createElementNS("http://www.w3.org/2000/svg","circle"),l=document.createElementNS("http://www.w3.org/2000/svg","circle"),o=.4*e;return a.setAttribute("r",e.toString()),a.setAttribute("fill",w(r,x)),a.setAttribute("fill-opacity","0.3137"),a.setAttribute("stroke","none"),a.classList.add("diagramatics-locator-outer"),i&&a.classList.add("diagramatics-locator-blink"),l.setAttribute("r",o.toString()),l.setAttribute("fill",w(r,x)),l.setAttribute("stroke","none"),l.classList.add("diagramatics-locator-inner"),s.appendChild(a),s.appendChild(l),s.setAttribute("transform",`translate(${n.x},${-n.y})`),this.svg_elements[t]?this.svg_elements[t].replaceWith(s):this.control_svg.appendChild(s),this.svg_elements[t]=s,s}}!function(t){t.container="diagramatics-dnd-container",t.draggable="diagramatics-dnd-draggable",t.ghost="diagramatics-dnd-draggable-ghost"}(Tt||(Tt={}));class qt{constructor(t,e){this.dnd_svg=t,this.diagram_svg=e,this.containers={},this.draggables={},this.callbacks={},this.onclickstart_callback={},this.hoveredContainerName=null,this.draggedElementName=null,this.draggedElementGhost=null,this.dropped_outside_callback=null,this.move_validation_function=null,this.sort_content=!1,this.active_draggable_name=null,this.focus_padding=1,this.dom_to_id_map=new WeakMap}add_container(t,e,n,r){null==this.containers[t]?this.containers[t]={name:t,diagram:e,position:e.origin,content:[],config:null!=r?r:{type:"horizontal-uniform"},capacity:null!=n?n:1}:this.replace_container_svg(t,e,n,r)}generate_position_map(t,n,r,i){var s;const a=t[0].add(t[1]).scale(.5);switch(n.type){case"horizontal-uniform":{let n=(t[1].x-t[0].x)/r,i=t[0].x+n/2,s=a.y;return L(0,r).map((t=>e(i+n*t,s)))}case"vertical-uniform":{let n=(t[1].y-t[0].y)/r,i=a.x,s=t[1].y-n/2;return L(0,r).map((t=>e(i,s-n*t)))}case"grid":{let[i,s]=n.value,a=t[1].y-t[0].y,l=(t[1].x-t[0].x)/i,o=a/s,c=t[0].x+l/2,h=t[1].y-o/2;return L(0,r).map((t=>e(c+l*(t%i),h-o*Math.floor(t/i))))}case"vertical":{const r=e(a.x,t[1].y),s=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));return At(s.map((([t,e])=>it(t,e).mut())),n.padding).mut().move_origin("top-center").position(r).translate(e(0,-n.padding)).children.map((t=>t.origin))}case"horizontal":{const r=e(t[0].x,a.y),s=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));return kt(s.map((([t,e])=>it(t,e).mut())),n.padding).mut().move_origin("center-left").position(r).translate(e(n.padding,0)).children.map((t=>t.origin))}case"flex-row":{const r=null!==(s=n.padding)&&void 0!==s?s:0,l=t[1].x-t[0].x-2*r,o=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));let c=Ot(o.map((([t,e])=>it(t,e).mut())),l,r,r,n.vertical_alignment,n.horizontal_alignment).mut();switch(n.horizontal_alignment){case"center":c=c.move_origin("top-center").position(e(a.x,t[1].y-r));break;case"right":c=c.move_origin("top-right").position(e(t[1].x-r,t[1].y-r));break;default:c=c.move_origin("top-left").position(e(t[0].x+r,t[1].y-r))}return c.children.map((t=>t.origin))}default:return[]}}get_container_content_size(t){var e;const n=this.containers[t];if(null==n)return[NaN,NaN];const r=null!==(e=n.config.padding)&&void 0!==e?e:0,i=n.content.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram)&&void 0!==n?n:f()})),[s,a]=mt(u(...i));return[s+2*r,a+2*r]}replace_draggable_svg(t,e){var n,r;let i=this.draggables[t];if(null==i)return;let s=null===(n=i.svgelement)||void 0===n?void 0:n.parentNode;null!=s&&(null===(r=i.svgelement)||void 0===r||r.remove(),i.diagram=e,i.diagram_size=mt(e),this.add_draggable_svg(t,e,s),this.reposition_container_content(i.container))}replace_container_svg(t,e,n,r){var i;let s=this.containers[t];if(null==s)return;const a=this.get_container_outer_g(t);null!=a&&(null===(i=s.svgelement)||void 0===i||i.remove(),s.diagram=e,n&&(s.capacity=n),r&&(s.config=r),this.add_container_svg(t,e,a),this.reposition_container_content(t))}add_draggable_to_container(t,e,n){if(null!=this.draggables[t])return this.replace_draggable_svg(t,e),void this.move_draggable_to_container(t,n,!0);const r=mt(e);this.draggables[t]={name:t,diagram:e.mut(),diagram_size:r,position:e.origin,container:n},this.containers[n].content.push(t)}add_draggable_with_container(t,e,n){if(null!=this.draggables[t])return void this.replace_draggable_svg(t,e);let r=`_container0_${t}`;null==n&&(n=this.diagram_container_from_draggable(e)),this.add_container(r,n);const i=mt(e);this.containers[r].content.push(t),this.draggables[t]={name:t,diagram:e.mut(),diagram_size:i,position:e.origin,container:r}}remove_draggable(t){var e;for(let e in this.containers){const n=this.containers[e];n.content=n.content.filter((e=>e!=t))}null===(e=this.draggables[t].svgelement)||void 0===e||e.remove(),delete this.draggables[t]}registerCallback(t,e){this.callbacks[t]=e}register_clickstart_callback(t,e){this.onclickstart_callback[t]=e}register_dropped_outside_callback(t){this.dropped_outside_callback=t}register_move_validation_function(t){this.move_validation_function=t}setViewBox(){this.dnd_svg.setAttribute("viewBox",this.diagram_svg.getAttribute("viewBox")),this.dnd_svg.setAttribute("preserveAspectRatio",this.diagram_svg.getAttribute("preserveAspectRatio"))}drawSvg(){for(let t in this.containers){const e=this.containers[t];if(null==(null==e?void 0:e.svgelement)){const n=document.createElementNS("http://www.w3.org/2000/svg","g");this.dnd_svg.append(n),this.add_container_svg(t,e.diagram,n)}const n=this.get_container_outer_g(t);if(null!=n)for(let t of e.content){const e=this.draggables[t];(null==e?void 0:e.svgelement)||this.add_draggable_svg(t,e.diagram,n)}}for(let t in this.containers)this.reposition_container_content(t),this.reconfigure_container_tabindex(t)}getData(){let t=[];for(let e in this.containers)t.push({container:e,content:this.containers[e].content});return t}setData(t){try{for(let e of t)for(let t of e.content)this.try_move_draggable_to_container(t,e.container,!0)}catch(t){console.error("the data is not valid")}}diagram_container_from_draggable(t){return st(...t.bounding_box()).move_origin(t.origin).strokedasharray([5])}register_tap_enter(t,e){t.onclick=t=>{e(!1)},t.onkeydown=t=>{"Enter"==t.key&&e(!0)}}tap_enter_draggable(t,e){var n,r,i;if(null==this.active_draggable_name){this.reset_picked_class(),this.active_draggable_name=t;let i=this.draggables[t];if(null==i.svgelement)return;i.svgelement.classList.add("picked"),e&&(null===(r=(n=this.onclickstart_callback)[t])||void 0===r||r.call(n))}else if(t==this.active_draggable_name)this.reset_picked_class(),this.active_draggable_name=null;else{const e=null===(i=this.draggables[t])||void 0===i?void 0:i.container;e&&this.try_move_draggable_to_container(this.active_draggable_name,e),this.reset_picked_class(),this.active_draggable_name=null}}tap_enter_container(t){null!=this.active_draggable_name&&(this.try_move_draggable_to_container(this.active_draggable_name,t),this.active_draggable_name=null,this.reset_picked_class())}get_container_outer_g(t){var e;const n=this.containers[t];return null===(e=null==n?void 0:n.svgelement)||void 0===e?void 0:e.parentNode}add_container_svg(t,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.dnd_svg,i,n.position(e(0,0)),!1,!1,W(this.diagram_svg),Tt.container);let s=n.origin;i.setAttribute("transform",`translate(${s.x},${-s.y})`),i.setAttribute("class",Tt.container),i.setAttribute("tabindex","0"),i.onmousedown=t=>{t.preventDefault()},this.register_tap_enter(i,(()=>{this.tap_enter_container(t)})),r.prepend(i),this.containers[t].svgelement=i,this.dom_to_id_map.set(i,t),this.add_focus_rect(i,n)}add_draggable_svg(t,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.dnd_svg,i,n.position(e(0,0)),!0,!1,W(this.diagram_svg),Tt.draggable);let s=n.origin;i.setAttribute("transform",`translate(${s.x},${-s.y})`),i.setAttribute("class",Tt.draggable),i.setAttribute("draggable","true"),i.setAttribute("tabindex","0"),i.onmousedown=e=>{this.draggedElementName=t,this.startDrag(e)},i.ontouchstart=e=>{this.draggedElementName=t,this.tap_enter_draggable(t),this.startDrag(e)},this.register_tap_enter(i,(e=>{this.tap_enter_draggable(t,e)})),r.append(i),this.draggables[t].svgelement=i,this.dom_to_id_map.set(i,t),this.add_focus_rect(i,n)}add_focus_rect(t,n){const r=n.position(e(0,0)).bounding_box(),i=this.focus_padding,s=r[1].x-r[0].x+2*i,a=r[1].y-r[0].y+2*i,l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("width",s.toString()),l.setAttribute("height",a.toString()),l.setAttribute("x",(r[0].x-i).toString()),l.setAttribute("y",(-r[1].y-i).toString()),l.setAttribute("fill","none"),l.setAttribute("stroke","black"),l.setAttribute("stroke-width","1"),l.setAttribute("vector-effect","non-scaling-stroke"),l.setAttribute("class",St),t.appendChild(l)}move_svg_draggable_to_container(t,e){var n;const r=null===(n=this.draggables[t])||void 0===n?void 0:n.svgelement;if(null==r)return;const i=this.get_container_outer_g(e);null!=i&&i.appendChild(r)}reorder_svg_container_content(t){var e,n;const r=null===(e=this.containers[t])||void 0===e?void 0:e.content,i=this.get_container_outer_g(t);if(null!=r&&null!=i)for(let t of r){const e=null===(n=this.draggables[t])||void 0===n?void 0:n.svgelement;null!=e&&i.appendChild(e)}}reconfigure_container_tabindex(t){var e,n,r,i;const s=this.containers[t];if(null!=s&&1==s.capacity)if(1==s.content.length){if(null===(e=s.svgelement)||void 0===e||e.setAttribute("tabindex","-1"),s.svgelement==document.activeElement){const t=s.content[0];null===(r=null===(n=this.draggables[t])||void 0===n?void 0:n.svgelement)||void 0===r||r.focus()}}else null===(i=s.svgelement)||void 0===i||i.setAttribute("tabindex","0")}reorder_svg_container_tabindex(t){for(let e of t){const t=this.get_container_outer_g(e);null!=t&&this.dnd_svg.appendChild(t)}}reposition_container_content(t){var e,n,r,i;let s=this.containers[t];if(null==s)return;this.sort_content?(s.content.sort(),this.reorder_svg_container_content(t)):(null===(e=s.config)||void 0===e?void 0:e.sorting_function)&&(s.content.sort(s.config.sorting_function),this.reorder_svg_container_content(t));const a=null!==(n=s.config.custom_region_box)&&void 0!==n?n:s.diagram.bounding_box(),l=this.generate_position_map(a,s.config,s.capacity,s.content);for(let t=0;t<s.content.length;t++){let e=this.draggables[s.content[t]],n=null!==(r=l[t])&&void 0!==r?r:s.diagram.origin;e.diagram=e.diagram.position(n),e.position=n,null===(i=e.svgelement)||void 0===i||i.setAttribute("transform",`translate(${n.x},${-n.y})`)}}remove_draggable_from_container(t,e){this.containers[e].content=this.containers[e].content.filter((e=>e!=t))}move_draggable_to_container(t,e,n=!1){let r=this.draggables[t];if(null==r)return;if(r.container==e)return;let i=this.containers[e],s=r.container;if(this.remove_draggable_from_container(t,s),r.container=e,i.content.push(t),this.move_svg_draggable_to_container(t,e),this.reposition_container_content(e),this.reposition_container_content(s),this.reconfigure_container_tabindex(e),this.reconfigure_container_tabindex(s),n)return;let a=this.draggables[t];this.callbacks[a.name](a.position)}try_move_draggable_to_container(t,e,n=!1){if(this.move_validation_function){if(!this.move_validation_function(t,e))return}let r=this.draggables[t],i=this.containers[e];if(i.content.length+1<=i.capacity)this.move_draggable_to_container(t,e,n);else if(1==i.capacity){let s=r.container,a=i.content[0];this.move_draggable_to_container(t,e,!0),this.move_draggable_to_container(a,s,n)}}startDrag(t){var e,n;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),this.hoveredContainerName=null,this.reset_hovered_class();let r=this.dnd_svg.getElementsByClassName(Tt.ghost);for(let t=0;t<r.length;t++)r[t].remove();if(null==this.draggedElementName)return;let i=this.draggables[this.draggedElementName];null!=i.svgelement&&(i.svgelement.classList.add("picked"),null===(n=(e=this.onclickstart_callback)[this.draggedElementName])||void 0===n||n.call(e),this.draggedElementGhost=i.svgelement.cloneNode(!0),this.draggedElementGhost.style.pointerEvents="none",this.draggedElementGhost.setAttribute("opacity","0.5"),this.draggedElementGhost.setAttribute("class",Tt.ghost),this.dnd_svg.append(this.draggedElementGhost))}get_dnd_element_data_from_evt(t){let e=null;if(window.TouchEvent&&t instanceof TouchEvent){let n=t.touches[0];e=document.elementFromPoint(n.clientX,n.clientY)}else{const n=t;e=document.elementFromPoint(n.clientX,n.clientY)}if(null==e)return null;if("tspan"==e.localName&&(e=e.parentElement),null==e)return null;let n=e.getAttribute("_dg_tag");if(null==n)return null;if(n==Tt.container){let t=e.parentElement;if(null==t)return null;let n=this.dom_to_id_map.get(t);return null==n?null:{name:n,type:Tt.container}}if(n==Tt.draggable){let t=e.parentElement;if(null==t)return null;let n=this.dom_to_id_map.get(t);return null==n?null:{name:n,type:Tt.draggable}}return null}drag(t){var e,n,r;if(null==this.draggedElementName)return;if(null==this.draggedElementGhost)return;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),this.reset_hovered_class();let i=this.get_dnd_element_data_from_evt(t);null==i?this.hoveredContainerName=null:i.type==Tt.container?(this.hoveredContainerName=i.name,null===(e=this.containers[i.name].svgelement)||void 0===e||e.classList.add("hovered")):i.type==Tt.draggable&&(this.hoveredContainerName=null===(n=this.draggables[i.name])||void 0===n?void 0:n.container,null===(r=this.draggables[i.name].svgelement)||void 0===r||r.classList.add("hovered"));let s=Rt(t,this.dnd_svg);this.draggedElementGhost.setAttribute("transform",`translate(${s.x},${-s.y})`)}endDrag(t){null!=this.hoveredContainerName&&null!=this.draggedElementName&&this.try_move_draggable_to_container(this.draggedElementName,this.hoveredContainerName),null==this.hoveredContainerName&&null!=this.draggedElementName&&null!=this.dropped_outside_callback&&this.dropped_outside_callback(this.draggedElementName),this.draggedElementName=null,this.hoveredContainerName=null,this.reset_hovered_class(),this.reset_picked_class(),null!=this.draggedElementGhost&&(this.draggedElementGhost.remove(),this.draggedElementGhost=null)}reset_hovered_class(){var t,e;for(let e in this.containers)null===(t=this.containers[e].svgelement)||void 0===t||t.classList.remove("hovered");for(let t in this.draggables)null===(e=this.draggables[t].svgelement)||void 0===e||e.classList.remove("hovered")}reset_picked_class(){var t;for(let e in this.draggables)null===(t=this.draggables[e].svgelement)||void 0===t||t.classList.remove("picked")}}class Bt{constructor(t,e){this.button_svg=t,this.diagram_svg=e,this.states={},this.svg_g_element={},this.touchdownName=null,this.focus_padding=1}remove(t){delete this.states[t];const e=this.svg_g_element[t];null==e||e.remove(),delete this.svg_g_element[t]}try_add_toggle(t,e,n,r,i){let s=this.svg_g_element[t];return s?s.innerHTML="":(s=document.createElementNS("http://www.w3.org/2000/svg","g"),this.button_svg.appendChild(s)),this.add_toggle(t,e,n,r,s,i)}add_toggle(t,e,n,r,i,s){let a=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,a,n,!0,!1,W(this.diagram_svg)),a.setAttribute("overflow","visible"),a.style.cursor="pointer";let l=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,l,e,!0,!1,W(this.diagram_svg)),l.setAttribute("overflow","visible"),l.style.cursor="pointer",i.setAttribute("overflow","visible"),i.setAttribute("tabindex","0"),i.appendChild(l),i.appendChild(a),this.svg_g_element[t]=i,this.states[t]=r;const o=t=>{l.setAttribute("display",t?"block":"none"),a.setAttribute("display",t?"none":"block")};o(this.states[t]);const c=(e,n=!0)=>{this.states[t]=e,s(this.states[t],n),o(this.states[t])};i.onmousedown=t=>{t.preventDefault()},i.onclick=e=>{e.preventDefault(),c(!this.states[t])},i.onkeydown=e=>{"Enter"==e.key&&c(!this.states[t])};return t=>{c(t,!1)}}try_add_click(t,e,n,r,i){let s=this.svg_g_element[t];s?s.innerHTML="":(s=document.createElementNS("http://www.w3.org/2000/svg","g"),this.button_svg.appendChild(s)),this.add_click(t,e,n,r,s,i)}add_click(t,e,n,r,i,s){let a=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,a,e,!0,!1,W(this.diagram_svg)),a.setAttribute("overflow","visible"),a.style.cursor="pointer";let l=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,l,n,!0,!1,W(this.diagram_svg)),l.setAttribute("overflow","visible"),l.style.cursor="pointer";let o=document.createElementNS("http://www.w3.org/2000/svg","g");Y(this.button_svg,o,r,!0,!1,W(this.diagram_svg)),o.setAttribute("overflow","visible"),o.style.cursor="pointer",i.setAttribute("class","diagramatics-focusable-no-outline"),i.setAttribute("overflow","visible"),i.setAttribute("tabindex","0"),i.appendChild(a),i.appendChild(l),i.appendChild(o),this.add_focus_rect(i,e),this.svg_g_element[t]=i;const c=(t,e)=>{a.setAttribute("display",t||e?"none":"block"),l.setAttribute("display",t?"block":"none"),o.setAttribute("display",e&&!t?"block":"none")};c(!1,!1);let h=!1,d=!1;const u=()=>{c(h,d)};i.onblur=t=>{d=!1,h=!1,u()},i.onmouseenter=t=>{d=!0,u()},i.onmouseleave=t=>{d=!1,h=!1,u()},i.onmousedown=t=>{t.preventDefault(),h=!0,u()},i.onmouseup=t=>{h=!1,u()},i.onclick=t=>{s(),d=!1,h=!1,u()},i.onkeydown=t=>{"Enter"==t.key&&(s(),h=!0,u())},i.onkeyup=t=>{h=!1,u()}}add_focus_rect(t,e){const n=e.bounding_box(),r=this.focus_padding,i=n[1].x-n[0].x+2*r,s=n[1].y-n[0].y+2*r,a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("width",i.toString()),a.setAttribute("height",s.toString()),a.setAttribute("x",(n[0].x-r).toString()),a.setAttribute("y",(-n[1].y-r).toString()),a.setAttribute("fill","none"),a.setAttribute("stroke","black"),a.setAttribute("stroke-width","1"),a.setAttribute("vector-effect","non-scaling-stroke"),a.setAttribute("class",St),t.appendChild(a)}}class Pt{constructor(t){this.elements=[],this.elementMap=new Map,this.nextId=1,this.contentDiv=t}generateId(t){return`${t}_${this.nextId++}`}addElement(t,e){const n=this.generateId(e);return t.id=n,this.elements.push(t),this.elementMap.set(n,t),t.appendTo(this.contentDiv),n}header(t,e=1){const n=new Vt(t,e);return this.addElement(n,"header"),n}paragraph(t){const e=new Gt(t);return this.addElement(e,"paragraph"),e}diagram(t=100,e=100){const n=new Ft(t,e,this.contentDiv);return this.addElement(n,"drawing"),n}getElement(t){return this.elementMap.get(t)}removeElement(t){const e=this.elementMap.get(t);if(e){const n=this.elements.indexOf(e);n>-1&&this.elements.splice(n,1),this.elementMap.delete(t);const r=this.contentDiv.querySelector(`#${t}`);return r&&this.contentDiv.removeChild(r),!0}return!1}toJSON(){return{elements:this.elements.map((t=>Object.assign({id:t.id},t.toJSON()))),nextId:this.nextId}}static fromJSON(t,e){const n=new Pt(e);return n.nextId=t.nextId,t.elements.forEach((t=>{let r;switch(t.type){case"header":r=Vt.fromJSON(t);break;case"paragraph":r=Gt.fromJSON(t);break;case"drawing":r=Ft.fromJSON(t,e);break;default:throw new Error(`Unknown element type: ${t.type}`)}r.id=t.id,n.elements.push(r),n.elementMap.set(r.id,r),r.appendTo(n.contentDiv)})),n}}class Ft{constructor(t,e,n){this.width=t,this.height=e,this.contentDiv=n,this.id="",this.callbacks={},this.contentDiv=n,this.element=document.createElementNS("http://www.w3.org/2000/svg","svg")}appendTo(t){this.element.setAttribute("id",this.id),this.element.setAttribute("width",`${this.width}px`),this.element.setAttribute("height",`${this.height}px`),this.element.style.margin="auto",this.attachEventListeners(this.element),t.appendChild(this.element)}init(){return{draw:(...t)=>{K(this.element,u(...t))},int:new Nt(this.contentDiv,this.element)}}getElement(){return this.element}attachEventListeners(t){t.addEventListener("click",(()=>this.emit("click")))}emit(t){this.callbacks[t]&&this.callbacks[t].forEach((t=>t()))}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}toJSON(){return{type:"drawing",width:this.width,height:this.height}}static fromJSON(t,e){return new Ft(t.width,t.height,e)}}class Gt{constructor(t){this.text=t,this.id="",this.callbacks={},this.element=document.createElement("p")}attachEventListeners(t){t.addEventListener("click",(()=>this.emit("click")))}appendTo(t){this.element.id=this.id,this.element.textContent=this.text,this.attachEventListeners(this.element),t.appendChild(this.element)}getElement(){return this.element}emit(t){this.callbacks[t]&&this.callbacks[t].forEach((t=>t()))}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}toJSON(){return{type:"paragraph",text:this.text}}static fromJSON(t){return new Gt(t.text)}}class Vt{constructor(t,e){this.text=t,this.level=e,this.id="",this.callbacks={},this.element=document.createElement(`h${this.level}`)}appendTo(t){this.element.id=this.id,this.element.textContent=this.text,this.attachEventListeners(this.element),t.appendChild(this.element)}getElement(){return this.element}attachEventListeners(t){t.addEventListener("click",(()=>this.emit("click")))}emit(t){this.callbacks[t]&&this.callbacks[t].forEach((t=>t()))}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}toJSON(){return{type:"header",text:this.text,level:this.level}}static fromJSON(t){return new Vt(t.text,t.level)}}function $t(t){return function e(n){if(n.type==a.Polygon||n.type==a.Curve)return t(n);if(n.type==a.Diagram)return n.children=n.children.map((t=>e(t))),n;if(n.type==a.Text||n.type==a.MultilineText)return n;throw new Error("Unreachable, unknown diagram type : "+n.type)}}function Ut(t){return $t((function(e){if(null==e.path)return e;let n=(e.type==a.Curve?O(0,1,t):S(0,1,t)).map((t=>e.parametric_point(t)));return e.path=new d(n),e}))}function Xt(t,e,r){let[i,s,a]=e,l=i.sub(s).normalize(),o=a.sub(s).normalize(),c=Math.abs((l.angle()-o.angle())%Math.PI),h=t/Math.tan(c/2),d=i.sub(s).length(),u=a.sub(s).length();h=Math.min(h,d/2,u/2),t=h*Math.tan(c/2);let g=s.add(l.scale(h)),p=s.add(o.scale(h)),_=Math.sqrt(t*t+h*h),f=s.add(l.add(o).normalize().scale(_)),m=g.sub(f).angle(),b=p.sub(f).angle(),v=b+2*Math.PI,y=b-2*Math.PI,x=Math.abs(m-b);return Math.abs(m-v)<x&&(b=v),Math.abs(m-y)<x&&(b=y),O(m,b,r).map((e=>f.add(n(e).scale(t))))}function Wt(t=1,e,n=40){if(0==t)return t=>t;return"number"==typeof t&&(t=[t]),$t((function(r){if(null==r.path)return r;let i=L(0,r.path.points.length);null==e&&(e=i),e=e.filter((t=>i.includes(t))),t=E(t,e.length);let s=[];for(let i=0;i<r.path.points.length;i++){let a=i;if(!e.includes(a)){s.push(r.path.points[i]);continue}let l=(a-1+r.path.points.length)%r.path.points.length,o=(a+1)%r.path.points.length,c=r.path.points[l],h=r.path.points[i],d=r.path.points[o],u=Xt(t[e.indexOf(a)],[c,h,d],n);s=s.concat(u)}return r.path=new d(s),r}))}var Jt,Yt=Object.freeze({__proto__:null,add_arrow:function(t,e=!1){return $t((function(n){if(null==n.path)return n;let r=e?n.path.points[0]:n.path.points[n.path.points.length-1];return u(n,ut(e?n.path.points[1]:n.path.points[n.path.points.length-2],r,t)).clone_style_from(n)}))},arrowhead_replace:function(t){return function(e){return e.apply_to_tagged_recursive(s.ARROW_HEAD,(e=>{let n=function(t){var e;if(!t.contain_tag(s.ARROW_HEAD))return NaN;let n=null===(e=t.path)||void 0===e?void 0:e.points;if(null==n)return NaN;if(3!=n.length)return NaN;let r=n[0],i=n[1],a=n[2],l=i.add(a).scale(.5);return r.sub(l).angle()}(e);return t.copy().rotate(n).position(e.origin)}))}},resample:Ut,round_corner:Wt,slicepath:function(t,e,n=100){t>e&&([t,e]=[e,t]),t<0&&(t=0),e>1&&(e=1);let r=Math.floor(n/(e-t));return $t((function(n){if(null==n.path)return n;let i=n.apply(Ut(r));if(null==i.path)return n;let s=i.path.points.slice(Math.floor(t*r),Math.floor(e*r)+1);return i.path=new d(s),i}))},subdivide:function(t=100){return $t((function(n){if(null==n.path)return n;let r=[];for(let i=0;i<n.path.points.length;i++){let s=(i+1)%n.path.points.length,a=n.path.points[i],l=n.path.points[s],o=O(a.x,l.x,t+1),c=O(a.y,l.y,t+1),h=o.map(((t,n)=>e(t,c[n])));h.pop(),r=r.concat(h)}return n.path=new d(r),n}))}});!function(t){t[t.BeforeStart=0]="BeforeStart",t[t.EqualStart=1]="EqualStart",t[t.BetweenStartAndEnd=2]="BetweenStartAndEnd",t[t.EqualEnd=3]="EqualEnd",t[t.AfterEnd=4]="AfterEnd"}(Jt||(Jt={}));class Kt{pointsSame(t,e){return this.pointsSameX(t,e)&&this.pointsSameY(t,e)}pointsCompare(t,e){return this.pointsSameX(t,e)?this.pointsSameY(t,e)?0:t[1]<e[1]?-1:1:t[0]<e[0]?-1:1}}class Zt extends Kt{constructor(t=1e-10){super(),this.epsilon=t}pointAboveOrOnLine(t,e,n){const r=e[0],i=e[1],s=n[0],a=n[1],l=t[0];return(s-r)*(t[1]-i)-(a-i)*(l-r)>=-this.epsilon}pointBetween(t,e,n){const r=t[1]-e[1],i=n[0]-e[0],s=t[0]-e[0],a=n[1]-e[1],l=s*i+r*a;if(l<this.epsilon)return!1;return!(l-(i*i+a*a)>-this.epsilon)}pointsSameX(t,e){return Math.abs(t[0]-e[0])<this.epsilon}pointsSameY(t,e){return Math.abs(t[1]-e[1])<this.epsilon}pointsCollinear(t,e,n){const r=t[0]-e[0],i=t[1]-e[1],s=e[0]-n[0],a=e[1]-n[1];return Math.abs(r*a-s*i)<this.epsilon}linesIntersect(t,e,n,r){const i=e[0]-t[0],s=e[1]-t[1],a=r[0]-n[0],l=r[1]-n[1],o=i*l-s*a;if(Math.abs(o)<this.epsilon)return null;const c=t[0]-n[0],h=t[1]-n[1],d=(a*h-l*c)/o,u=(i*h-s*c)/o,g=t=>t<=-this.epsilon?Jt.BeforeStart:t<this.epsilon?Jt.EqualStart:t-1<=-this.epsilon?Jt.BetweenStartAndEnd:t-1<this.epsilon?Jt.EqualEnd:Jt.AfterEnd,p=[t[0]+d*i,t[1]+d*s];return{alongA:g(d),alongB:g(u),p:p}}}class Qt{constructor(){this.nodes=[]}remove(t){const e=this.nodes.indexOf(t);e>=0&&this.nodes.splice(e,1)}getIndex(t){return this.nodes.indexOf(t)}isEmpty(){return this.nodes.length<=0}getHead(){return this.nodes[0]}removeHead(){this.nodes.shift()}insertBefore(t,e){this.findTransition(t,e).insert(t)}findTransition(t,e){var n,r;let i=0,s=this.nodes.length;for(;i<s;){const n=i+s>>1;a=this.nodes[n],e(t)-e(a)>0?s=n:i=n+1}var a;return{before:i<=0?null:null!==(n=this.nodes[i-1])&&void 0!==n?n:null,after:null!==(r=this.nodes[i])&&void 0!==r?r:null,insert:t=>(this.nodes.splice(i,0,t),t)}}}class te{constructor(t,e,n,r){var i;this.otherFill=null,this.id=null!==(i=null==r?void 0:r.segmentId())&&void 0!==i?i:-1,this.start=t,this.end=e,this.myFill={above:n?n.myFill.above:null,below:n?n.myFill.below:null}}}class ee{constructor(t,e,n,r){this.status=null,this.isStart=t,this.p=e,this.seg=n,this.primary=r}}class ne{constructor(t,e,n=null){this.events=new Qt,this.status=new Qt,this.selfIntersection=t,this.geo=e,this.log=n}compareEvents(t,e,n,r,i,s){const a=this.geo.pointsCompare(e,i);return 0!==a?a:this.geo.pointsSame(n,s)?0:t!==r?t?1:-1:this.geo.pointAboveOrOnLine(n,r?i:s,r?s:i)?1:-1}addEvent(t){this.events.insertBefore(t,(e=>e===t?0:this.compareEvents(t.isStart,t.p,t.other.p,e.isStart,e.p,e.other.p)))}divideEvent(t,e){var n;const r=new te(e,t.seg.end,t.seg,this.log);return null===(n=this.log)||void 0===n||n.segmentChop(t.seg,e),this.events.remove(t.other),t.seg.end=e,t.other.p=e,this.addEvent(t.other),this.addSegment(r,t.primary)}newSegment(t,e){const n=this.geo.pointsCompare(t,e);return 0===n?null:n<0?new te(t,e,null,this.log):new te(e,t,null,this.log)}addSegment(t,e){const n=new ee(!0,t.start,t,e),r=new ee(!1,t.end,t,e);return n.other=r,r.other=n,this.addEvent(n),this.addEvent(r),n}addRegion(t){let e,n=t[t.length-1];for(let r=0;r<t.length;r++){e=n,n=t[r];const i=this.newSegment(e,n);i&&this.addSegment(i,!0)}}compareStatus(t,e){const n=t.seg.start,r=t.seg.end,i=e.seg.start,s=e.seg.end;return this.geo.pointsCollinear(n,i,s)?this.geo.pointsCollinear(r,i,s)||this.geo.pointAboveOrOnLine(r,i,s)?1:-1:this.geo.pointAboveOrOnLine(n,i,s)?1:-1}statusFindSurrounding(t){return this.status.findTransition(t,(e=>e===t?0:-this.compareStatus(t,e)))}checkIntersection(t,e){var n;const r=t.seg,i=e.seg,s=r.start,a=r.end,l=i.start,o=i.end;null===(n=this.log)||void 0===n||n.checkIntersection(r,i);const c=this.geo.linesIntersect(s,a,l,o);if(null===c){if(!this.geo.pointsCollinear(s,a,l))return null;if(this.geo.pointsSame(s,o)||this.geo.pointsSame(a,l))return null;const n=this.geo.pointsSame(s,l),r=this.geo.pointsSame(a,o);if(n&&r)return e;const i=!n&&this.geo.pointBetween(s,l,o),c=!r&&this.geo.pointBetween(a,l,o);if(n)return c?this.divideEvent(e,a):this.divideEvent(t,o),e;i&&(r||(c?this.divideEvent(e,a):this.divideEvent(t,o)),this.divideEvent(e,s))}else c.alongA===Jt.BetweenStartAndEnd&&(c.alongB===Jt.EqualStart?this.divideEvent(t,l):c.alongB===Jt.BetweenStartAndEnd?this.divideEvent(t,c.p):c.alongB===Jt.EqualEnd&&this.divideEvent(t,o)),c.alongB===Jt.BetweenStartAndEnd&&(c.alongA===Jt.EqualStart?this.divideEvent(e,s):c.alongA===Jt.BetweenStartAndEnd?this.divideEvent(e,c.p):c.alongA===Jt.EqualEnd&&this.divideEvent(e,a));return null}calculate(t,e){var n,r,i,s,a,l,o,c;const h=[];for(;!this.events.isEmpty();){const c=this.events.getHead();if(null===(n=this.log)||void 0===n||n.vert(c.p[0]),c.isStart){null===(r=this.log)||void 0===r||r.segmentNew(c.seg,c.primary);const n=this.statusFindSurrounding(c),o=n.before,h=n.after;null===(i=this.log)||void 0===i||i.tempStatus(c.seg,!!o&&o.seg,!!h&&h.seg);const d=()=>{if(o){const t=this.checkIntersection(c,o);if(t)return t}return h?this.checkIntersection(c,h):null},u=d();if(u){if(this.selfIntersection){let t;t=null===c.seg.myFill.below||c.seg.myFill.above!==c.seg.myFill.below,t&&(u.seg.myFill.above=!u.seg.myFill.above)}else u.seg.otherFill=c.seg.myFill;null===(s=this.log)||void 0===s||s.segmentUpdate(u.seg),this.events.remove(c.other),this.events.remove(c)}if(this.events.getHead()!==c){null===(a=this.log)||void 0===a||a.rewind(c.seg);continue}if(this.selfIntersection){let e;e=null===c.seg.myFill.below||c.seg.myFill.above!==c.seg.myFill.below,c.seg.myFill.below=h?h.seg.myFill.above:t,c.seg.myFill.above=e?!c.seg.myFill.below:c.seg.myFill.below}else if(null===c.seg.otherFill){let n;if(h)if(c.primary===h.primary){if(null===h.seg.otherFill)throw new Error("otherFill is null");n=h.seg.otherFill.above}else n=h.seg.myFill.above;else n=c.primary?e:t;c.seg.otherFill={above:n,below:n}}null===(l=this.log)||void 0===l||l.status(c.seg,!!o&&o.seg,!!h&&h.seg),c.other.status=n.insert(c)}else{const t=c.status;if(null===t)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");const e=this.status.getIndex(t);if(e>0&&e<this.status.nodes.length-1){const t=this.status.nodes[e-1],n=this.status.nodes[e+1];this.checkIntersection(t,n)}if(null===(o=this.log)||void 0===o||o.statusRemove(t.seg),this.status.remove(t),!c.primary){if(!c.seg.otherFill)throw new Error("otherFill is null");const t=c.seg.myFill;c.seg.myFill=c.seg.otherFill,c.seg.otherFill=t}h.push(c.seg)}this.events.removeHead()}return null===(c=this.log)||void 0===c||c.done(),h}}function re(t,e,n){const r=[];for(const i of t){const t=(i.myFill.above?8:0)+(i.myFill.below?4:0)+(i.otherFill&&i.otherFill.above?2:0)+(i.otherFill&&i.otherFill.below?1:0);if(0!==e[t]){const s=new te(i.start,i.end,null,n);s.myFill.above=1===e[t],s.myFill.below=2===e[t],r.push(s)}}return null==n||n.selected(r),r}class ie{static union(t,e){return re(t,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],e)}static intersect(t,e){return re(t,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],e)}static difference(t,e){return re(t,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],e)}static differenceRev(t,e){return re(t,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],e)}static xor(t,e){return re(t,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],e)}}function se(t,e,n){const r=[],i=[];for(const s of t){const a=s.start,l=s.end;if(e.pointsSame(a,l)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");continue}null==n||n.chainStart(s);const o={index:0,matches_head:!1,matches_pt1:!1},c={index:0,matches_head:!1,matches_pt1:!1};let h=o;function d(t,e,n){return h&&(h.index=t,h.matches_head=e,h.matches_pt1=n),h===o?(h=c,!1):(h=null,!0)}for(let m=0;m<r.length;m++){const b=r[m],v=b[0],y=b[b.length-1];if(e.pointsSame(v,a)){if(d(m,!0,!0))break}else if(e.pointsSame(v,l)){if(d(m,!0,!1))break}else if(e.pointsSame(y,a)){if(d(m,!1,!0))break}else if(e.pointsSame(y,l)&&d(m,!1,!1))break}if(h===o){r.push([a,l]),null==n||n.chainNew(a,l);continue}if(h===c){null==n||n.chainMatch(o.index);const x=o.index,w=o.matches_pt1?l:a,k=o.matches_head,A=r[x];let E=k?A[0]:A[A.length-1];const O=k?A[1]:A[A.length-2],S=k?A[A.length-1]:A[0],L=k?A[A.length-2]:A[1];if(e.pointsCollinear(O,E,w)&&(k?(null==n||n.chainRemoveHead(o.index,w),A.shift()):(null==n||n.chainRemoveTail(o.index,w),A.pop()),E=O),e.pointsSame(S,w)){r.splice(x,1),e.pointsCollinear(L,S,E)&&(k?(null==n||n.chainRemoveTail(o.index,E),A.pop()):(null==n||n.chainRemoveHead(o.index,E),A.shift())),null==n||n.chainClose(o.index),i.push(A);continue}k?(null==n||n.chainAddHead(o.index,w),A.unshift(w)):(null==n||n.chainAddTail(o.index,w),A.push(w));continue}function u(t){null==n||n.chainReverse(t),r[t].reverse()}function g(t,i){const s=r[t],a=r[i];let l=s[s.length-1];const o=s[s.length-2],c=a[0],h=a[1];e.pointsCollinear(o,l,c)&&(null==n||n.chainRemoveTail(t,l),s.pop(),l=o),e.pointsCollinear(l,c,h)&&(null==n||n.chainRemoveHead(i,c),a.shift()),null==n||n.chainJoin(t,i),r[t]=s.concat(a),r.splice(i,1)}const p=o.index,_=c.index;null==n||n.chainConnect(p,_);const f=r[p].length<r[_].length;o.matches_head?c.matches_head?f?(u(p),g(p,_)):(u(_),g(_,p)):g(_,p):c.matches_head?g(p,_):f?(u(p),g(_,p)):(u(_),g(p,_))}return i}class ae{constructor(){this.list=[],this.nextSegmentId=0,this.curVert=NaN}push(t,e){this.list.push({type:t,data:JSON.parse(JSON.stringify(e))})}segmentId(){return this.nextSegmentId++}checkIntersection(t,e){this.push("check",{seg1:t,seg2:e})}segmentChop(t,e){this.push("div_seg",{seg:t,p:e}),this.push("chop",{seg:t,p:e})}statusRemove(t){this.push("pop_seg",{seg:t})}segmentUpdate(t){this.push("seg_update",{seg:t})}segmentNew(t,e){this.push("new_seg",{seg:t,primary:e})}tempStatus(t,e,n){this.push("temp_status",{seg:t,above:e,below:n})}rewind(t){this.push("rewind",{seg:t})}status(t,e,n){this.push("status",{seg:t,above:e,below:n})}vert(t){t!==this.curVert&&(this.push("vert",{x:t}),this.curVert=t)}selected(t){this.push("selected",{segs:t})}chainStart(t){this.push("chain_start",{seg:t})}chainRemoveHead(t,e){this.push("chain_rem_head",{index:t,p:e})}chainRemoveTail(t,e){this.push("chain_rem_tail",{index:t,p:e})}chainNew(t,e){this.push("chain_new",{p1:t,p2:e})}chainMatch(t){this.push("chain_match",{index:t})}chainClose(t){this.push("chain_close",{index:t})}chainAddHead(t,e){this.push("chain_add_head",{index:t,p:e})}chainAddTail(t,e){this.push("chain_add_tail",{index:t,p:e})}chainConnect(t,e){this.push("chain_con",{index1:t,index2:e})}chainReverse(t){this.push("chain_rev",{index:t})}chainJoin(t,e){this.push("chain_join",{index1:t,index2:e})}done(){this.push("done",null)}}class le{constructor(t){this.log=null,this.geo=t}buildLog(t){var e;return this.log=t?new ae:null,null===(e=this.log)||void 0===e?void 0:e.list}segments(t){const e=new ne(!0,this.geo,this.log);for(const n of t.regions)e.addRegion(n);return{segments:e.calculate(t.inverted,!1),inverted:t.inverted}}combine(t,e){const n=new ne(!1,this.geo,this.log);for(const e of t.segments)n.addSegment(new te(e.start,e.end,e,this.log),!0);for(const t of e.segments)n.addSegment(new te(t.start,t.end,t,this.log),!1);return{combined:n.calculate(t.inverted,e.inverted),inverted1:t.inverted,inverted2:e.inverted}}selectUnion(t){return{segments:ie.union(t.combined,this.log),inverted:t.inverted1||t.inverted2}}selectIntersect(t){return{segments:ie.intersect(t.combined,this.log),inverted:t.inverted1&&t.inverted2}}selectDifference(t){return{segments:ie.difference(t.combined,this.log),inverted:t.inverted1&&!t.inverted2}}selectDifferenceRev(t){return{segments:ie.differenceRev(t.combined,this.log),inverted:!t.inverted1&&t.inverted2}}selectXor(t){return{segments:ie.xor(t.combined,this.log),inverted:t.inverted1!==t.inverted2}}polygon(t){return{regions:se(t.segments,this.geo,this.log),inverted:t.inverted}}union(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectUnion(i);return this.polygon(s)}intersect(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectIntersect(i);return this.polygon(s)}difference(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectDifference(i);return this.polygon(s)}differenceRev(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectDifferenceRev(i);return this.polygon(s)}xor(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectXor(i);return this.polygon(s)}}const oe=new le(new Zt);function ce(t){var e,n;return{regions:[(null!==(n=null===(e=t.path)||void 0===e?void 0:e.points)&&void 0!==n?n:[]).map((t=>[t.x,t.y]))],inverted:!1}}function he(t){const n=t.regions.map((t=>_(t.map((t=>e(t[0],t[1]))))));return n.length<1?f():1==n.length?n[0]:u(...n)}var de,ue=Object.freeze({__proto__:null,difference:function(t,e,n){const r=n?new le(new Zt(n)):oe,i=ce(t),s=ce(e);return he(r.difference(i,s))},intersect:function(t,e,n){const r=n?new le(new Zt(n)):oe,i=ce(t),s=ce(e);return he(r.intersect(i,s))},union:function(t,e,n){const r=n?new le(new Zt(n)):oe,i=ce(t),s=ce(e);return he(r.union(i,s))},xor:function(t,e,n){const r=n?new le(new Zt(n)):oe,i=ce(t),s=ce(e);return he(r.xor(i,s))}});!function(t){t.outer_shadow=function(t,e,n,r,i,s="outer-shadow",a,l,o=1){return`\n        <filter id="${s}" x="-${100*((a-1)/2)}%" y="-${100*((l-1)/2)}%" width="${100*a}%" height="${100*l}%">\n            <feMorphology operator="dilate" radius="${n*o}" in="SourceAlpha" result="dilated" />\n            <feGaussianBlur in="dilated" stdDeviation="${r*o}" />\n            <feOffset dx="${t*o}" dy="${e*o}" result="offsetblur" />\n            <feFlood flood-color="${i}" result="colorblur"/>\n            <feComposite in="colorblur" in2="offsetblur" operator="in" result="shadow" />\n            <feComposite in="shadow" in2="SourceAlpha" operator="out" result="clipped-shadow"/>\n        </filter>\n        `}}(de||(de={}));var ge=Object.freeze({__proto__:null,get string_filter(){return de}});let pe={bbox:void 0,xrange:[-2,2],yrange:[-2,2],xticks:void 0,yticks:void 0,n_sample:100,ticksize:.1,headsize:.05,tick_label_offset:0};function _e(t){let n=Object.assign(Object.assign({},pe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let[r,i]=n.bbox,[s,a]=n.xrange,[l,o]=n.yrange;return function(t){return e(r.x+(t.x-s)/(a-s)*(i.x-r.x),r.y+(t.y-l)/(o-l)*(i.y-r.y))}}let fe=_e;function me(t){let n=Object.assign(Object.assign({},pe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let[r,i]=n.bbox,a=r.x+(i.x-r.x)/(n.xrange[1]-n.xrange[0])*(0-n.xrange[0]),l=r.y+(i.y-r.y)/(n.yrange[1]-n.yrange[0])*(0-n.yrange[0]);return u(gt(e(r.x,l),e(i.x,l),n.headsize).append_tags(s.GRAPH_AXIS),gt(e(a,r.y),e(a,i.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function be(t){let n=Object.assign(Object.assign({},pe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let[r,i]=n.bbox;return u(ut(r,e(i.x,r.y),n.headsize).append_tags(s.GRAPH_AXIS),ut(r,e(r.x,i.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function ve(t){let n=Object.assign(Object.assign({},pe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let[r,i]=n.bbox,a=2*n.ticksize;null==n.xticks&&(n.xticks=Oe(n.xrange[0],n.xrange[1],!1),n.xticks=n.xticks.filter((t=>t>n.xrange[0]&&t<n.xrange[1])));let l=(n.xticks[1]-n.xticks[0])/2,o=n.xticks[0]-l,c=_e(n),h=c(e(o-l/2,0)),d=c(e(o+l/2,0)),_=d.x-h.x,f=h.add(e(1*_/3,-a/2)),m=h.add(e(2*_/3,a/2)),b=g([h,f,m,d]),v=u(p(r,h),b,ut(d,e(i.x,r.y),n.headsize)).append_tags(s.GRAPH_AXIS);return u(v,ut(r,e(r.x,i.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function ye(t,n,r){let i=Object.assign(Object.assign({},pe),r),a=i.ticksize,l=_e(i)(e(t,n));return p(e(l.x,l.y+a/2),e(l.x,l.y-a/2)).stroke("gray").append_tags(s.GRAPH_TICK)}function xe(t,n,r,i){let a=ye(t,n,i),l=pt(r).move_origin_text("top-center").translate(a.get_anchor("bottom-center")).translate(e(0,-((null==i?void 0:i.tick_label_offset)||0))).textfill("gray").append_tags(s.GRAPH_TICK_LABEL);return u(a,l)}function we(t,n,r){let i=Object.assign(Object.assign({},pe),r),a=i.ticksize,l=_e(i)(e(n,t));return p(e(l.x+a/2,l.y),e(l.x-a/2,l.y)).stroke("gray").append_tags(s.GRAPH_TICK)}function ke(t,n,r,i){let a=we(t,n,i),l=pt(r).move_origin_text("center-right").translate(a.get_anchor("center-left")).translate(e(-((null==i?void 0:i.tick_label_offset)||0),0)).textfill("gray").append_tags(s.GRAPH_TICK_LABEL);return u(a,l)}function Ae(t){return.1<t&&t<2?1:t}function Ee(t,e){let n=e-t,r=Math.floor(Math.log10(n)),i=[.1,.15,.2,.5,1].map((t=>t*Math.pow(10,r))),s=i.map((t=>Math.floor(n/t)));for(let t=0;t<s.length;t++)if(s[t]<=10)return Ae(i[t]);return Ae(i.slice(-1)[0])}function Oe(t,e,n=!0){return n&&t<0&&e>0?function(t,e,n=!0){if(t>0)throw new Error("neg must be negative");if(e<0)throw new Error("pos must be positive");let r=Math.max(-t,e),i=Ee(-r,r),s=Math.ceil(t/i)*i,a=Math.floor(e/i)*i,l=O(s,a,Math.floor((a-s)/i)+1),o=-Math.floor(Math.log10(i));return o>=0&&(l=l.map((t=>parseFloat(t.toFixed(o))))),n?l.filter((t=>0!=t)):l}(t,e):function(t,e){let n=Ee(t,e),r=Math.round(t/n)*n,i=Math.round(e/n)*n,s=C(0,Math.round((i-r)/n)).map((t=>r+t*n)),a=-Math.floor(Math.log10(n)-1);return a>=0&&(s=s.map((t=>parseFloat(t.toFixed(a))))),s}(t,e)}function Se(t,e=0,n=!1){let r=Object.assign(Object.assign({},pe),t);return null==r.xticks&&(r.xticks=Oe(r.xrange[0],r.xrange[1],0==e)),r.xticks=r.xticks.filter((t=>t>r.xrange[0]&&t<r.xrange[1])),u(...n?r.xticks.map((t=>ye(t,e,r))):r.xticks.map((t=>xe(t,e,t.toString(),r))))}function Le(t,e=0,n=!1){let r=Object.assign(Object.assign({},pe),t);return null==r.yticks&&(r.yticks=Oe(r.yrange[0],r.yrange[1],0==e)),r.yticks=r.yticks.filter((t=>t>r.yrange[0]&&t<r.yrange[1])),u(...n?r.yticks.map((t=>we(t,e,r))):r.yticks.map((t=>ke(t,e,t.toString(),r))))}function Ce(t){let e=Object.assign(Object.assign({},pe),t),n=e.xrange[0],r=e.yrange[0];return u(be(e),Se(e,r),Le(e,n))}function Me(t){let e=Object.assign(Object.assign({},pe),t);return u(me(e),Se(e),Le(e))}function Te(t){let n=Object.assign(Object.assign({},pe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let r=_e(n)(e(0,0));return u(gt(e(n.bbox[0].x,r.y),e(n.bbox[1].x,r.y),n.headsize).append_tags(s.GRAPH_AXIS),Se(n,0))}function Ne(t){let n=Object.assign(Object.assign({},pe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let r=_e(n)(e(0,0));return u(gt(e(r.x,n.bbox[0].y),e(r.x,n.bbox[1].y),n.headsize).append_tags(s.GRAPH_AXIS),Le(n,0))}function He(t){let n=Object.assign(Object.assign({},pe),t);return null==n.xticks&&(n.xticks=Oe(n.xrange[0],n.xrange[1],!1)),u(...n.xticks.map((t=>p(e(t,n.yrange[0]),e(t,n.yrange[1])).transform(_e(n)).stroke("gray")))).append_tags(s.GRAPH_GRID)}function De(t){let n=Object.assign(Object.assign({},pe),t);return null==n.yticks&&(n.yticks=Oe(n.yrange[0],n.yrange[1],!1)),u(...n.yticks.map((t=>p(e(n.xrange[0],t),e(n.xrange[1],t)).transform(_e(n)).stroke("gray")))).append_tags(s.GRAPH_GRID)}function Ie(t){let n=Object.assign(Object.assign({},pe),t);return null==n.xticks&&(n.xticks=Oe(n.xrange[0],n.xrange[1],!1)),null==n.yticks&&(n.yticks=Oe(n.yrange[0],n.yrange[1],!1)),u(...n.xticks.map((t=>p(e(t,n.yrange[0]),e(t,n.yrange[1])).transform(_e(n)).stroke("gray"))),...n.yticks.map((t=>p(e(n.xrange[0],t),e(n.xrange[1],t)).transform(_e(n)).stroke("gray"))))}function Re(t,e){let n,r=Object.assign(Object.assign({},pe),e),[i,s]=r.xrange,[a,l]=r.yrange,o=[],c=[];for(let e=0;e<t.length;e++){let n=t[e];n.x>=i&&n.x<=s&&n.y>=a&&n.y<=l?c.push(n):(c.length>1&&o.push(c),c=[])}c.length>1&&o.push(c);let h=o.map((t=>g(t)));return n=1==h.length?h[0]:u(...h).stroke("black").fill("none"),n.transform(_e(r))}function je(t,n,r){if(t.length!=n.length)throw new Error("xdata and ydata must have the same length");return Re(t.map(((t,r)=>e(t,n[r]))),r)}function ze(t,n){let r=Object.assign(Object.assign({},pe),n);return Re(O(...r.xrange,r.n_sample).map((n=>e(n,t(n)))),n)}function qe(t,n,r,i){let s=Object.assign(Object.assign({},pe),i),a=Object.assign({},s);return a.xrange=[n,r],a.bbox=void 0,ze(t,a).add_points([e(r,0),e(n,0)]).to_polygon().transform(_e(s))}var Be=Object.freeze({__proto__:null,ax:fe,axes_corner_empty:be,axes_corner_empty_xbreak:ve,axes_empty:me,axes_transform:_e,default_axes_options:pe,get_tick_numbers:Oe,plot:je,plotf:ze,plotv:Re,under_curvef:qe,xaxis:Te,xgrid:De,xtickmark:xe,xtickmark_empty:ye,xticks:Se,xyaxes:Me,xycorneraxes:Ce,xycorneraxes_xbreak:function(t){let e=Object.assign(Object.assign({},pe),t),n=e.xrange[0],r=e.yrange[0];return u(ve(e),Se(e,r),Le(e,n))},xygrid:Ie,yaxis:Ne,ygrid:He,ytickmark:ke,ytickmark_empty:we,yticks:Le});function Pe(t,n,r=1,i){let[s,a,l]=t,o=s.sub(a),c=l.sub(a);if(null==i&&(i=e(0,0)),"number"==typeof i){i=o.normalize().add(c.normalize()).normalize().scale(i)}let h=o.angle(),d=c.angle();d<h&&(d+=2*Math.PI);let g=ht(r,d-h).rotate(h).add_points([e(0,0)]).to_polygon();return""==n||null==n?g.position(a):u(g,pt(n).translate(i)).position(a)}var Fe=Object.freeze({__proto__:null,angle:Pe,angle_smaller:function(t,e,n=1,r){let[i,s,a]=t,l=i.sub(s),o=a.sub(s),c=l.angle(),h=o.angle();return h<c&&(h+=2*Math.PI),Pe(h-c>Math.PI?[a,s,i]:[i,s,a],e,n,r)},congruence_mark:function(t,n,r,i=1,s){let a=n.sub(t),l=Math.atan2(a.x,-a.y),o=t.add(n).scale(.5);s=null!=s?s:i/2;let c=[];for(let t=0;t<r;t++){let n=p(e(-i/2,t*s),e(i/2,t*s));c.push(n)}return u(...c).rotate(l).move_origin("center-center").position(o)},length:function(t,n,r,i,s,a,l=!0){s=null!=s?s:n.sub(t).length()/20,a=null!=a?a:2*i;let o=t.equals(n)?e(0,0):n.sub(t).normalize(),c=e(o.y,-o.x),h=t.add(c.scale(i)),d=n.add(c.scale(i)),g=l?p(h.sub(c.scale(s/2)),h.add(c.scale(s/2))):p(h,h.sub(c.scale(s))),_=l?p(d.sub(c.scale(s/2)),d.add(c.scale(s/2))):p(d,d.sub(c.scale(s))),f=u(p(h,d),g,_),m=t.add(n).scale(.5);return u(f,pt(r).position(m.add(c.scale(a))))},parallel_mark:function(t,n,r,i=1,s,a=.5){let l=n.sub(t),o=Math.atan2(l.x,-l.y),c=t.add(n).scale(.5);s=null!=s?s:i/2;let h=[],d=i/2*Math.cos(a);for(let t=0;t<r;t++){let n=e(0,t*s-d),r=p(e(-i/2,t*s),n),a=p(e(i/2,t*s),n);h.push(r.combine(a))}return u(...h).rotate(o).move_origin("center-center").position(c)},right_angle:function(t,n=1){let[r,i,s]=t,a=r.sub(i).normalize().scale(n).add(i),l=s.sub(i).normalize().scale(n).add(i);return g([a,e(a.x,l.y),l])},vector:function(t,n,r,i){null==r&&(r=e(0,0));let s=dt(t,i);return""==n||null==n?s:u(s,pt(n).position(t.add(r)))}});var Ge=Object.freeze({__proto__:null,inclined_plane:function(t,n){return _([e(0,0),e(t,t*Math.tan(n)),e(t,0)])},spring:function(t,n,r=1,i=10,s=.5,a=100){let l=n.sub(t).angle(),o=n.sub(t).length(),c=s,h=r/c,d=(2*i+1)*Math.PI,u=(o-2*c)/d;return g(O(0,d,a).map((t=>e(u*t+c-c*Math.cos(t),h*c*Math.sin(t))))).rotate(l).translate(t)}});let Ve={gap:.1,ticksize:.2,bbox:[e(0,0),e(10,10)]};function $e(t,n){var r,i;let s=Object.assign(Object.assign({},Ve),n),a=t.length,l=Math.max(...t),o=null!==(r=s.yrange)&&void 0!==r?r:[0,l],c=null!==(i=s.bbox)&&void 0!==i?i:[e(0,0),e(10,l)];return{xrange:[-1,a],yrange:o,headsize:0,ticksize:s.ticksize,bbox:c}}var Ue=Object.freeze({__proto__:null,axes_tansform:function(t,e={}){return _e($e(t,Object.assign(Object.assign({},Ve),e)))},default_bar_options:Ve,plot:function(t,n={}){let r=Object.assign(Object.assign({},Ve),n),i=_e($e(t,r));return u(...t.map(((t,n)=>it(1-r.gap,t).move_origin("bottom-center").position(e(Number(n),0)).transform(i))))},xaxes:function(t,n={}){let r=Object.assign(Object.assign({},Ve),n),i=t.length,s=_e($e(t.map((()=>1)),r));return u(p(e(-1,0),e(i,0)).transform(s).stroke("gray"),...t.map(((t,n)=>m(t).move_origin_text("top-center").position(e(Number(n),0)).transform(s).translate(e(0,-r.ticksize/2)).textfill("gray"))))},yaxes:function(t,n={}){var r;let i=Object.assign(Object.assign({},Ve),n),s=$e(t,i),a=s.yrange[1],l=null!==(r=i.yrange)&&void 0!==r?r:[0,a],o=_e(s),c=p(e(-1,0),e(-1,l[1])).transform(o).stroke("gray");return Le(s,-1).combine(c)}});var Xe,We=Object.freeze({__proto__:null,axis:function(t,n,r=1){return gt(e(t,0),e(n,0),r).fill("black").append_tags(s.GRAPH_AXIS)},numbered_ticks:function(t,n,r){let i=[];for(let a of t){let t=p(e(a,-n/2),e(a,n/2)).stroke("black").append_tags(s.GRAPH_TICK),l=m(a.toString()).move_origin("top-center").position(e(a,-n/2-r)).append_tags(s.GRAPH_TICK_LABEL);i.push(u(t,l))}return u(...i)},single_tick:function(t,n,r,i){let a=p(e(t,-r/2),e(t,r/2)).stroke("black").append_tags(s.GRAPH_TICK);return""==n?a:u(a,m(n).move_origin("top-center").position(e(t,-r/2-i)).append_tags(s.GRAPH_TICK_LABEL))},ticks:function(t,n){let r=[];for(let i of t){let t=p(e(i,-n/2),e(i,n/2)).stroke("black").append_tags(s.GRAPH_TICK);r.push(t)}return u(...r)}});function Je(t,e,n,r=Xe.ROWS){let i=r==Xe.ROWS?t:M(t),a=i.length,l=Math.max(...i.map((t=>t.length)));const o=function(t){var e;let n=t.length,r=Math.max(...t.map((t=>t.length))),i=Array(n).fill(!1).map((()=>Array(r).fill(!1)));for(let s=0;s<n;s++)for(let n=0;n<r;n++){const r=t[s][n];(null==r||(null===(e=null==r?void 0:r.is_empty)||void 0===e?void 0:e.call(r)))&&(i[s][n]=!0)}return i}(t);let c=Ye(a,l,e,n,o),h=Ke(c),d=[];for(let t=0;t<a;t++)for(let e=0;e<l;e++){let n=i[t][e];null!=n&&(n=n.move_origin("center-center").position(h[t][e]).append_tags(s.TABLE_CONTENT).append_tags(s.ROW_+t).append_tags(s.COL_+e),d.push(n))}let g=u(...d);return u(c,g).append_tags(s.CONTAIN_TABLE)}function Ye(t,n,r,i,a){for(;r.length<t;)r.push(r[r.length-1]);for(;i.length<n;)i.push(i[i.length-1]);let l=[],o=0;for(let c=0;c<t;c++){let t=o-r[c],h=0,d=[];for(let r=0;r<n;r++){let n=h+i[r],l=(h+n)/2,u=(o+t)/2,g=st(e(h,t),e(n,o)).move_origin(e(l,u)).append_tags(s.TABLE_CELL).append_tags(s.ROW_+c).append_tags(s.COL_+r);a[c][r]&&(g=g.append_tags(s.EMPTY_CELL)),d.push(g),h=n}l.push(u(...d)),o=t}return u(...l).append_tags(s.TABLE)}function Ke(t){let e=t;if(t.tags.includes(s.CONTAIN_TABLE))for(let n of t.children)if(n.tags.includes(s.TABLE)){e=n;break}if(!e.tags.includes(s.TABLE))return[];let n=[];for(let t of e.children){let e=[];for(let n of t.children)e.push(n.origin);n.push(e)}return n}!function(t){t.ROWS="rows",t.COLUMNS="columns"}(Xe||(Xe={}));var Ze=Object.freeze({__proto__:null,empty_fixed_size:Ye,fixed_size:Je,get_points:Ke,style_cell:function t(e,n){let r=e.copy();if(e.tags.includes(s.CONTAIN_TABLE)){let e=r.children.findIndex((t=>t.tags.includes(s.TABLE))),i=t(r.children[e],n);return r.children[e]=i,r}if(!e.tags.includes(s.TABLE))return e;for(let t of n){let[e,n]=t.index,i=r.children[e].children[n];t.fill&&(i=i.fill(t.fill)),t.stroke&&(i=i.stroke(t.stroke)),t.strokewidth&&(i=i.strokewidth(t.strokewidth)),r.children[e].children[n]=i}return r},table:function(t,e=0,n=Xe.ROWS,r=0,i=0){let s=n==Xe.ROWS?t:M(t);const a=T(e);function l(t){if(null==t)return[i,r];let[e,n]=t.bounding_box();return[n.x-e.x+a[1]+a[3],n.y-e.y+a[0]+a[2]]}let o=s.length,c=Math.max(...s.map((t=>t.length))),h=Array(o).fill(r),d=Array(c).fill(i);for(let t=0;t<o;t++)for(let e=0;e<c;e++){let[n,r]=l(s[t][e]);h[t]=Math.max(h[t],r),d[e]=Math.max(d[e],n)}return Je(t,h,d,n)}});let Qe={ticksize:.2,range:[0,1],bbox:[e(0,0),e(10,10)],orientation:"x",headsize:.05,tick_label_offset:0};function tn(t){var n;let r=Object.assign(Object.assign({},Qe),t);if(r.bbox=null!==(n=r.bbox)&&void 0!==n?n:[e(0,0),e(10,10)],"x"==r.orientation){return{xrange:r.range,yrange:[r.bbox[0].y,r.bbox[1].y],xticks:r.ticks,headsize:r.headsize,ticksize:r.ticksize,bbox:r.bbox,tick_label_offset:r.tick_label_offset}}return{xrange:[r.bbox[0].x,r.bbox[1].x],yrange:r.range,yticks:r.ticks,headsize:r.headsize,ticksize:r.ticksize,bbox:r.bbox,tick_label_offset:r.tick_label_offset}}var en,nn=Object.freeze({__proto__:null,axes:function(t={}){let n=Object.assign(Object.assign({},Qe),t),r=tn(n),[i,s]=n.bbox;if("x"==n.orientation){return u(gt(e(i.x,0),e(s.x,0),n.headsize),Se(r,0)).stroke("gray").fill("gray")}return u(gt(e(0,i.y),e(0,s.y),n.headsize),Le(r,0)).stroke("gray").fill("gray")},default_bar_options:Qe,empty_tickmarks:function(t,e={}){let n=Object.assign(Object.assign({},Qe),e),r=tn(n);return"x"==n.orientation?(r.xticks=t,Se(r,0,!0)):(r.yticks=t,Le(r,0,!0))},plotQ:function(t,n,r,i){let s=Object.assign(Object.assign({},Qe),i),a=_e(tn(s)),[l,o,c,h,d]=t,g=.8*r;if("x"==s.orientation){return u(it(h-o,r).move_origin("center-left").position(e(o,n)).transform(a),p(e(l,n-g/2),e(l,n+g/2)).transform(a),p(e(d,n-g/2),e(d,n+g/2)).transform(a),p(e(c,n-r/2),e(c,n+r/2)).transform(a),p(e(l,n),e(o,n)).transform(a),p(e(h,n),e(d,n)).transform(a))}return u(it(r,h-o).move_origin("bottom-center").position(e(n,o)).transform(a),p(e(n-g/2,l),e(n+g/2,l)).transform(a),p(e(n-g/2,d),e(n+g/2,d)).transform(a),p(e(n-r/2,c),e(n+r/2,c)).transform(a),p(e(n,l),e(n,o)).transform(a),p(e(n,h),e(n,d)).transform(a))},to_ax_options:tn});function rn(t,n){let r=t.p,i=t.p.add(t.dir),s=n.p,a=n.p.add(n.dir),l=r.x,o=r.y,c=i.x,h=i.y,d=s.x,u=s.y,g=a.x,p=a.y,_=(l-c)*(u-p)-(o-h)*(d-g);return e(((l*h-o*c)*(d-g)-(l-c)*(d*p-u*g))/_,((l*h-o*c)*(u-p)-(o-h)*(d*p-u*g))/_)}function sn(t,e){return{type:en.LINE,p:t,dir:e}}function an(t,e){return sn(t,e.sub(t))}function ln(t,n){let[r,i]=n,s=r,a=i,l=e(s.x,a.y),o=e(a.x,s.y),c=[rn(t,an(l,a)),rn(t,an(a,o)),rn(t,an(o,s)),rn(t,an(s,l))];const h=1e-6;let d=c.filter((t=>(t=>t.x>=s.x-h&&t.x<=a.x+h&&t.y>=s.y-h&&t.y<=a.y+h)(t)));if(!(d.length<=1))return p(d[0],d[1])}!function(t){t.LINE="LINE"}(en||(en={}));var on=Object.freeze({__proto__:null,get_preview_diagram:function(n,r){let i=[],s=[],a={[en.LINE]:s},l=Object.keys(n);for(let e of l){let r=n[e];"number"!=typeof r&&(r instanceof t?i.push({name:e,p:r}):a[r.type].push({name:e,obj:r}))}let o=Math.min(...i.map((t=>t.p.x))),c=Math.max(...i.map((t=>t.p.x))),h=Math.min(...i.map((t=>t.p.y))),d=Math.max(...i.map((t=>t.p.y)));null==r&&(r=.1*Math.max(c-o,d-h));let g=[e(o-(r=function(t){let e="number"==typeof t?[t]:t;switch(e.length){case 0:return[0,0,0,0];case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];default:return[e[0],e[1],e[2],e[3]]}}(r))[0],h-r[1]),e(c+r[2],d+r[3])],p=s.map((t=>ln(t.obj,g))).filter((t=>void 0!==t)),_=.01*Math.max(g[1].x-g[0].x,g[1].y-g[0].y)*2/3;return u(...p,...i.map((t=>{let n=ct(_).translate(t.p).fill("black"),r=pt(t.name).translate(t.p.add(e(2*_,2*_))).move_origin_text("bottom-left"),i=r.copy().textfill("white").textstroke("white").textstrokewidth(10).opacity(.7);return n.combine(i,r)})))},intersect:function(t,e){if(t.type===en.LINE&&e.type===en.LINE){return[rn(t,e)]}return[]},line:sn,line_from_angle:function(t,e){return sn(t,n(e))},line_from_points:an,line_from_slope:function(t,n){return sn(t,e(1,n))},line_intersection:rn,line_parallel_at_point:function(t,e){return sn(e,t.dir)},line_perpendicular_at_point:function(t,n){return sn(n,e(-t.dir.y,t.dir.x))},line_rotated_at_point:function(t,e,n){return sn(n,t.dir.rotate(e))},point_collinear_extend_length:function(t,e,n){let r=e.sub(t).normalize();return e.add(r.scale(n))},point_collinear_fraction:function(t,e,n){let r=e.sub(t);return t.add(r.scale(n))},point_onLine_atDistance_from:function(t,e,n){let r=t.dir.normalize();return n.add(r.scale(e))},point_onLine_with_x:function(t,n){let r=t.dir.y/t.dir.x;return e(n,r*n+(t.p.y-r*t.p.x))},point_onLine_with_y:function(t,n){let r=t.dir.y/t.dir.x;return e((n-(t.p.y-r*t.p.x))/r,n)}});class cn{constructor(t,e,n=0,r=0){var i;this.diagram=t.value,this.size=mt(this.diagram),this.x=-1,this.y=n,this.tree=t;let s=null!==(i=t.children)&&void 0!==i?i:[];this.children=s.map(((t,e)=>new cn(t,this,n+1,e))),this.parent=e,this.thread=void 0,this.mod=0,this.ancestor=this,this.change=0,this.shift=0,this.number=r}left(){return this.thread?this.thread:this.children.length>0?this.children[0]:void 0}right(){return this.thread?this.thread:this.children.length>0?this.children[this.children.length-1]:void 0}lsibling(){if(this.parent)return this.number>0?this.parent.children[this.number-1]:void 0}}function hn(t,e,n){let r=gn(new cn(t,void 0),n),i=fn(r,0,0,e,0);return i<0&&un(r,-i),dn(r),r}function dn(t){t.diagram=t.diagram.position(e(t.x,t.y)),t.children.forEach(dn)}function un(t,e){t.x+=e,t.children.forEach((t=>un(t,e)))}function gn(t,e){let n=t.size[0]/2;if(0===t.children.length){let r=t.lsibling();if(r){let i=r.size[0]/2+n+e;t.x=r.x+i}else t.x=0}else{let r=t.children[0];t.children.forEach((t=>{gn(t,e),r=function(t,e,n){let r=t.lsibling();if(void 0!==r){let i=t,s=t,a=r,l=t.parent&&0!==t.number?t.parent.children[0]:void 0,o=t.mod,c=t.mod,h=a.mod,d=l.mod;for(;void 0!==(null==a?void 0:a.right())&&void 0!==(null==i?void 0:i.left());){a=a.right(),i=i.left(),l=null==l?void 0:l.left(),s=null==s?void 0:s.right(),s.ancestor=t;let r=a.size[0]/2+i.size[0]/2+n,u=a.x+h-(i.x+o)+r;if(u>0){pn(_n(a,t,e),t,u),o+=u,c+=u}h+=a.mod,o+=i.mod,d+=l.mod,c+=s.mod}void 0!==a.right()&&void 0===s.right()?(s.thread=a.right(),s.mod+=h-c):(void 0!==(null==i?void 0:i.left())&&void 0===(null==l?void 0:l.left())&&(l.thread=i.left(),l.mod+=o-d),e=t)}return e}(t,r,e)})),function(t){let e=0,n=0;for(let r=t.children.length-1;r>=0;r--){let i=t.children[r];i.x+=e,i.mod+=e,n+=i.change,e+=i.shift+n}}(t);let i=(t.children[0].x+t.children[t.children.length-1].x)/2,s=t.lsibling();if(s){let r=s.size[0]/2+n+e;t.x=s.x+r,t.mod=t.x-i}else t.x=i}return t}function pn(t,e,n){let r=e.number-t.number;e.change-=n/r,e.shift+=n,t.change+=n/r,e.x+=n,e.mod+=n}function _n(t,e,n){var r;return(null===(r=e.parent)||void 0===r?void 0:r.children.includes(t.ancestor))?t.ancestor:n}function fn(t,e,n,r,i){return t.x+=e,t.y=-n*r,i=Math.min(null!=i?i:t.x,t.x),t.children.forEach((s=>{i=fn(s,e+t.mod,n+1,r,i)})),i}function mn(t){let e=t.diagram,n=t.children.map(mn),r=t.children.map((t=>p(e.get_anchor("bottom-center"),t.diagram.get_anchor("top-center"))));return u(e,...r,...n)}var bn=Object.freeze({__proto__:null,mirror_treenode:function t(e){var n;return{value:e.value,children:(null!==(n=e.children)&&void 0!==n?n:[]).map(t).reverse()}},tree:function(t,e,n){return mn(hn(t,e,n))}});function vn(t,n=10){const r=t.length;let i=t.map((t=>t.y)),s=new Array(r).fill(0),a=new Array(r).fill(0),l=new Array(r-1);for(let e=0;e<r-1;e++)l[e]=t[e+1].x-t[e].x;let o=new Array(r-1).fill(0),c=new Array(r).fill(0),h=new Array(r).fill(1),d=new Array(r).fill(0),u=new Array(r).fill(0);for(let t=1;t<r-1;t++)o[t]=3/l[t]*(i[t+1]-i[t])-3/l[t-1]*(i[t]-i[t-1]);for(let e=1;e<r-1;e++)h[e]=2*(t[e+1].x-t[e-1].x)-l[e-1]*d[e-1],d[e]=l[e]/h[e],u[e]=(o[e]-l[e-1]*u[e-1])/h[e];for(let t=r-2;t>=0;t--)c[t]=u[t]-d[t]*c[t+1],s[t]=(i[t+1]-i[t])/l[t]-l[t]*(c[t+1]+2*c[t])/3,a[t]=(c[t+1]-c[t])/(3*l[t]);let g=[];for(let l=0;l<r-1;l++)for(let r=0;r<=n;r++){let o=t[l].x+r*(t[l+1].x-t[l].x)/n,h=i[l]+s[l]*(o-t[l].x)+c[l]*Math.pow(o-t[l].x,2)+a[l]*Math.pow(o-t[l].x,3);g.push(e(o,h))}return g}var yn=Object.freeze({__proto__:null,bezier_cubic:function(t,e,n,r,i=100){const s=1/(i-1),a=Array(i);for(let l=0;l<i;l++){const i=l*s,o=t.scale((1-i)*(1-i)*(1-i)),c=e.scale(3*i*(1-i)*(1-i)),h=n.scale(3*i*i*(1-i)),d=r.scale(i*i*i);a[l]=o.add(c).add(h).add(d)}return g(a)},bezier_quadratic:function(t,e,n,r=100){const i=1/(r-1),s=Array(r);for(let a=0;a<r;a++){const r=a*i,l=t.scale((1-r)*(1-r)),o=e.scale(2*r*(1-r)),c=n.scale(r*r);s[a]=l.add(o).add(c)}return g(s)},cubic_spline:function(t,e=10){return g(vn(t,e))},curve_combine:function(...t){return g(t.map((t=>{var e,n;return null!==(n=null===(e=t.path)||void 0===e?void 0:e.points)&&void 0!==n?n:[]})).flat())},interpolate_cubic_spline:vn});function xn(t){return g([e(-t,-t),e(0,0),e(t,-t)]).fill("none").move_origin(e(0,0)).append_tags(s.ARROW_HEAD)}function wn(t,n,r){const i=xn(n).stroke(r).strokewidth(3).translate(e(0,t)).strokewidth(2),a=p(e(0,t),e(0,-t)).stroke(r).strokewidth(2).append_tags(s.ARROW_LINE),l=i.position(a.get_anchor("bottom-center")).reflect();return u(i,l,a).move_origin(a.get_anchor("center-center"))}function kn(t=3,e="white",n="#8B5CF6",r=1.2){const i=.5*t;return u(at(2.4*t).fill(n).opacity(.25).apply(Wt(4)).stroke("none"),at(2*t).fill(e).apply(Wt(3)).stroke("none"),wn(i,r,n))}var An=Object.freeze({__proto__:null,arrow2:wn,arrowHead:xn,horizontalLocator:function(t=3,e="white",n="#8B5CF6",r=1.2){return kn(t,e,n,r).rotate(Math.PI/2)},spanLocator:function(t=3,e="white",n="#8B5CF6",r=1.2){const i=.5*t;return u(at(2.4*t).fill(n).opacity(.25).apply(Wt(4)).stroke("none"),at(2*t).fill(e).apply(Wt(3)).stroke("none"),ct(i).stroke("none").fill(n))},verticalLocator:kn});var En=Object.freeze({__proto__:null,decode:function(t){return decodeURIComponent(atob(t))},encode:function(t){return btoa(encodeURIComponent(t))}});export{Pt as Content,h as Diagram,Ft as DrawingElement,Vt as HeaderElement,Nt as Interactive,Gt as ParagraphElement,d as Path,s as TAG,e as V2,n as Vdir,t as Vector2,q as _init_default_diagram_style,P as _init_default_text_diagram_style,G as _init_default_textdata,yt as align_horizontal,vt as align_vertical,Fe as annotation,ht as arc,E as array_repeat,dt as arrow,ut as arrow1,gt as arrow2,fe as ax,be as axes_corner_empty,me as axes_empty,_e as axes_transform,Ue as bar,ue as boolean,nn as boxplot,ct as circle,It as clientPos_to_svgPos,g as curve,yn as curves,z as default_diagram_style,B as default_text_diagram_style,F as default_textdata,u as diagram_combine,Et as distribute_grid_row,xt as distribute_horizontal,kt as distribute_horizontal_and_align,Ot as distribute_variable_row,wt as distribute_vertical,At as distribute_vertical_and_align,rt as download_svg_as_png,nt as download_svg_as_svg,K as draw_to_svg,Z as draw_to_svg_element,f as empty,En as encoding,ge as filter,on as geo_construct,bt as geometry,jt as get_SVGPos_from_event,J as get_tagged_svg_element,Be as graph,et as handle_tex_in_svg,b as image,An as interactive,p as line,O as linspace,S as linspace_exc,Ge as mechanics,Yt as mod,v as multiline,y as multiline_bb,We as numberline,je as plot,ze as plotf,Re as plotv,_ as polygon,L as range,C as range_inc,it as rectangle,st as rectangle_corner,lt as regular_polygon,ot as regular_polygon_side,V as reset_default_styles,at as square,R as str_latex_to_unicode,j as str_to_mathematical_italic,Ze as table,m as text,pt as textvar,A as to_degree,k as to_radian,M as transpose,bn as tree,qe as under_curvef,N as utils,Te as xaxis,De as xgrid,xe as xtickmark,ye as xtickmark_empty,Se as xticks,Me as xyaxes,Ce as xycorneraxes,Ie as xygrid,Ne as yaxis,He as ygrid,ke as ytickmark,we as ytickmark_empty,Le as yticks};
//# sourceMappingURL=diagrams.min.js.map
